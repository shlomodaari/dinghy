{
  "_comment": "THIS IS GENERATED CODE. DO NOT EDIT!",
  "application": "gonfalon",
  "pipelines": [
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - catamorphic",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/catamorphic/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.ld.catamorphic.com/api/status"
        },
        {
          "method": "POST",
          "name": "Seek #eng-deploys deploy approval",
          "overrideTimeout": true,
          "payload": {
            "channel": "#eng-deploys",
            "text": "${ trigger.user } wants to :deploying: gonfalon-web - catamorphic with version ${ parameters['sha'] }.\nSHA diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] } | See https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } for more information.\n\n:thumbsup: / :thumbsdown:?"
          },
          "refId": "notification_deploy_waiting_for_approval_eng-deploys",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "failPipeline": true,
          "instructions": "Deploying gonfalon-web - catamorphic with version ${ parameters['sha'] }. The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }",
          "judgmentInputs": [],
          "name": "Confirm that deploy should continue",
          "notifications": [
            {
              "address": "deploys",
              "level": "stage",
              "type": "slack",
              "when": [
                "manualJudgment",
                "manualJudgmentContinue",
                "manualJudgmentStop"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "confirm_deployment",
          "requisiteStageRefIds": [
            "notification_deploy_waiting_for_approval_eng-deploys"
          ],
          "sendNotifications": true,
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 3600000,
          "type": "manualJudgment"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-catamorphic deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-catamorphic",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - catamorphic with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-catamorphic",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"catamorphic\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-east-1"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version",
            "notification_deploy_waiting_for_approval_eng-deploys",
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "save-flags-json",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "SDK_KEY_SSM_PARAMETER",
                          "value": "/catamorphic/common/services/launchdarkly-catamorphic/sdk_key"
                        },
                        {
                          "name": "S3_BUCKET",
                          "value": "launchdarkly-configs"
                        },
                        {
                          "name": "S3_KEY",
                          "value": "catamorphic/gonfalon/flags.json"
                        },
                        {
                          "name": "CATFOOD_URL",
                          "value": "https://app.ld.catamorphic.com"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/save-flags-json:latest",
                      "name": "flags-json"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Save flags.json to S3 - us-east-1",
          "refId": "save_flags_json_us-east-1",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-coderefs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "coderefs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for coderefs-crdb",
          "refId": "run_db_migrations_coderefs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-oauth2-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "oauth2-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for oauth2-crdb",
          "refId": "run_db_migrations_oauth2-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for accounts-crdb",
          "refId": "run_db_migrations_accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-accounts-crdb",
          "refId": "run_db_migrations_gonfalon-accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-billing-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-billing-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-billing-crdb",
          "refId": "run_db_migrations_gonfalon-billing-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-file-jobs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-file-jobs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-file-jobs-crdb",
          "refId": "run_db_migrations_gonfalon-file-jobs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-integrations-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-integrations-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-integrations-crdb",
          "refId": "run_db_migrations_gonfalon-integrations-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-workflows-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-workflows-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-workflows-crdb",
          "refId": "run_db_migrations_gonfalon-workflows-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-experimentation-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-experimentation-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "catamorphic"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-experimentation-crdb",
          "refId": "run_db_migrations_gonfalon-experimentation-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-1": [
                  "us-east-1a",
                  "us-east-1b",
                  "us-east-1c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1jYXRhbW9ycGhpYwpMRF9BUFBfQ09ORklHPW1hbmFnZWQtY2F0YW1vcnBoaWMKRU5WX1NIT1JUX05BTUU9Y2F0LXByb2QKRUMyX0hPU1ROQU1FPSQoaG9zdG5hbWUpClMzX0NPTkZJR1NfQlVDS0VUPWxhdW5jaGRhcmtseS1jb25maWdzCgpTTEFDS19FTkRQT0lOVD0iaHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDAzTlgyNDBXL0JHUTBOVFQxUy9UNkJRdXM2Z2FtTjJwYU4xeGhPVDVUdjUiCnRlbGxfc2xhY2tfY2hhbm5lbCgpIHsKICAgIGNoYW5uZWw9IiQxIgogICAgbWVzc2FnZT0iJDIiCiAgICBjdXJsIFwKICAgICAgICAtLXNpbGVudCBcCiAgICAgICAgLS1zaG93LWVycm9yIFwKICAgICAgICAtLXJlcXVlc3QgUE9TVCBcCiAgICAgICAgLS1oZWFkZXIgJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vanNvbicgXAogICAgICAgIC0tZGF0YSAieydjaGFubmVsJzpcIiR7Y2hhbm5lbH1cIiwgJ3RleHQnOlwiJHttZXNzYWdlfVwifSIgXAogICAgICAgICIke1NMQUNLX0VORFBPSU5UfSIgXAogICAgfHwgZWNobyAiRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSB0byBTbGFjayAjJHtjaGFubmVsfTogJHttZXNzYWdlfSIgPiYyCn0KCnRlbGxfc2xhY2tfb3BzX3JhdygpIHsKICAgIG1lc3NhZ2U9IiQxIgogICAgZWNobyAiPj4gJHttZXNzYWdlfSIgPiYyCiAgICB0ZWxsX3NsYWNrX2NoYW5uZWwgIm9wcy1jYXRhbW9ycGhpYyIgIiR7bWVzc2FnZX0iCn0KCnRlbGxfc2xhY2tfb3BzKCkgewogICAgcmF3X21lc3NhZ2U9IiQxIgogICAgbWVzc2FnZT0iJHtFTlZJUk9OTUVOVH0vJHtFQzJfSE9TVE5BTUV9ICgke0FQUF9OQU1FfSk6ICR7cmF3X21lc3NhZ2V9IgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke21lc3NhZ2V9Igp9CiMgcnVuIHRoZSBzc2hfa2V5c19jbGVhbnVwIGNvbW1hbmQgdG8gZW5zdXJlIG5vIHNoYXJlZCBrZXlzIGFyZSBwcmVzZW50CnNzaF9rZXlzX2NsZWFudXAgfHwgdHJ1ZQoKbm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yKCkgewogIHJ2PSQ/CiAgaWYgWyAke3J2fSAtZXEgMCBdOyB0aGVuCiAgICBlY2hvICJBbGwgT0siCiAgZWxzZQogICAgc2VydmljZSAke0FQUF9OQU1FfSBzdG9wIHx8IHRydWUKICAgIEVSUk9SX01TRz0iQ2xvdWQtaW5pdCB1c2VyLWRhdGEgZmFpbGVkIHRvIHN1Y2NlZWQgKGV4aXQgY29kZSAke3J2fSkgb24gaW5zdGFuY2UgJHtFQzJfSE9TVE5BTUV9IGluICR7RU5WSVJPTk1FTlR9LiAgU3RvcHBpbmcgJHtBUFBfTkFNRX0gc28gdGhhdCBpbnN0YW5jZSBkb2VzIG5vdCByZWNlaXZlIGFueSB0cmFmZmljIGFuZCBzbyB0aGF0IGRlcGxveW1lbnQgY2FuIGZhaWwuIgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke0VSUk9SX01TR30iCiAgICBleGl0ICRydgogIGZpCn0KdHJhcCAibm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yIiBJTlQgVEVSTSBFWElUCkVDMl9JTlNUQU5DRV9JRD0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLWlkKQpFQzJfSVBWNF9MT0NBTF9BRERSPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvbG9jYWwtaXB2NCkKRUMyX0FWQUlMQUJJTElUWV9aT05FPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvcGxhY2VtZW50L2F2YWlsYWJpbGl0eS16b25lLykKRUMyX1JFR0lPTj0kKGVjaG8gJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9IHwgc2VkICdzLy4kLy8nKQoKIyBGZXRjaCBgZG9nZm9vZENhbmFyeWAgdGFnIGZvciB0aGlzIGVjMiBpbnN0YW5jZS4gVXNpbmcgYXdzIGNsaSBiZWNhdXNlIFNwaW5uYWtlciBkb2Vzbid0ICh5ZXQpIGhhdmUgYW4gZWFzeSB3YXkgdG8gZW5hYmxlIHRoZSBJbnN0YW5jZU1ldGFkYXRhVGFncyBmZWF0dXJlLgojIFRoaXMgaXMgYSBiZXN0IGVmZm9ydC4gSWYgdGhlIElBTSBwZXJtaXNzaW9ucyBhcmVuJ3Qgc2V0IHVwIGNvcnJlY3RseSwgdGhpcyB3aWxsIHF1aWV0bHkgZmFpbCBhbmQgRE9HRk9PRF9DQU5BUllfRU5BQkxFRCB3aWxsIGJlIHNldCB0byAiZmFsc2UiLgpET0dGT09EX0NBTkFSWV9FTkFCTEVEPSQoYXdzIGVjMiBkZXNjcmliZS10YWdzIC0tZmlsdGVycyAiTmFtZT1yZXNvdXJjZS1pZCxWYWx1ZXM9JHtFQzJfSU5TVEFOQ0VfSUR9IiAiTmFtZT1rZXksVmFsdWVzPWRvZ2Zvb2RDYW5hcnkiIC0tcmVnaW9uICR7RUMyX1JFR0lPTn0gLS1xdWVyeSAnVGFnc1swXS5WYWx1ZScgLS1vdXRwdXQgdGV4dCB8fCB0cnVlKQoKIyBPbmx5IGFsbG93IGVpdGhlciBgdHJ1ZWAgb3IgYGZhbHNlYCB2YWx1ZXMgc28gd2UgZXJyIG9uIHRoZSBzaWRlIG9mIHNldHRpbmcgdGhpcyB0byBmYWxzZS4KaWYgWyAiJHtET0dGT09EX0NBTkFSWV9FTkFCTEVEfSIgIT0gInRydWUiIF07IHRoZW4KCURPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9ImZhbHNlIgpmaQoKIyBUaGlzIGZpbGUgZ2V0cyBwaWNrZWQgdXAgYnkgb3VyIHN5c3RlbWQgc2VydmljZQplY2hvICJET0dGT09EX0NBTkFSWV9FTkFCTEVEPSR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iID4gL29wdC9zeXN0ZW1kZW52CgoKS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVD0idnBjZS0wYTJkZDdiY2I3ZjQ3Y2Y3MS03MnYyMXZqbC0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0uZmlyZWhvc2UudXMtZWFzdC0xLnZwY2UuYW1hem9uYXdzLmNvbSIKCktJTkVTSVNfU1RSRUFNX0VORFBPSU5UPSJ2cGNlLTAyMzVjZGI5NzgzMDllOWI5LXJoNjJveWVnLSR7RUMyX0FWQUlMQUJJTElUWV9aT05FfS5raW5lc2lzLnVzLWVhc3QtMS52cGNlLmFtYXpvbmF3cy5jb20iCgplY2hvICI+PiBEYXRhZG9nIGFnZW50IGNvbmZpZ3VyYXRpb24iCmF3cyBzMyBzeW5jIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vZGF0YWRvZy1hZ2VudC8gL2V0Yy9kYXRhZG9nLWFnZW50LyAtLWRlbGV0ZQoKWyAhIC1kIC92YXIvcnVuL2RhdGFkb2cgXSAmJiBta2RpciAtcCAvdmFyL3J1bi9kYXRhZG9nCgpjaG93biBkZC1hZ2VudDpkZC1hZ2VudCAvZXRjL2RhdGFkb2ctYWdlbnQvKiAvdmFyL3J1bi9kYXRhZG9nCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKY2htb2QgMDY0MCAvZXRjL2RhdGFkb2ctYWdlbnQvc2VjdXJpdHktYWdlbnQueWFtbAoKaWYgWyAtZiAiL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSIgXTsgdGhlbgogIFNIQT0kKGNhdCAvb3B0LyR7QVBQX05BTUV9LWN1cnJlbnQvU0hBKQogIHNlZCAtaSAicy9yZXBsYWNlLXdpdGgtc2hhLyR7U0hBfS8iIC9ldGMvZGF0YWRvZy1hZ2VudC9kYXRhZG9nLnlhbWwKZmkKCmZvciBzZXJ2aWNlX25hbWUgaW4gZGF0YWRvZy1hZ2VudCBkYXRhZG9nLWFnZW50LXByb2Nlc3MgZGF0YWRvZy1hZ2VudC10cmFjZSBkYXRhZG9nLWFnZW50LXN5c3Byb2JlOyBkbwogIHNlcnZpY2UgIiR7c2VydmljZV9uYW1lfSIgcmVzdGFydCB8fCB0ZWxsX3NsYWNrX29wcyAiJHtzZXJ2aWNlX25hbWV9IHJlc3RhcnQgZmFpbGVkIgpkb25lCgplY2hvICI+PiBwZ2JvdW5jZXIgQ29uZmlndXJhdGlvbiIKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vdXNlcmxpc3QudHh0IC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dApjaG93biBwb3N0Z3Jlczpwb3N0Z3JlcyAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dAoKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vcGdib3VuY2VyLmNtdHBsIC9ldGMvY29uc3VsLXRlbXBsYXRlL3BnYm91bmNlci5jbXRwbAphd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS9nb25mYWxvbi9jb25zdWwtdGVtcGxhdGUuY29uZiAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9jb25zdWwtdGVtcGxhdGUuY29uZgpzZXJ2aWNlIGNvbnN1bC10ZW1wbGF0ZSByZXN0YXJ0CnNsZWVwIDEwCgoKc2VydmljZSBwZ2JvdW5jZXIgcmVzdGFydAoKCmVjaG8gIj4+ICR7QVBQX05BTUV9IEFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb24iCgpjYXNlICR7QVBQX05BTUV9IGluCnN0cmVhbWVyKikKICBDVVJSRU5UX0FQUF9ESVI9c3RyZWFtZXItY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj1zdHJlYW1lcl9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmRhdGEtZXhwb3J0LXRlc3RlcikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9kZWZhdWx0LnltbAogIG12IC9vcHQvZXZlbnQtJHtBUFBfTkFNRX0tY3VycmVudC8gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vCiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgbXYgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX0gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX1fbGludXhfYW1kNjQvJHtBUFBfTkFNRX0KICA7OwoqKQogIENVUlJFTlRfQVBQX0RJUj0ke0FQUF9OQU1FfS1jdXJyZW50CiAgTElOVVhfQU1ENjRfRElSPSR7QVBQX05BTUV9X2xpbnV4X2FtZDY0CiAgQ09ORklHX1BBVEg9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZgogIG1rZGlyIC1wIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9CiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgOzsKZXNhYwoKZWNobyAiPj4gQ3JlYXRpbmcgc2VsZi1zaWduZWQgY2VydGlmaWNhdGUgZm9yIGFwcCB1c2UiCm9wZW5zc2wgcmVxIC1uZXdrZXkgcnNhOjQwOTYgXAogIC14NTA5IFwKICAtc2hhMjU2IFwKICAtZGF5cyAzNjUwIFwKICAtbm9kZXMgXAogIC1vdXQgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQuY3J0IFwKICAta2V5b3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmtleSBcCiAgLXN1YmogIi9DPVVTL1NUPUNBL0w9T2FrbGFuZC9PPUxhdW5jaERhcmtseS9PVT1TZWN1cml0eS9DTj0ke0VDMl9JTlNUQU5DRV9JRH0iCmlmIFsgIC1uICIkKHVuYW1lIC1hIHwgZ3JlcCBVYnVudHUpIiBdOyB0aGVuCiAgY2hvd24gbm9ib2R5IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydAogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkKZmkKCiMgU2V0IEtJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQgYW5kIEtJTkVTSVNfU1RSRUFNX0VORFBPSU5UCnNlZCAtaSAicy9LSU5FU0lTX1NUUkVBTV9FTkRQT0lOVC8ke0tJTkVTSVNfU1RSRUFNX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgpzZWQgLWkgInMvS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVC8ke0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlR9L2ciICIkQ09ORklHX1BBVEgiCgplY2hvICJEb3dubG9hZGluZyBjYXRmb29kIGZsYWdzIGZyb20gUzMiCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2ZsYWdzLmpzb24gIi9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9mbGFncy4ke0xEX0FQUF9DT05GSUd9Lmpzb24iCgplY2hvICJWYWxpZGF0aW5nIGZsYWdzLmpzb24iCmpxIC4gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2ZsYWdzLiR7TERfQVBQX0NPTkZJR30uanNvbiA+L2Rldi9udWxsCgoKCmVjaG8gIj4+IFN5c3RlbWQgQ29uZmlndXJhdGlvbiIKYXBwX3MzX3ByZWZpeD0iczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfSIKc3lzdGVtZF91bml0X2ZpbGU9Ii91c3IvbG9jYWwvbGliL3N5c3RlbWQvc3lzdGVtLyR7QVBQX05BTUV9LnNlcnZpY2UiCm1rZGlyIC1wICIkKGRpcm5hbWUgIiRzeXN0ZW1kX3VuaXRfZmlsZSIpIgphd3MgczMgY3AgIiRhcHBfczNfcHJlZml4LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uc3lzdGVtZC5jb25mIiAiJHN5c3RlbWRfdW5pdF9maWxlIgoKaWYgZ3JlcCAtcUYgJ3NzbS1lbnYtd3JhcHBlci5zaCcgIiRzeXN0ZW1kX3VuaXRfZmlsZSI7IHRoZW4KICBpZiAhIGF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvc3NtLWVudi13cmFwcGVyLnNoIiAvdXNyL2xvY2FsL2Jpbi9zc20tZW52LXdyYXBwZXIuc2g7IHRoZW4KICAgID4mMiBwcmludGYgJ0VSUk9SOiBzeXN0ZW1kIHVuaXQgIiVzIiB1c2VzICJzc20tZW52LXdyYXBwZXIuc2giIGJ1dCBjb3VsZCBub3QgZG93bmxvYWQgc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIgogICAgZXhpdCAxCiAgZmkKICBjaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9zc20tZW52LXdyYXBwZXIuc2gKZmkKCgplY2hvICI+PiBTZXQgdXAgQ29ja3JvYWNoZGIgY2VydHMiCm1rZGlyIC1wIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy1lYXN0LTE6NTU0NTgyMzE3OTg5OmNlcnRpZmljYXRlLWF1dGhvcml0eS81NTI3N2M4Yi0xMTljLTQwM2MtOGE1Zi1jNDExMjY0MTlhZTQiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5sZC5jYXRhbW9ycGhpYy5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049Z29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKICBlY2hvICJFeGVjU3RhcnRQb3N0PS9iaW4vc2ggLWMgJ2Nob3duIG5vYm9keTpub2dyb3VwIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzL2NsaWVudC5nb25mYWxvbi4qJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKIyBXZSBkb24ndCB3YW50IHRvIHN0YXJ0IHRoZSBkYXRhZG9nIHNlcnZpY2UgZm9yIHRoZSBzbGFjay1hcHAKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy1lYXN0LTE6NTU0NTgyMzE3OTg5OmNlcnRpZmljYXRlLWF1dGhvcml0eS81NTI3N2M4Yi0xMTljLTQwM2MtOGE1Zi1jNDExMjY0MTlhZTQiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5sZC5jYXRhbW9ycGhpYy5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049ZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgoKCgoKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UKIyBkaXNhYmxlIHNjaGVkdWxlZCB1cGRhdGVzIGJlY2F1c2UgZ29uZmFsb24gd2lsbCBub3QgcmVsb2FkIHRoZSBjZXJ0CiMgYnkgYWxsb3dpbmcgdGhlIGNlcnQgdG8gcmVtYWluIHVuY2hhbmdlZCwgd2UgY2FuIGJlIGFsZXJ0ZWQgd2hlbiBpdCBpcyBhYm91dCB0byBleHBpcmUKIyBzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS50aW1lcgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZQpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUudGltZXIKCgoKc2VydmljZSAiJHtBUFBfTkFNRX0iIHJlc3RhcnQKCkFUVEVNUFRTPTAKTUFYX0FUVEVNUFRTPTEyMApQT1JUPTMwMDAKd2hpbGUgWyAkQVRURU1QVFMgLW5lICRNQVhfQVRURU1QVFMgXSA7IGRvCiAgICBBVFRFTVBUUz0kKChBVFRFTVBUUysxKSkKICAgIGVjaG8gIldhaXRpbmcgZm9yIGFwcGxpY2F0aW9uLi4uICgke0FUVEVNUFRTfS8ke01BWF9BVFRFTVBUU30pIgogICAgaWYgISB0aW1lb3V0IDEgYmFzaCAtYyAiZWNobyA+L2Rldi90Y3AvbG9jYWxob3N0LyR7UE9SVH0iOyB0aGVuCiAgICAgICAgc2xlZXAgMTsKICAgIGVsc2UKICAgICAgICBlY2hvICJBcHBsaWNhdGlvbiBpcyBydW5uaW5nLiIKICAgICAgICBicmVhawogICAgZmkKICAgIGlmIFsgJEFUVEVNUFRTIC1lcSAkTUFYX0FUVEVNUFRTIF07IHRoZW4KICAgICAgICBleGl0IDE7CiAgICBmaQpkb25lCg==",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "cat-prod",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "catamorphic-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "cat-prod",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-2c23fc5b",
                "sg-aee1e0d3",
                "sg-4346cb0b",
                "sg-a5a04ddb",
                "sg-be2c24c3",
                "sg-05fbc06f9515babb5",
                "sg-09d3793013933e078",
                "sg-0b2afe701154406c0",
                "sg-02011051ee48dc396",
                "sg-007c843f1dcaaaf84",
                "sg-0d160cc271f1701c9",
                "sg-0c7175ae3974bc358",
                "sg-0fc340445caae75bb",
                "sg-0d5a1a14328634410",
                "sg-009bb53e15e6d7f0b"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "catamorphic-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (catamorphic)",
                "dogfoodCanary": "false",
                "env": "catamorphic",
                "environment": "catamorphic",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-1",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "production"
              },
              "targetGroups": [
                "gonfalon-web-cat-prod",
                "gonfalon-web-internal-cat-prod"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            },
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-1": [
                  "us-east-1a"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1jYXRhbW9ycGhpYwpMRF9BUFBfQ09ORklHPW1hbmFnZWQtY2F0YW1vcnBoaWMKRU5WX1NIT1JUX05BTUU9Y2F0LXByb2QKRUMyX0hPU1ROQU1FPSQoaG9zdG5hbWUpClMzX0NPTkZJR1NfQlVDS0VUPWxhdW5jaGRhcmtseS1jb25maWdzCgpTTEFDS19FTkRQT0lOVD0iaHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDAzTlgyNDBXL0JHUTBOVFQxUy9UNkJRdXM2Z2FtTjJwYU4xeGhPVDVUdjUiCnRlbGxfc2xhY2tfY2hhbm5lbCgpIHsKICAgIGNoYW5uZWw9IiQxIgogICAgbWVzc2FnZT0iJDIiCiAgICBjdXJsIFwKICAgICAgICAtLXNpbGVudCBcCiAgICAgICAgLS1zaG93LWVycm9yIFwKICAgICAgICAtLXJlcXVlc3QgUE9TVCBcCiAgICAgICAgLS1oZWFkZXIgJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vanNvbicgXAogICAgICAgIC0tZGF0YSAieydjaGFubmVsJzpcIiR7Y2hhbm5lbH1cIiwgJ3RleHQnOlwiJHttZXNzYWdlfVwifSIgXAogICAgICAgICIke1NMQUNLX0VORFBPSU5UfSIgXAogICAgfHwgZWNobyAiRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSB0byBTbGFjayAjJHtjaGFubmVsfTogJHttZXNzYWdlfSIgPiYyCn0KCnRlbGxfc2xhY2tfb3BzX3JhdygpIHsKICAgIG1lc3NhZ2U9IiQxIgogICAgZWNobyAiPj4gJHttZXNzYWdlfSIgPiYyCiAgICB0ZWxsX3NsYWNrX2NoYW5uZWwgIm9wcy1jYXRhbW9ycGhpYyIgIiR7bWVzc2FnZX0iCn0KCnRlbGxfc2xhY2tfb3BzKCkgewogICAgcmF3X21lc3NhZ2U9IiQxIgogICAgbWVzc2FnZT0iJHtFTlZJUk9OTUVOVH0vJHtFQzJfSE9TVE5BTUV9ICgke0FQUF9OQU1FfSk6ICR7cmF3X21lc3NhZ2V9IgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke21lc3NhZ2V9Igp9CiMgcnVuIHRoZSBzc2hfa2V5c19jbGVhbnVwIGNvbW1hbmQgdG8gZW5zdXJlIG5vIHNoYXJlZCBrZXlzIGFyZSBwcmVzZW50CnNzaF9rZXlzX2NsZWFudXAgfHwgdHJ1ZQoKbm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yKCkgewogIHJ2PSQ/CiAgaWYgWyAke3J2fSAtZXEgMCBdOyB0aGVuCiAgICBlY2hvICJBbGwgT0siCiAgZWxzZQogICAgc2VydmljZSAke0FQUF9OQU1FfSBzdG9wIHx8IHRydWUKICAgIEVSUk9SX01TRz0iQ2xvdWQtaW5pdCB1c2VyLWRhdGEgZmFpbGVkIHRvIHN1Y2NlZWQgKGV4aXQgY29kZSAke3J2fSkgb24gaW5zdGFuY2UgJHtFQzJfSE9TVE5BTUV9IGluICR7RU5WSVJPTk1FTlR9LiAgU3RvcHBpbmcgJHtBUFBfTkFNRX0gc28gdGhhdCBpbnN0YW5jZSBkb2VzIG5vdCByZWNlaXZlIGFueSB0cmFmZmljIGFuZCBzbyB0aGF0IGRlcGxveW1lbnQgY2FuIGZhaWwuIgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke0VSUk9SX01TR30iCiAgICBleGl0ICRydgogIGZpCn0KdHJhcCAibm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yIiBJTlQgVEVSTSBFWElUCkVDMl9JTlNUQU5DRV9JRD0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLWlkKQpFQzJfSVBWNF9MT0NBTF9BRERSPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvbG9jYWwtaXB2NCkKRUMyX0FWQUlMQUJJTElUWV9aT05FPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvcGxhY2VtZW50L2F2YWlsYWJpbGl0eS16b25lLykKRUMyX1JFR0lPTj0kKGVjaG8gJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9IHwgc2VkICdzLy4kLy8nKQoKIyBGZXRjaCBgZG9nZm9vZENhbmFyeWAgdGFnIGZvciB0aGlzIGVjMiBpbnN0YW5jZS4gVXNpbmcgYXdzIGNsaSBiZWNhdXNlIFNwaW5uYWtlciBkb2Vzbid0ICh5ZXQpIGhhdmUgYW4gZWFzeSB3YXkgdG8gZW5hYmxlIHRoZSBJbnN0YW5jZU1ldGFkYXRhVGFncyBmZWF0dXJlLgojIFRoaXMgaXMgYSBiZXN0IGVmZm9ydC4gSWYgdGhlIElBTSBwZXJtaXNzaW9ucyBhcmVuJ3Qgc2V0IHVwIGNvcnJlY3RseSwgdGhpcyB3aWxsIHF1aWV0bHkgZmFpbCBhbmQgRE9HRk9PRF9DQU5BUllfRU5BQkxFRCB3aWxsIGJlIHNldCB0byAiZmFsc2UiLgpET0dGT09EX0NBTkFSWV9FTkFCTEVEPSQoYXdzIGVjMiBkZXNjcmliZS10YWdzIC0tZmlsdGVycyAiTmFtZT1yZXNvdXJjZS1pZCxWYWx1ZXM9JHtFQzJfSU5TVEFOQ0VfSUR9IiAiTmFtZT1rZXksVmFsdWVzPWRvZ2Zvb2RDYW5hcnkiIC0tcmVnaW9uICR7RUMyX1JFR0lPTn0gLS1xdWVyeSAnVGFnc1swXS5WYWx1ZScgLS1vdXRwdXQgdGV4dCB8fCB0cnVlKQoKIyBPbmx5IGFsbG93IGVpdGhlciBgdHJ1ZWAgb3IgYGZhbHNlYCB2YWx1ZXMgc28gd2UgZXJyIG9uIHRoZSBzaWRlIG9mIHNldHRpbmcgdGhpcyB0byBmYWxzZS4KaWYgWyAiJHtET0dGT09EX0NBTkFSWV9FTkFCTEVEfSIgIT0gInRydWUiIF07IHRoZW4KCURPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9ImZhbHNlIgpmaQoKIyBUaGlzIGZpbGUgZ2V0cyBwaWNrZWQgdXAgYnkgb3VyIHN5c3RlbWQgc2VydmljZQplY2hvICJET0dGT09EX0NBTkFSWV9FTkFCTEVEPSR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iID4gL29wdC9zeXN0ZW1kZW52CgoKS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVD0idnBjZS0wYTJkZDdiY2I3ZjQ3Y2Y3MS03MnYyMXZqbC0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0uZmlyZWhvc2UudXMtZWFzdC0xLnZwY2UuYW1hem9uYXdzLmNvbSIKCktJTkVTSVNfU1RSRUFNX0VORFBPSU5UPSJ2cGNlLTAyMzVjZGI5NzgzMDllOWI5LXJoNjJveWVnLSR7RUMyX0FWQUlMQUJJTElUWV9aT05FfS5raW5lc2lzLnVzLWVhc3QtMS52cGNlLmFtYXpvbmF3cy5jb20iCgplY2hvICI+PiBEYXRhZG9nIGFnZW50IGNvbmZpZ3VyYXRpb24iCmF3cyBzMyBzeW5jIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vZGF0YWRvZy1hZ2VudC8gL2V0Yy9kYXRhZG9nLWFnZW50LyAtLWRlbGV0ZQoKWyAhIC1kIC92YXIvcnVuL2RhdGFkb2cgXSAmJiBta2RpciAtcCAvdmFyL3J1bi9kYXRhZG9nCgpjaG93biBkZC1hZ2VudDpkZC1hZ2VudCAvZXRjL2RhdGFkb2ctYWdlbnQvKiAvdmFyL3J1bi9kYXRhZG9nCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKY2htb2QgMDY0MCAvZXRjL2RhdGFkb2ctYWdlbnQvc2VjdXJpdHktYWdlbnQueWFtbAoKaWYgWyAtZiAiL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSIgXTsgdGhlbgogIFNIQT0kKGNhdCAvb3B0LyR7QVBQX05BTUV9LWN1cnJlbnQvU0hBKQogIHNlZCAtaSAicy9yZXBsYWNlLXdpdGgtc2hhLyR7U0hBfS8iIC9ldGMvZGF0YWRvZy1hZ2VudC9kYXRhZG9nLnlhbWwKZmkKCmZvciBzZXJ2aWNlX25hbWUgaW4gZGF0YWRvZy1hZ2VudCBkYXRhZG9nLWFnZW50LXByb2Nlc3MgZGF0YWRvZy1hZ2VudC10cmFjZSBkYXRhZG9nLWFnZW50LXN5c3Byb2JlOyBkbwogIHNlcnZpY2UgIiR7c2VydmljZV9uYW1lfSIgcmVzdGFydCB8fCB0ZWxsX3NsYWNrX29wcyAiJHtzZXJ2aWNlX25hbWV9IHJlc3RhcnQgZmFpbGVkIgpkb25lCgplY2hvICI+PiBwZ2JvdW5jZXIgQ29uZmlndXJhdGlvbiIKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vdXNlcmxpc3QudHh0IC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dApjaG93biBwb3N0Z3Jlczpwb3N0Z3JlcyAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dAoKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vcGdib3VuY2VyLmNtdHBsIC9ldGMvY29uc3VsLXRlbXBsYXRlL3BnYm91bmNlci5jbXRwbAphd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS9nb25mYWxvbi9jb25zdWwtdGVtcGxhdGUuY29uZiAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9jb25zdWwtdGVtcGxhdGUuY29uZgpzZXJ2aWNlIGNvbnN1bC10ZW1wbGF0ZSByZXN0YXJ0CnNsZWVwIDEwCgoKc2VydmljZSBwZ2JvdW5jZXIgcmVzdGFydAoKCmVjaG8gIj4+ICR7QVBQX05BTUV9IEFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb24iCgpjYXNlICR7QVBQX05BTUV9IGluCnN0cmVhbWVyKikKICBDVVJSRU5UX0FQUF9ESVI9c3RyZWFtZXItY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj1zdHJlYW1lcl9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmRhdGEtZXhwb3J0LXRlc3RlcikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9kZWZhdWx0LnltbAogIG12IC9vcHQvZXZlbnQtJHtBUFBfTkFNRX0tY3VycmVudC8gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vCiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgbXYgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX0gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX1fbGludXhfYW1kNjQvJHtBUFBfTkFNRX0KICA7OwoqKQogIENVUlJFTlRfQVBQX0RJUj0ke0FQUF9OQU1FfS1jdXJyZW50CiAgTElOVVhfQU1ENjRfRElSPSR7QVBQX05BTUV9X2xpbnV4X2FtZDY0CiAgQ09ORklHX1BBVEg9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZgogIG1rZGlyIC1wIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9CiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgOzsKZXNhYwoKZWNobyAiPj4gQ3JlYXRpbmcgc2VsZi1zaWduZWQgY2VydGlmaWNhdGUgZm9yIGFwcCB1c2UiCm9wZW5zc2wgcmVxIC1uZXdrZXkgcnNhOjQwOTYgXAogIC14NTA5IFwKICAtc2hhMjU2IFwKICAtZGF5cyAzNjUwIFwKICAtbm9kZXMgXAogIC1vdXQgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQuY3J0IFwKICAta2V5b3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmtleSBcCiAgLXN1YmogIi9DPVVTL1NUPUNBL0w9T2FrbGFuZC9PPUxhdW5jaERhcmtseS9PVT1TZWN1cml0eS9DTj0ke0VDMl9JTlNUQU5DRV9JRH0iCmlmIFsgIC1uICIkKHVuYW1lIC1hIHwgZ3JlcCBVYnVudHUpIiBdOyB0aGVuCiAgY2hvd24gbm9ib2R5IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydAogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkKZmkKCiMgU2V0IEtJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQgYW5kIEtJTkVTSVNfU1RSRUFNX0VORFBPSU5UCnNlZCAtaSAicy9LSU5FU0lTX1NUUkVBTV9FTkRQT0lOVC8ke0tJTkVTSVNfU1RSRUFNX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgpzZWQgLWkgInMvS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVC8ke0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlR9L2ciICIkQ09ORklHX1BBVEgiCgplY2hvICJEb3dubG9hZGluZyBjYXRmb29kIGZsYWdzIGZyb20gUzMiCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2ZsYWdzLmpzb24gIi9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9mbGFncy4ke0xEX0FQUF9DT05GSUd9Lmpzb24iCgplY2hvICJWYWxpZGF0aW5nIGZsYWdzLmpzb24iCmpxIC4gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2ZsYWdzLiR7TERfQVBQX0NPTkZJR30uanNvbiA+L2Rldi9udWxsCgoKCmVjaG8gIj4+IFN5c3RlbWQgQ29uZmlndXJhdGlvbiIKYXBwX3MzX3ByZWZpeD0iczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfSIKc3lzdGVtZF91bml0X2ZpbGU9Ii91c3IvbG9jYWwvbGliL3N5c3RlbWQvc3lzdGVtLyR7QVBQX05BTUV9LnNlcnZpY2UiCm1rZGlyIC1wICIkKGRpcm5hbWUgIiRzeXN0ZW1kX3VuaXRfZmlsZSIpIgphd3MgczMgY3AgIiRhcHBfczNfcHJlZml4LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uc3lzdGVtZC5jb25mIiAiJHN5c3RlbWRfdW5pdF9maWxlIgoKaWYgZ3JlcCAtcUYgJ3NzbS1lbnYtd3JhcHBlci5zaCcgIiRzeXN0ZW1kX3VuaXRfZmlsZSI7IHRoZW4KICBpZiAhIGF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvc3NtLWVudi13cmFwcGVyLnNoIiAvdXNyL2xvY2FsL2Jpbi9zc20tZW52LXdyYXBwZXIuc2g7IHRoZW4KICAgID4mMiBwcmludGYgJ0VSUk9SOiBzeXN0ZW1kIHVuaXQgIiVzIiB1c2VzICJzc20tZW52LXdyYXBwZXIuc2giIGJ1dCBjb3VsZCBub3QgZG93bmxvYWQgc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIgogICAgZXhpdCAxCiAgZmkKICBjaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9zc20tZW52LXdyYXBwZXIuc2gKZmkKCgplY2hvICI+PiBTZXQgdXAgQ29ja3JvYWNoZGIgY2VydHMiCm1rZGlyIC1wIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy1lYXN0LTE6NTU0NTgyMzE3OTg5OmNlcnRpZmljYXRlLWF1dGhvcml0eS81NTI3N2M4Yi0xMTljLTQwM2MtOGE1Zi1jNDExMjY0MTlhZTQiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5sZC5jYXRhbW9ycGhpYy5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049Z29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKICBlY2hvICJFeGVjU3RhcnRQb3N0PS9iaW4vc2ggLWMgJ2Nob3duIG5vYm9keTpub2dyb3VwIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzL2NsaWVudC5nb25mYWxvbi4qJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKIyBXZSBkb24ndCB3YW50IHRvIHN0YXJ0IHRoZSBkYXRhZG9nIHNlcnZpY2UgZm9yIHRoZSBzbGFjay1hcHAKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy1lYXN0LTE6NTU0NTgyMzE3OTg5OmNlcnRpZmljYXRlLWF1dGhvcml0eS81NTI3N2M4Yi0xMTljLTQwM2MtOGE1Zi1jNDExMjY0MTlhZTQiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5sZC5jYXRhbW9ycGhpYy5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049ZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgoKCgoKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UKIyBkaXNhYmxlIHNjaGVkdWxlZCB1cGRhdGVzIGJlY2F1c2UgZ29uZmFsb24gd2lsbCBub3QgcmVsb2FkIHRoZSBjZXJ0CiMgYnkgYWxsb3dpbmcgdGhlIGNlcnQgdG8gcmVtYWluIHVuY2hhbmdlZCwgd2UgY2FuIGJlIGFsZXJ0ZWQgd2hlbiBpdCBpcyBhYm91dCB0byBleHBpcmUKIyBzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS50aW1lcgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZQpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUudGltZXIKCgoKc2VydmljZSAiJHtBUFBfTkFNRX0iIHJlc3RhcnQKCkFUVEVNUFRTPTAKTUFYX0FUVEVNUFRTPTEyMApQT1JUPTMwMDAKd2hpbGUgWyAkQVRURU1QVFMgLW5lICRNQVhfQVRURU1QVFMgXSA7IGRvCiAgICBBVFRFTVBUUz0kKChBVFRFTVBUUysxKSkKICAgIGVjaG8gIldhaXRpbmcgZm9yIGFwcGxpY2F0aW9uLi4uICgke0FUVEVNUFRTfS8ke01BWF9BVFRFTVBUU30pIgogICAgaWYgISB0aW1lb3V0IDEgYmFzaCAtYyAiZWNobyA+L2Rldi90Y3AvbG9jYWxob3N0LyR7UE9SVH0iOyB0aGVuCiAgICAgICAgc2xlZXAgMTsKICAgIGVsc2UKICAgICAgICBlY2hvICJBcHBsaWNhdGlvbiBpcyBydW5uaW5nLiIKICAgICAgICBicmVhawogICAgZmkKICAgIGlmIFsgJEFUVEVNUFRTIC1lcSAkTUFYX0FUVEVNUFRTIF07IHRoZW4KICAgICAgICBleGl0IDE7CiAgICBmaQpkb25lCg==",
              "capacity": {
                "desired": 1,
                "max": 1,
                "min": 1
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "cat-prod-dogfood-canary",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "catamorphic-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "cat-prod",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-2c23fc5b",
                "sg-aee1e0d3",
                "sg-4346cb0b",
                "sg-a5a04ddb",
                "sg-be2c24c3",
                "sg-05fbc06f9515babb5",
                "sg-09d3793013933e078",
                "sg-0b2afe701154406c0",
                "sg-02011051ee48dc396",
                "sg-007c843f1dcaaaf84",
                "sg-0d160cc271f1701c9",
                "sg-0c7175ae3974bc358",
                "sg-0fc340445caae75bb",
                "sg-0d5a1a14328634410",
                "sg-009bb53e15e6d7f0b"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "catamorphic-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (catamorphic)",
                "dogfoodCanary": "true",
                "env": "catamorphic",
                "environment": "catamorphic",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-1",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "production"
              },
              "targetGroups": [
                "gonfalon-web-cat-prod",
                "gonfalon-web-internal-cat-prod"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to catamorphic",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-catamorphic@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to catamorphic.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!catamorphic !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id",
            "save_flags_json_us-east-1",
            "run_db_migrations_coderefs-crdb",
            "run_db_migrations_oauth2-crdb",
            "run_db_migrations_accounts-crdb",
            "run_db_migrations_gonfalon-accounts-crdb",
            "run_db_migrations_gonfalon-billing-crdb",
            "run_db_migrations_gonfalon-file-jobs-crdb",
            "run_db_migrations_gonfalon-integrations-crdb",
            "run_db_migrations_gonfalon-workflows-crdb",
            "run_db_migrations_gonfalon-experimentation-crdb"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 7200000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "catamorphic"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/managed-catamorphic"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - catamorphic - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"catamorphic\",\n  \"eventType\": \"started\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate started notification",
          "refId": "accelerate_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"catamorphic\",\n  \"eventType\": \"finished\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate finished notification",
          "refId": "accelerate_finished",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-catamorphic deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-catamorphic",
            "text": "${ trigger.user } is done deploying gonfalon-web - catamorphic with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-catamorphic",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"catamorphic\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": [
        {
          "enabled": true,
          "expectedArtifactIds": [],
          "payloadConstraints": {
            "status": "completed"
          },
          "runAsUser": "api-service-account@launchdarkly.com",
          "source": "027fa2a5-3e65-4aee-9a41-cd393ac8b224",
          "type": "webhook"
        },
        {
          "enabled": true,
          "expectedArtifactIds": [],
          "payloadConstraints": {
            "status": "thumbed"
          },
          "runAsUser": "api-service-account@launchdarkly.com",
          "source": "ba8a7157-4c40-43b1-984f-e3897a492c27",
          "type": "webhook"
        }
      ]
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - catamorphic_dr",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/catamorphic/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.dr.catamorphic.com/api/status"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-dr deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-dr",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - catamorphic_dr with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-dr",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"catamorphic_dr\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-west-2"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "save-flags-json",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "SDK_KEY_SSM_PARAMETER",
                          "value": "/catamorphic/common/services/launchdarkly-catamorphic/sdk_key"
                        },
                        {
                          "name": "S3_BUCKET",
                          "value": "launchdarkly-catamorphic-dr-configs"
                        },
                        {
                          "name": "S3_KEY",
                          "value": "catamorphic_dr/gonfalon/flags.json"
                        },
                        {
                          "name": "CATFOOD_URL",
                          "value": "https://app.ld.catamorphic.com"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/save-flags-json:latest",
                      "name": "flags-json"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Save flags.json to S3 - us-west-2",
          "refId": "save_flags_json_us-west-2",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-west-2": [
                  "us-west-2a",
                  "us-west-2b",
                  "us-west-2c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1jYXRhbW9ycGhpY19kcgpMRF9BUFBfQ09ORklHPW1hbmFnZWQtY2F0YW1vcnBoaWMKRU5WX1NIT1JUX05BTUU9Y2F0LWRyCkVDMl9IT1NUTkFNRT0kKGhvc3RuYW1lKQpTM19DT05GSUdTX0JVQ0tFVD1sYXVuY2hkYXJrbHktY2F0YW1vcnBoaWMtZHItY29uZmlncwoKU0xBQ0tfRU5EUE9JTlQ9Imh0dHBzOi8vaG9va3Muc2xhY2suY29tL3NlcnZpY2VzL1QwM05YMjQwVy9CR1EwTlRUMVMvVDZCUXVzNmdhbU4ycGFOMXhoT1Q1VHY1Igp0ZWxsX3NsYWNrX2NoYW5uZWwoKSB7CiAgICBjaGFubmVsPSIkMSIKICAgIG1lc3NhZ2U9IiQyIgogICAgY3VybCBcCiAgICAgICAgLS1zaWxlbnQgXAogICAgICAgIC0tc2hvdy1lcnJvciBcCiAgICAgICAgLS1yZXF1ZXN0IFBPU1QgXAogICAgICAgIC0taGVhZGVyICdDb250ZW50LXR5cGU6IGFwcGxpY2F0aW9uL2pzb24nIFwKICAgICAgICAtLWRhdGEgInsnY2hhbm5lbCc6XCIke2NoYW5uZWx9XCIsICd0ZXh0JzpcIiR7bWVzc2FnZX1cIn0iIFwKICAgICAgICAiJHtTTEFDS19FTkRQT0lOVH0iIFwKICAgIHx8IGVjaG8gIkZhaWxlZCB0byBzZW5kIG1lc3NhZ2UgdG8gU2xhY2sgIyR7Y2hhbm5lbH06ICR7bWVzc2FnZX0iID4mMgp9Cgp0ZWxsX3NsYWNrX29wc19yYXcoKSB7CiAgICBtZXNzYWdlPSIkMSIKICAgIGVjaG8gIj4+ICR7bWVzc2FnZX0iID4mMgogICAgdGVsbF9zbGFja19jaGFubmVsICJvcHMtZHIiICIke21lc3NhZ2V9Igp9Cgp0ZWxsX3NsYWNrX29wcygpIHsKICAgIHJhd19tZXNzYWdlPSIkMSIKICAgIG1lc3NhZ2U9IiR7RU5WSVJPTk1FTlR9LyR7RUMyX0hPU1ROQU1FfSAoJHtBUFBfTkFNRX0pOiAke3Jhd19tZXNzYWdlfSIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHttZXNzYWdlfSIKfQojIHJ1biB0aGUgc3NoX2tleXNfY2xlYW51cCBjb21tYW5kIHRvIGVuc3VyZSBubyBzaGFyZWQga2V5cyBhcmUgcHJlc2VudApzc2hfa2V5c19jbGVhbnVwIHx8IHRydWUKCm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvcigpIHsKICBydj0kPwogIGlmIFsgJHtydn0gLWVxIDAgXTsgdGhlbgogICAgZWNobyAiQWxsIE9LIgogIGVsc2UKICAgIHNlcnZpY2UgJHtBUFBfTkFNRX0gc3RvcCB8fCB0cnVlCiAgICBFUlJPUl9NU0c9IkNsb3VkLWluaXQgdXNlci1kYXRhIGZhaWxlZCB0byBzdWNjZWVkIChleGl0IGNvZGUgJHtydn0pIG9uIGluc3RhbmNlICR7RUMyX0hPU1ROQU1FfSBpbiAke0VOVklST05NRU5UfS4gIFN0b3BwaW5nICR7QVBQX05BTUV9IHNvIHRoYXQgaW5zdGFuY2UgZG9lcyBub3QgcmVjZWl2ZSBhbnkgdHJhZmZpYyBhbmQgc28gdGhhdCBkZXBsb3ltZW50IGNhbiBmYWlsLiIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHtFUlJPUl9NU0d9IgogICAgZXhpdCAkcnYKICBmaQp9CnRyYXAgIm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvciIgSU5UIFRFUk0gRVhJVApFQzJfSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKRUMyX0lQVjRfTE9DQUxfQUREUj0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCkVDMl9BVkFJTEFCSUxJVFlfWk9ORT0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL3BsYWNlbWVudC9hdmFpbGFiaWxpdHktem9uZS8pCkVDMl9SRUdJT049JChlY2hvICR7RUMyX0FWQUlMQUJJTElUWV9aT05FfSB8IHNlZCAncy8uJC8vJykKCiMgRmV0Y2ggYGRvZ2Zvb2RDYW5hcnlgIHRhZyBmb3IgdGhpcyBlYzIgaW5zdGFuY2UuIFVzaW5nIGF3cyBjbGkgYmVjYXVzZSBTcGlubmFrZXIgZG9lc24ndCAoeWV0KSBoYXZlIGFuIGVhc3kgd2F5IHRvIGVuYWJsZSB0aGUgSW5zdGFuY2VNZXRhZGF0YVRhZ3MgZmVhdHVyZS4KIyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQuIElmIHRoZSBJQU0gcGVybWlzc2lvbnMgYXJlbid0IHNldCB1cCBjb3JyZWN0bHksIHRoaXMgd2lsbCBxdWlldGx5IGZhaWwgYW5kIERPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQgd2lsbCBiZSBzZXQgdG8gImZhbHNlIi4KRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0kKGF3cyBlYzIgZGVzY3JpYmUtdGFncyAtLWZpbHRlcnMgIk5hbWU9cmVzb3VyY2UtaWQsVmFsdWVzPSR7RUMyX0lOU1RBTkNFX0lEfSIgIk5hbWU9a2V5LFZhbHVlcz1kb2dmb29kQ2FuYXJ5IiAtLXJlZ2lvbiAke0VDMl9SRUdJT059IC0tcXVlcnkgJ1RhZ3NbMF0uVmFsdWUnIC0tb3V0cHV0IHRleHQgfHwgdHJ1ZSkKCiMgT25seSBhbGxvdyBlaXRoZXIgYHRydWVgIG9yIGBmYWxzZWAgdmFsdWVzIHNvIHdlIGVyciBvbiB0aGUgc2lkZSBvZiBzZXR0aW5nIHRoaXMgdG8gZmFsc2UuCmlmIFsgIiR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iICE9ICJ0cnVlIiBdOyB0aGVuCglET0dGT09EX0NBTkFSWV9FTkFCTEVEPSJmYWxzZSIKZmkKCiMgVGhpcyBmaWxlIGdldHMgcGlja2VkIHVwIGJ5IG91ciBzeXN0ZW1kIHNlcnZpY2UKZWNobyAiRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0ke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiA+IC9vcHQvc3lzdGVtZGVudgoKCgoKZWNobyAiPj4gRGF0YWRvZyBhZ2VudCBjb25maWd1cmF0aW9uIgphd3MgczMgc3luYyBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2RhdGFkb2ctYWdlbnQvIC9ldGMvZGF0YWRvZy1hZ2VudC8gLS1kZWxldGUKClsgISAtZCAvdmFyL3J1bi9kYXRhZG9nIF0gJiYgbWtkaXIgLXAgL3Zhci9ydW4vZGF0YWRvZwoKY2hvd24gZGQtYWdlbnQ6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50LyogL3Zhci9ydW4vZGF0YWRvZwpjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG1vZCAwNjQwIC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zZWN1cml0eS1hZ2VudC55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKCmlmIFsgLWYgIi9vcHQvJHtBUFBfTkFNRX0tY3VycmVudC9TSEEiIF07IHRoZW4KICBTSEE9JChjYXQgL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSkKICBzZWQgLWkgInMvcmVwbGFjZS13aXRoLXNoYS8ke1NIQX0vIiAvZXRjL2RhdGFkb2ctYWdlbnQvZGF0YWRvZy55YW1sCmZpCgpmb3Igc2VydmljZV9uYW1lIGluIGRhdGFkb2ctYWdlbnQgZGF0YWRvZy1hZ2VudC1wcm9jZXNzIGRhdGFkb2ctYWdlbnQtdHJhY2UgZGF0YWRvZy1hZ2VudC1zeXNwcm9iZTsgZG8KICBzZXJ2aWNlICIke3NlcnZpY2VfbmFtZX0iIHJlc3RhcnQgfHwgdGVsbF9zbGFja19vcHMgIiR7c2VydmljZV9uYW1lfSByZXN0YXJ0IGZhaWxlZCIKZG9uZQoKZWNobyAiPj4gcGdib3VuY2VyIENvbmZpZ3VyYXRpb24iCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3VzZXJsaXN0LnR4dCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2hvd24gcG9zdGdyZXM6cG9zdGdyZXMgL2V0Yy9wZ2JvdW5jZXIvdXNlcmxpc3QudHh0CmNobW9kIDYwMCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9wZ2JvdW5jZXIuY210cGwKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vY29uc3VsLXRlbXBsYXRlLmNvbmYgL2V0Yy9jb25zdWwtdGVtcGxhdGUvY29uc3VsLXRlbXBsYXRlLmNvbmYKc2VydmljZSBjb25zdWwtdGVtcGxhdGUgcmVzdGFydApzbGVlcCAxMAoKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgoKZWNobyAiRG93bmxvYWRpbmcgY2F0Zm9vZCBmbGFncyBmcm9tIFMzIgphd3MgczMgY3AgczM6Ly9sYXVuY2hkYXJrbHktY29uZmlncy11cy13ZXN0LTIvY2F0YW1vcnBoaWMvJHtBUFBfTkFNRX0vZmxhZ3MuanNvbiAiL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2ZsYWdzLiR7TERfQVBQX0NPTkZJR30uanNvbiIKCmVjaG8gIlZhbGlkYXRpbmcgZmxhZ3MuanNvbiIKanEgLiAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZmxhZ3MuJHtMRF9BUFBfQ09ORklHfS5qc29uID4vZGV2L251bGwKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1NTQ1ODIzMTc5ODk6Y2VydGlmaWNhdGUtYXV0aG9yaXR5LzhjNmFlNDhjLTA3ZGItNDlmMi04YWE3LWQyN2M2ZWM4MTM0YyIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LmRyLmNhdGFtb3JwaGljLmNvbSIKICBlY2hvICJFbnZpcm9ubWVudD1FWFBMSUNJVF9DTj1nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZ29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgogIGVjaG8gIkV4ZWNTdGFydFBvc3Q9L2Jpbi9zaCAtYyAnY2hvd24gbm9ib2R5Om5vZ3JvdXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMvY2xpZW50LmdvbmZhbG9uLionIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgojIFdlIGRvbid0IHdhbnQgdG8gc3RhcnQgdGhlIGRhdGFkb2cgc2VydmljZSBmb3IgdGhlIHNsYWNrLWFwcApta2RpciAtcCAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1NTQ1ODIzMTc5ODk6Y2VydGlmaWNhdGUtYXV0aG9yaXR5LzhjNmFlNDhjLTA3ZGItNDlmMi04YWE3LWQyN2M2ZWM4MTM0YyIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LmRyLmNhdGFtb3JwaGljLmNvbSIKICBlY2hvICJFbnZpcm9ubWVudD1FWFBMSUNJVF9DTj1kYXRhZG9nIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FPWNsaWVudC5kYXRhZG9nIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UuZC8xMC1jZXJ0LWNvbmZpZy5jb25mCgoKCgpzeXN0ZW1jdGwgZGFlbW9uLXJlbG9hZAoKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZQojIGRpc2FibGUgc2NoZWR1bGVkIHVwZGF0ZXMgYmVjYXVzZSBnb25mYWxvbiB3aWxsIG5vdCByZWxvYWQgdGhlIGNlcnQKIyBieSBhbGxvd2luZyB0aGUgY2VydCB0byByZW1haW4gdW5jaGFuZ2VkLCB3ZSBjYW4gYmUgYWxlcnRlZCB3aGVuIGl0IGlzIGFib3V0IHRvIGV4cGlyZQojIHN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnRpbWVyCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS50aW1lcgoKCgpzZXJ2aWNlICIke0FQUF9OQU1FfSIgcmVzdGFydAoKQVRURU1QVFM9MApNQVhfQVRURU1QVFM9MTIwClBPUlQ9MzAwMAp3aGlsZSBbICRBVFRFTVBUUyAtbmUgJE1BWF9BVFRFTVBUUyBdIDsgZG8KICAgIEFUVEVNUFRTPSQoKEFUVEVNUFRTKzEpKQogICAgZWNobyAiV2FpdGluZyBmb3IgYXBwbGljYXRpb24uLi4gKCR7QVRURU1QVFN9LyR7TUFYX0FUVEVNUFRTfSkiCiAgICBpZiAhIHRpbWVvdXQgMSBiYXNoIC1jICJlY2hvID4vZGV2L3RjcC9sb2NhbGhvc3QvJHtQT1JUfSI7IHRoZW4KICAgICAgICBzbGVlcCAxOwogICAgZWxzZQogICAgICAgIGVjaG8gIkFwcGxpY2F0aW9uIGlzIHJ1bm5pbmcuIgogICAgICAgIGJyZWFrCiAgICBmaQogICAgaWYgWyAkQVRURU1QVFMgLWVxICRNQVhfQVRURU1QVFMgXTsgdGhlbgogICAgICAgIGV4aXQgMTsKICAgIGZpCmRvbmUK",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 300,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "cat-dr",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "catamorphic_dr-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "cat-dr",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-099f2f58a6989f648",
                "sg-0bb94ae14105a685e",
                "sg-0135fb314880b1ed2",
                "sg-02ea8f75835e43ef0",
                "sg-0f797896932ef14f2",
                "sg-0861e5b5a564ce941",
                "sg-02a0127865b74dd85"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "catamorphic_dr-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (catamorphic_dr)",
                "dogfoodCanary": "false",
                "env": "catamorphic_dr",
                "environment": "catamorphic_dr",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-west-2",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "dr"
              },
              "targetGroups": [
                "gonfalon-web-cat-dr",
                "gonfalon-web-internal-cat-dr"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to catamorphic_dr",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-catamorphic_dr@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to catamorphic_dr.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!catamorphic_dr !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id",
            "save_flags_json_us-west-2"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 7200000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "catamorphic_dr"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/managed-catamorphic"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - catamorphic_dr - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-dr deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-dr",
            "text": "${ trigger.user } is done deploying gonfalon-web - catamorphic_dr with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-dr",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"catamorphic_dr\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": null
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - dr",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/production/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.dr.launchdarkly.com/api/status"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-dr deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-dr",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - dr with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-dr",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"dr\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-west-2"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "clusters": [
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-west-2": [
                  "us-west-2a",
                  "us-west-2b",
                  "us-west-2c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1kcgpMRF9BUFBfQ09ORklHPXByb2QKRU5WX1NIT1JUX05BTUU9bGQtZHIKRUMyX0hPU1ROQU1FPSQoaG9zdG5hbWUpClMzX0NPTkZJR1NfQlVDS0VUPWxhdW5jaGRhcmtseS1kci1jb25maWdzCgpTTEFDS19FTkRQT0lOVD0iaHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDAzTlgyNDBXL0JHUTBOVFQxUy9UNkJRdXM2Z2FtTjJwYU4xeGhPVDVUdjUiCnRlbGxfc2xhY2tfY2hhbm5lbCgpIHsKICAgIGNoYW5uZWw9IiQxIgogICAgbWVzc2FnZT0iJDIiCiAgICBjdXJsIFwKICAgICAgICAtLXNpbGVudCBcCiAgICAgICAgLS1zaG93LWVycm9yIFwKICAgICAgICAtLXJlcXVlc3QgUE9TVCBcCiAgICAgICAgLS1oZWFkZXIgJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vanNvbicgXAogICAgICAgIC0tZGF0YSAieydjaGFubmVsJzpcIiR7Y2hhbm5lbH1cIiwgJ3RleHQnOlwiJHttZXNzYWdlfVwifSIgXAogICAgICAgICIke1NMQUNLX0VORFBPSU5UfSIgXAogICAgfHwgZWNobyAiRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSB0byBTbGFjayAjJHtjaGFubmVsfTogJHttZXNzYWdlfSIgPiYyCn0KCnRlbGxfc2xhY2tfb3BzX3JhdygpIHsKICAgIG1lc3NhZ2U9IiQxIgogICAgZWNobyAiPj4gJHttZXNzYWdlfSIgPiYyCiAgICB0ZWxsX3NsYWNrX2NoYW5uZWwgIm9wcy1kciIgIiR7bWVzc2FnZX0iCn0KCnRlbGxfc2xhY2tfb3BzKCkgewogICAgcmF3X21lc3NhZ2U9IiQxIgogICAgbWVzc2FnZT0iJHtFTlZJUk9OTUVOVH0vJHtFQzJfSE9TVE5BTUV9ICgke0FQUF9OQU1FfSk6ICR7cmF3X21lc3NhZ2V9IgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke21lc3NhZ2V9Igp9CiMgcnVuIHRoZSBzc2hfa2V5c19jbGVhbnVwIGNvbW1hbmQgdG8gZW5zdXJlIG5vIHNoYXJlZCBrZXlzIGFyZSBwcmVzZW50CnNzaF9rZXlzX2NsZWFudXAgfHwgdHJ1ZQoKbm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yKCkgewogIHJ2PSQ/CiAgaWYgWyAke3J2fSAtZXEgMCBdOyB0aGVuCiAgICBlY2hvICJBbGwgT0siCiAgZWxzZQogICAgc2VydmljZSAke0FQUF9OQU1FfSBzdG9wIHx8IHRydWUKICAgIEVSUk9SX01TRz0iQ2xvdWQtaW5pdCB1c2VyLWRhdGEgZmFpbGVkIHRvIHN1Y2NlZWQgKGV4aXQgY29kZSAke3J2fSkgb24gaW5zdGFuY2UgJHtFQzJfSE9TVE5BTUV9IGluICR7RU5WSVJPTk1FTlR9LiAgU3RvcHBpbmcgJHtBUFBfTkFNRX0gc28gdGhhdCBpbnN0YW5jZSBkb2VzIG5vdCByZWNlaXZlIGFueSB0cmFmZmljIGFuZCBzbyB0aGF0IGRlcGxveW1lbnQgY2FuIGZhaWwuIgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke0VSUk9SX01TR30iCiAgICBleGl0ICRydgogIGZpCn0KdHJhcCAibm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yIiBJTlQgVEVSTSBFWElUCkVDMl9JTlNUQU5DRV9JRD0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLWlkKQpFQzJfSVBWNF9MT0NBTF9BRERSPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvbG9jYWwtaXB2NCkKRUMyX0FWQUlMQUJJTElUWV9aT05FPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvcGxhY2VtZW50L2F2YWlsYWJpbGl0eS16b25lLykKRUMyX1JFR0lPTj0kKGVjaG8gJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9IHwgc2VkICdzLy4kLy8nKQoKIyBGZXRjaCBgZG9nZm9vZENhbmFyeWAgdGFnIGZvciB0aGlzIGVjMiBpbnN0YW5jZS4gVXNpbmcgYXdzIGNsaSBiZWNhdXNlIFNwaW5uYWtlciBkb2Vzbid0ICh5ZXQpIGhhdmUgYW4gZWFzeSB3YXkgdG8gZW5hYmxlIHRoZSBJbnN0YW5jZU1ldGFkYXRhVGFncyBmZWF0dXJlLgojIFRoaXMgaXMgYSBiZXN0IGVmZm9ydC4gSWYgdGhlIElBTSBwZXJtaXNzaW9ucyBhcmVuJ3Qgc2V0IHVwIGNvcnJlY3RseSwgdGhpcyB3aWxsIHF1aWV0bHkgZmFpbCBhbmQgRE9HRk9PRF9DQU5BUllfRU5BQkxFRCB3aWxsIGJlIHNldCB0byAiZmFsc2UiLgpET0dGT09EX0NBTkFSWV9FTkFCTEVEPSQoYXdzIGVjMiBkZXNjcmliZS10YWdzIC0tZmlsdGVycyAiTmFtZT1yZXNvdXJjZS1pZCxWYWx1ZXM9JHtFQzJfSU5TVEFOQ0VfSUR9IiAiTmFtZT1rZXksVmFsdWVzPWRvZ2Zvb2RDYW5hcnkiIC0tcmVnaW9uICR7RUMyX1JFR0lPTn0gLS1xdWVyeSAnVGFnc1swXS5WYWx1ZScgLS1vdXRwdXQgdGV4dCB8fCB0cnVlKQoKIyBPbmx5IGFsbG93IGVpdGhlciBgdHJ1ZWAgb3IgYGZhbHNlYCB2YWx1ZXMgc28gd2UgZXJyIG9uIHRoZSBzaWRlIG9mIHNldHRpbmcgdGhpcyB0byBmYWxzZS4KaWYgWyAiJHtET0dGT09EX0NBTkFSWV9FTkFCTEVEfSIgIT0gInRydWUiIF07IHRoZW4KCURPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9ImZhbHNlIgpmaQoKIyBUaGlzIGZpbGUgZ2V0cyBwaWNrZWQgdXAgYnkgb3VyIHN5c3RlbWQgc2VydmljZQplY2hvICJET0dGT09EX0NBTkFSWV9FTkFCTEVEPSR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iID4gL29wdC9zeXN0ZW1kZW52CgplY2hvICI+PiBEYXRhZG9nIGFnZW50IGNvbmZpZ3VyYXRpb24iCmF3cyBzMyBzeW5jIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vZGF0YWRvZy1hZ2VudC8gL2V0Yy9kYXRhZG9nLWFnZW50LyAtLWRlbGV0ZQoKWyAhIC1kIC92YXIvcnVuL2RhdGFkb2cgXSAmJiBta2RpciAtcCAvdmFyL3J1bi9kYXRhZG9nCgpjaG93biBkZC1hZ2VudDpkZC1hZ2VudCAvZXRjL2RhdGFkb2ctYWdlbnQvKiAvdmFyL3J1bi9kYXRhZG9nCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKY2htb2QgMDY0MCAvZXRjL2RhdGFkb2ctYWdlbnQvc2VjdXJpdHktYWdlbnQueWFtbAoKaWYgWyAtZiAiL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSIgXTsgdGhlbgogIFNIQT0kKGNhdCAvb3B0LyR7QVBQX05BTUV9LWN1cnJlbnQvU0hBKQogIHNlZCAtaSAicy9yZXBsYWNlLXdpdGgtc2hhLyR7U0hBfS8iIC9ldGMvZGF0YWRvZy1hZ2VudC9kYXRhZG9nLnlhbWwKZmkKCmZvciBzZXJ2aWNlX25hbWUgaW4gZGF0YWRvZy1hZ2VudCBkYXRhZG9nLWFnZW50LXByb2Nlc3MgZGF0YWRvZy1hZ2VudC10cmFjZSBkYXRhZG9nLWFnZW50LXN5c3Byb2JlOyBkbwogIHNlcnZpY2UgIiR7c2VydmljZV9uYW1lfSIgcmVzdGFydCB8fCB0ZWxsX3NsYWNrX29wcyAiJHtzZXJ2aWNlX25hbWV9IHJlc3RhcnQgZmFpbGVkIgpkb25lCgplY2hvICI+PiBwZ2JvdW5jZXIgQ29uZmlndXJhdGlvbiIKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vdXNlcmxpc3QudHh0IC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dApjaG93biBwb3N0Z3Jlczpwb3N0Z3JlcyAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dAoKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vcGdib3VuY2VyLmNtdHBsIC9ldGMvY29uc3VsLXRlbXBsYXRlL3BnYm91bmNlci5jbXRwbAphd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS9nb25mYWxvbi9jb25zdWwtdGVtcGxhdGUuY29uZiAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9jb25zdWwtdGVtcGxhdGUuY29uZgpzZXJ2aWNlIGNvbnN1bC10ZW1wbGF0ZSByZXN0YXJ0CnNsZWVwIDEwCgoKc2VydmljZSBwZ2JvdW5jZXIgcmVzdGFydAoKCmVjaG8gIj4+ICR7QVBQX05BTUV9IEFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb24iCgpjYXNlICR7QVBQX05BTUV9IGluCnN0cmVhbWVyKikKICBDVVJSRU5UX0FQUF9ESVI9c3RyZWFtZXItY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj1zdHJlYW1lcl9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmRhdGEtZXhwb3J0LXRlc3RlcikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9kZWZhdWx0LnltbAogIG12IC9vcHQvZXZlbnQtJHtBUFBfTkFNRX0tY3VycmVudC8gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vCiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgbXYgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX0gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX1fbGludXhfYW1kNjQvJHtBUFBfTkFNRX0KICA7OwoqKQogIENVUlJFTlRfQVBQX0RJUj0ke0FQUF9OQU1FfS1jdXJyZW50CiAgTElOVVhfQU1ENjRfRElSPSR7QVBQX05BTUV9X2xpbnV4X2FtZDY0CiAgQ09ORklHX1BBVEg9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZgogIG1rZGlyIC1wIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9CiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgOzsKZXNhYwoKZWNobyAiPj4gQ3JlYXRpbmcgc2VsZi1zaWduZWQgY2VydGlmaWNhdGUgZm9yIGFwcCB1c2UiCm9wZW5zc2wgcmVxIC1uZXdrZXkgcnNhOjQwOTYgXAogIC14NTA5IFwKICAtc2hhMjU2IFwKICAtZGF5cyAzNjUwIFwKICAtbm9kZXMgXAogIC1vdXQgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQuY3J0IFwKICAta2V5b3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmtleSBcCiAgLXN1YmogIi9DPVVTL1NUPUNBL0w9T2FrbGFuZC9PPUxhdW5jaERhcmtseS9PVT1TZWN1cml0eS9DTj0ke0VDMl9JTlNUQU5DRV9JRH0iCmlmIFsgIC1uICIkKHVuYW1lIC1hIHwgZ3JlcCBVYnVudHUpIiBdOyB0aGVuCiAgY2hvd24gbm9ib2R5IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydAogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkKZmkKCgoKCgplY2hvICI+PiBTeXN0ZW1kIENvbmZpZ3VyYXRpb24iCmFwcF9zM19wcmVmaXg9InMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0iCnN5c3RlbWRfdW5pdF9maWxlPSIvdXNyL2xvY2FsL2xpYi9zeXN0ZW1kL3N5c3RlbS8ke0FQUF9OQU1FfS5zZXJ2aWNlIgpta2RpciAtcCAiJChkaXJuYW1lICIkc3lzdGVtZF91bml0X2ZpbGUiKSIKYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LnN5c3RlbWQuY29uZiIgIiRzeXN0ZW1kX3VuaXRfZmlsZSIKCmlmIGdyZXAgLXFGICdzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiOyB0aGVuCiAgaWYgISBhd3MgczMgY3AgIiRhcHBfczNfcHJlZml4L3NzbS1lbnYtd3JhcHBlci5zaCIgL3Vzci9sb2NhbC9iaW4vc3NtLWVudi13cmFwcGVyLnNoOyB0aGVuCiAgICA+JjIgcHJpbnRmICdFUlJPUjogc3lzdGVtZCB1bml0ICIlcyIgdXNlcyAic3NtLWVudi13cmFwcGVyLnNoIiBidXQgY291bGQgbm90IGRvd25sb2FkIHNzbS1lbnYtd3JhcHBlci5zaCcgIiRzeXN0ZW1kX3VuaXRfZmlsZSIKICAgIGV4aXQgMQogIGZpCiAgY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vc3NtLWVudi13cmFwcGVyLnNoCmZpCgoKZWNobyAiPj4gU2V0IHVwIENvY2tyb2FjaGRiIGNlcnRzIgpta2RpciAtcCAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtd2VzdC0yOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvMmU1YTAwNzAtM2Q1NC00ZmI2LTgzYjQtNTExYzc5MjUxMTU4IgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0uZHIubGF1bmNoZGFya2x5LmNvbSIKICBlY2hvICJFbnZpcm9ubWVudD1FWFBMSUNJVF9DTj1nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZ29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgogIGVjaG8gIkV4ZWNTdGFydFBvc3Q9L2Jpbi9zaCAtYyAnY2hvd24gbm9ib2R5Om5vZ3JvdXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMvY2xpZW50LmdvbmZhbG9uLionIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgojIFdlIGRvbid0IHdhbnQgdG8gc3RhcnQgdGhlIGRhdGFkb2cgc2VydmljZSBmb3IgdGhlIHNsYWNrLWFwcApta2RpciAtcCAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1NTQ1ODIzMTc5ODk6Y2VydGlmaWNhdGUtYXV0aG9yaXR5LzJlNWEwMDcwLTNkNTQtNGZiNi04M2I0LTUxMWM3OTI1MTE1OCIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LmRyLmxhdW5jaGRhcmtseS5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049ZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgoKCgoKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UKIyBkaXNhYmxlIHNjaGVkdWxlZCB1cGRhdGVzIGJlY2F1c2UgZ29uZmFsb24gd2lsbCBub3QgcmVsb2FkIHRoZSBjZXJ0CiMgYnkgYWxsb3dpbmcgdGhlIGNlcnQgdG8gcmVtYWluIHVuY2hhbmdlZCwgd2UgY2FuIGJlIGFsZXJ0ZWQgd2hlbiBpdCBpcyBhYm91dCB0byBleHBpcmUKIyBzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS50aW1lcgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZQpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUudGltZXIKCgoKc2VydmljZSAiJHtBUFBfTkFNRX0iIHJlc3RhcnQKCkFUVEVNUFRTPTAKTUFYX0FUVEVNUFRTPTEyMApQT1JUPTMwMDAKd2hpbGUgWyAkQVRURU1QVFMgLW5lICRNQVhfQVRURU1QVFMgXSA7IGRvCiAgICBBVFRFTVBUUz0kKChBVFRFTVBUUysxKSkKICAgIGVjaG8gIldhaXRpbmcgZm9yIGFwcGxpY2F0aW9uLi4uICgke0FUVEVNUFRTfS8ke01BWF9BVFRFTVBUU30pIgogICAgaWYgISB0aW1lb3V0IDEgYmFzaCAtYyAiZWNobyA+L2Rldi90Y3AvbG9jYWxob3N0LyR7UE9SVH0iOyB0aGVuCiAgICAgICAgc2xlZXAgMTsKICAgIGVsc2UKICAgICAgICBlY2hvICJBcHBsaWNhdGlvbiBpcyBydW5uaW5nLiIKICAgICAgICBicmVhawogICAgZmkKICAgIGlmIFsgJEFUVEVNUFRTIC1lcSAkTUFYX0FUVEVNUFRTIF07IHRoZW4KICAgICAgICBleGl0IDE7CiAgICBmaQpkb25lCgpzeXN0ZW1jdGwgZW5hYmxlIC0tbm93IHN5c3N0YXQuc2VydmljZQo=",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 300,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "dr",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "dr-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "dr",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-06515fdccb31b3403",
                "sg-0b9a28ae566533143",
                "sg-0b4413a5801bdc224",
                "sg-00f1cc0b98c42ddf2",
                "sg-0119b6928126f52e4",
                "sg-0e8a34903e0e72f7a",
                "sg-0e82ca621b91bd7ce"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "dr-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (dr)",
                "dogfoodCanary": "false",
                "env": "dr",
                "environment": "dr",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-west-2",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "dr"
              },
              "targetGroups": [
                "gonfalon-web-dr",
                "gonfalon-web-internal-dr"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to dr",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-dr@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to dr.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!dr !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 7200000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "dr"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/production"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - dr - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-dr deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-dr",
            "text": "${ trigger.user } is done deploying gonfalon-web - dr with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-dr",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"dr\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": null
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - intuit_production",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/production/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.prod.intuit.launchdarkly.com/api/status"
        },
        {
          "method": "POST",
          "name": "Seek #intuit deploy approval",
          "overrideTimeout": true,
          "payload": {
            "channel": "#intuit",
            "text": "${ trigger.user } wants to :deploying: gonfalon-web - intuit_production with version ${ parameters['sha'] }.\nSHA diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] } | See https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } for more information.\n\n:thumbsup: / :thumbsdown:?"
          },
          "refId": "notification_deploy_waiting_for_approval_intuit",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "failPipeline": true,
          "instructions": "Deploying gonfalon-web - intuit_production with version ${ parameters['sha'] }. The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }",
          "judgmentInputs": [],
          "name": "Confirm that deploy should continue",
          "notifications": [
            {
              "address": "deploys",
              "level": "stage",
              "type": "slack",
              "when": [
                "manualJudgment",
                "manualJudgmentContinue",
                "manualJudgmentStop"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "confirm_deployment",
          "requisiteStageRefIds": [
            "notification_deploy_waiting_for_approval_intuit"
          ],
          "sendNotifications": true,
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 3600000,
          "type": "manualJudgment"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #intuit deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#intuit",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - intuit_production with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_intuit",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-intuit deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-intuit",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - intuit_production with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-intuit",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"intuit_production\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-west-2"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version",
            "notification_deploy_waiting_for_approval_intuit",
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-coderefs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "coderefs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for coderefs-crdb",
          "refId": "run_db_migrations_coderefs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-oauth2-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "oauth2-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for oauth2-crdb",
          "refId": "run_db_migrations_oauth2-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for accounts-crdb",
          "refId": "run_db_migrations_accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-accounts-crdb",
          "refId": "run_db_migrations_gonfalon-accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-billing-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-billing-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-billing-crdb",
          "refId": "run_db_migrations_gonfalon-billing-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-integrations-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-integrations-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-integrations-crdb",
          "refId": "run_db_migrations_gonfalon-integrations-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-workflows-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-workflows-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-workflows-crdb",
          "refId": "run_db_migrations_gonfalon-workflows-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "intuit-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-west-2": [
                  "us-west-2a",
                  "us-west-2b",
                  "us-west-2c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1pbnR1aXRfcHJvZHVjdGlvbgpMRF9BUFBfQ09ORklHPW1hbmFnZWQtaW50dWl0X3Byb2R1Y3Rpb24KRU5WX1NIT1JUX05BTUU9aW50LXByZApFQzJfSE9TVE5BTUU9JChob3N0bmFtZSkKUzNfQ09ORklHU19CVUNLRVQ9bGF1bmNoZGFya2x5LWludHVpdC1jb25maWdzCgpTTEFDS19FTkRQT0lOVD0iaHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDAzTlgyNDBXL0JHUTBOVFQxUy9UNkJRdXM2Z2FtTjJwYU4xeGhPVDVUdjUiCnRlbGxfc2xhY2tfY2hhbm5lbCgpIHsKICAgIGNoYW5uZWw9IiQxIgogICAgbWVzc2FnZT0iJDIiCiAgICBjdXJsIFwKICAgICAgICAtLXNpbGVudCBcCiAgICAgICAgLS1zaG93LWVycm9yIFwKICAgICAgICAtLXJlcXVlc3QgUE9TVCBcCiAgICAgICAgLS1oZWFkZXIgJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vanNvbicgXAogICAgICAgIC0tZGF0YSAieydjaGFubmVsJzpcIiR7Y2hhbm5lbH1cIiwgJ3RleHQnOlwiJHttZXNzYWdlfVwifSIgXAogICAgICAgICIke1NMQUNLX0VORFBPSU5UfSIgXAogICAgfHwgZWNobyAiRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSB0byBTbGFjayAjJHtjaGFubmVsfTogJHttZXNzYWdlfSIgPiYyCn0KCnRlbGxfc2xhY2tfb3BzX3JhdygpIHsKICAgIG1lc3NhZ2U9IiQxIgogICAgZWNobyAiPj4gJHttZXNzYWdlfSIgPiYyCiAgICB0ZWxsX3NsYWNrX2NoYW5uZWwgIm9wcy1pbnR1aXQiICIke21lc3NhZ2V9Igp9Cgp0ZWxsX3NsYWNrX29wcygpIHsKICAgIHJhd19tZXNzYWdlPSIkMSIKICAgIG1lc3NhZ2U9IiR7RU5WSVJPTk1FTlR9LyR7RUMyX0hPU1ROQU1FfSAoJHtBUFBfTkFNRX0pOiAke3Jhd19tZXNzYWdlfSIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHttZXNzYWdlfSIKfQojIHJ1biB0aGUgc3NoX2tleXNfY2xlYW51cCBjb21tYW5kIHRvIGVuc3VyZSBubyBzaGFyZWQga2V5cyBhcmUgcHJlc2VudApzc2hfa2V5c19jbGVhbnVwIHx8IHRydWUKCm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvcigpIHsKICBydj0kPwogIGlmIFsgJHtydn0gLWVxIDAgXTsgdGhlbgogICAgZWNobyAiQWxsIE9LIgogIGVsc2UKICAgIHNlcnZpY2UgJHtBUFBfTkFNRX0gc3RvcCB8fCB0cnVlCiAgICBFUlJPUl9NU0c9IkNsb3VkLWluaXQgdXNlci1kYXRhIGZhaWxlZCB0byBzdWNjZWVkIChleGl0IGNvZGUgJHtydn0pIG9uIGluc3RhbmNlICR7RUMyX0hPU1ROQU1FfSBpbiAke0VOVklST05NRU5UfS4gIFN0b3BwaW5nICR7QVBQX05BTUV9IHNvIHRoYXQgaW5zdGFuY2UgZG9lcyBub3QgcmVjZWl2ZSBhbnkgdHJhZmZpYyBhbmQgc28gdGhhdCBkZXBsb3ltZW50IGNhbiBmYWlsLiIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHtFUlJPUl9NU0d9IgogICAgZXhpdCAkcnYKICBmaQp9CnRyYXAgIm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvciIgSU5UIFRFUk0gRVhJVApFQzJfSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKRUMyX0lQVjRfTE9DQUxfQUREUj0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCkVDMl9BVkFJTEFCSUxJVFlfWk9ORT0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL3BsYWNlbWVudC9hdmFpbGFiaWxpdHktem9uZS8pCkVDMl9SRUdJT049JChlY2hvICR7RUMyX0FWQUlMQUJJTElUWV9aT05FfSB8IHNlZCAncy8uJC8vJykKCiMgRmV0Y2ggYGRvZ2Zvb2RDYW5hcnlgIHRhZyBmb3IgdGhpcyBlYzIgaW5zdGFuY2UuIFVzaW5nIGF3cyBjbGkgYmVjYXVzZSBTcGlubmFrZXIgZG9lc24ndCAoeWV0KSBoYXZlIGFuIGVhc3kgd2F5IHRvIGVuYWJsZSB0aGUgSW5zdGFuY2VNZXRhZGF0YVRhZ3MgZmVhdHVyZS4KIyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQuIElmIHRoZSBJQU0gcGVybWlzc2lvbnMgYXJlbid0IHNldCB1cCBjb3JyZWN0bHksIHRoaXMgd2lsbCBxdWlldGx5IGZhaWwgYW5kIERPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQgd2lsbCBiZSBzZXQgdG8gImZhbHNlIi4KRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0kKGF3cyBlYzIgZGVzY3JpYmUtdGFncyAtLWZpbHRlcnMgIk5hbWU9cmVzb3VyY2UtaWQsVmFsdWVzPSR7RUMyX0lOU1RBTkNFX0lEfSIgIk5hbWU9a2V5LFZhbHVlcz1kb2dmb29kQ2FuYXJ5IiAtLXJlZ2lvbiAke0VDMl9SRUdJT059IC0tcXVlcnkgJ1RhZ3NbMF0uVmFsdWUnIC0tb3V0cHV0IHRleHQgfHwgdHJ1ZSkKCiMgT25seSBhbGxvdyBlaXRoZXIgYHRydWVgIG9yIGBmYWxzZWAgdmFsdWVzIHNvIHdlIGVyciBvbiB0aGUgc2lkZSBvZiBzZXR0aW5nIHRoaXMgdG8gZmFsc2UuCmlmIFsgIiR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iICE9ICJ0cnVlIiBdOyB0aGVuCglET0dGT09EX0NBTkFSWV9FTkFCTEVEPSJmYWxzZSIKZmkKCiMgVGhpcyBmaWxlIGdldHMgcGlja2VkIHVwIGJ5IG91ciBzeXN0ZW1kIHNlcnZpY2UKZWNobyAiRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0ke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiA+IC9vcHQvc3lzdGVtZGVudgoKCktJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQ9InZwY2UtMGM4ZTg4NjdmZWE3N2YzM2MtaXQ0dnplcTMtJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9LmZpcmVob3NlLnVzLXdlc3QtMi52cGNlLmFtYXpvbmF3cy5jb20iCgpLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVD0idnBjZS0wMWU3ZWFjOGYwNzE3ZDc2ZS10NGVyN3poci0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0ua2luZXNpcy51cy13ZXN0LTIudnBjZS5hbWF6b25hd3MuY29tIgoKZWNobyAiPj4gRGF0YWRvZyBhZ2VudCBjb25maWd1cmF0aW9uIgphd3MgczMgc3luYyBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2RhdGFkb2ctYWdlbnQvIC9ldGMvZGF0YWRvZy1hZ2VudC8gLS1kZWxldGUKClsgISAtZCAvdmFyL3J1bi9kYXRhZG9nIF0gJiYgbWtkaXIgLXAgL3Zhci9ydW4vZGF0YWRvZwoKY2hvd24gZGQtYWdlbnQ6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50LyogL3Zhci9ydW4vZGF0YWRvZwpjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG1vZCAwNjQwIC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zZWN1cml0eS1hZ2VudC55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKCmlmIFsgLWYgIi9vcHQvJHtBUFBfTkFNRX0tY3VycmVudC9TSEEiIF07IHRoZW4KICBTSEE9JChjYXQgL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSkKICBzZWQgLWkgInMvcmVwbGFjZS13aXRoLXNoYS8ke1NIQX0vIiAvZXRjL2RhdGFkb2ctYWdlbnQvZGF0YWRvZy55YW1sCmZpCgpmb3Igc2VydmljZV9uYW1lIGluIGRhdGFkb2ctYWdlbnQgZGF0YWRvZy1hZ2VudC1wcm9jZXNzIGRhdGFkb2ctYWdlbnQtdHJhY2UgZGF0YWRvZy1hZ2VudC1zeXNwcm9iZTsgZG8KICBzZXJ2aWNlICIke3NlcnZpY2VfbmFtZX0iIHJlc3RhcnQgfHwgdGVsbF9zbGFja19vcHMgIiR7c2VydmljZV9uYW1lfSByZXN0YXJ0IGZhaWxlZCIKZG9uZQoKZWNobyAiPj4gcGdib3VuY2VyIENvbmZpZ3VyYXRpb24iCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3VzZXJsaXN0LnR4dCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2hvd24gcG9zdGdyZXM6cG9zdGdyZXMgL2V0Yy9wZ2JvdW5jZXIvdXNlcmxpc3QudHh0CmNobW9kIDYwMCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9wZ2JvdW5jZXIuY210cGwKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vY29uc3VsLXRlbXBsYXRlLmNvbmYgL2V0Yy9jb25zdWwtdGVtcGxhdGUvY29uc3VsLXRlbXBsYXRlLmNvbmYKc2VydmljZSBjb25zdWwtdGVtcGxhdGUgcmVzdGFydApzbGVlcCAxMAoKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgojIFNldCBLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UIGFuZCBLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVApzZWQgLWkgInMvS0lORVNJU19TVFJFQU1fRU5EUE9JTlQvJHtLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVH0vZyIgIiRDT05GSUdfUEFUSCIKc2VkIC1pICJzL0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQvJHtLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgoKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1MjcyOTEwOTQ0NjA6Y2VydGlmaWNhdGUtYXV0aG9yaXR5L2Q1ZmZjODZkLWUwMzUtNDI5Yi1hYjM2LWJmMjJkYmU2MTQxYyIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnByb2QuaW50dWl0LmxhdW5jaGRhcmtseS5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049Z29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKICBlY2hvICJFeGVjU3RhcnRQb3N0PS9iaW4vc2ggLWMgJ2Nob3duIG5vYm9keTpub2dyb3VwIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzL2NsaWVudC5nb25mYWxvbi4qJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKIyBXZSBkb24ndCB3YW50IHRvIHN0YXJ0IHRoZSBkYXRhZG9nIHNlcnZpY2UgZm9yIHRoZSBzbGFjay1hcHAKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy13ZXN0LTI6NTI3MjkxMDk0NDYwOmNlcnRpZmljYXRlLWF1dGhvcml0eS9kNWZmYzg2ZC1lMDM1LTQyOWItYWIzNi1iZjIyZGJlNjE0MWMiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5wcm9kLmludHVpdC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKCgoKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCiMgZGlzYWJsZSBzY2hlZHVsZWQgdXBkYXRlcyBiZWNhdXNlIGdvbmZhbG9uIHdpbGwgbm90IHJlbG9hZCB0aGUgY2VydAojIGJ5IGFsbG93aW5nIHRoZSBjZXJ0IHRvIHJlbWFpbiB1bmNoYW5nZWQsIHdlIGNhbiBiZSBhbGVydGVkIHdoZW4gaXQgaXMgYWJvdXQgdG8gZXhwaXJlCiMgc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUudGltZXIKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnRpbWVyCgoKCnNlcnZpY2UgIiR7QVBQX05BTUV9IiByZXN0YXJ0CgpBVFRFTVBUUz0wCk1BWF9BVFRFTVBUUz0xMjAKUE9SVD0zMDAwCndoaWxlIFsgJEFUVEVNUFRTIC1uZSAkTUFYX0FUVEVNUFRTIF0gOyBkbwogICAgQVRURU1QVFM9JCgoQVRURU1QVFMrMSkpCiAgICBlY2hvICJXYWl0aW5nIGZvciBhcHBsaWNhdGlvbi4uLiAoJHtBVFRFTVBUU30vJHtNQVhfQVRURU1QVFN9KSIKICAgIGlmICEgdGltZW91dCAxIGJhc2ggLWMgImVjaG8gPi9kZXYvdGNwL2xvY2FsaG9zdC8ke1BPUlR9IjsgdGhlbgogICAgICAgIHNsZWVwIDE7CiAgICBlbHNlCiAgICAgICAgZWNobyAiQXBwbGljYXRpb24gaXMgcnVubmluZy4iCiAgICAgICAgYnJlYWsKICAgIGZpCiAgICBpZiBbICRBVFRFTVBUUyAtZXEgJE1BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgICAgZXhpdCAxOwogICAgZmkKZG9uZQoKc3lzdGVtY3RsIGVuYWJsZSAtLW5vdyBzeXNzdGF0LnNlcnZpY2UK",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "int-prd",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "intuit_production-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "int-prd",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-af99f0d0",
                "sg-3f1f8d45",
                "sg-b30261c3",
                "sg-07c3c9da1900da928",
                "sg-22f66e58",
                "sg-2630ae5c",
                "sg-21f36b5b",
                "sg-0f7b85f2e582250a5",
                "sg-01f54be78932eda9f",
                "sg-08c617a04f46224a0",
                "sg-04b276c4262b8143b",
                "sg-0a9bcc49dfe8ec3a0"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "production-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (intuit_production)",
                "dogfoodCanary": "false",
                "env": "intuit_production",
                "environment": "intuit_production",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-west-2",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "production"
              },
              "targetGroups": [
                "gonfalon-web-int-prd",
                "gonfalon-web-internal-int-prd"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            },
            {
              "account": "intuit-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-west-2": [
                  "us-west-2a"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1pbnR1aXRfcHJvZHVjdGlvbgpMRF9BUFBfQ09ORklHPW1hbmFnZWQtaW50dWl0X3Byb2R1Y3Rpb24KRU5WX1NIT1JUX05BTUU9aW50LXByZApFQzJfSE9TVE5BTUU9JChob3N0bmFtZSkKUzNfQ09ORklHU19CVUNLRVQ9bGF1bmNoZGFya2x5LWludHVpdC1jb25maWdzCgpTTEFDS19FTkRQT0lOVD0iaHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDAzTlgyNDBXL0JHUTBOVFQxUy9UNkJRdXM2Z2FtTjJwYU4xeGhPVDVUdjUiCnRlbGxfc2xhY2tfY2hhbm5lbCgpIHsKICAgIGNoYW5uZWw9IiQxIgogICAgbWVzc2FnZT0iJDIiCiAgICBjdXJsIFwKICAgICAgICAtLXNpbGVudCBcCiAgICAgICAgLS1zaG93LWVycm9yIFwKICAgICAgICAtLXJlcXVlc3QgUE9TVCBcCiAgICAgICAgLS1oZWFkZXIgJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vanNvbicgXAogICAgICAgIC0tZGF0YSAieydjaGFubmVsJzpcIiR7Y2hhbm5lbH1cIiwgJ3RleHQnOlwiJHttZXNzYWdlfVwifSIgXAogICAgICAgICIke1NMQUNLX0VORFBPSU5UfSIgXAogICAgfHwgZWNobyAiRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSB0byBTbGFjayAjJHtjaGFubmVsfTogJHttZXNzYWdlfSIgPiYyCn0KCnRlbGxfc2xhY2tfb3BzX3JhdygpIHsKICAgIG1lc3NhZ2U9IiQxIgogICAgZWNobyAiPj4gJHttZXNzYWdlfSIgPiYyCiAgICB0ZWxsX3NsYWNrX2NoYW5uZWwgIm9wcy1pbnR1aXQiICIke21lc3NhZ2V9Igp9Cgp0ZWxsX3NsYWNrX29wcygpIHsKICAgIHJhd19tZXNzYWdlPSIkMSIKICAgIG1lc3NhZ2U9IiR7RU5WSVJPTk1FTlR9LyR7RUMyX0hPU1ROQU1FfSAoJHtBUFBfTkFNRX0pOiAke3Jhd19tZXNzYWdlfSIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHttZXNzYWdlfSIKfQojIHJ1biB0aGUgc3NoX2tleXNfY2xlYW51cCBjb21tYW5kIHRvIGVuc3VyZSBubyBzaGFyZWQga2V5cyBhcmUgcHJlc2VudApzc2hfa2V5c19jbGVhbnVwIHx8IHRydWUKCm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvcigpIHsKICBydj0kPwogIGlmIFsgJHtydn0gLWVxIDAgXTsgdGhlbgogICAgZWNobyAiQWxsIE9LIgogIGVsc2UKICAgIHNlcnZpY2UgJHtBUFBfTkFNRX0gc3RvcCB8fCB0cnVlCiAgICBFUlJPUl9NU0c9IkNsb3VkLWluaXQgdXNlci1kYXRhIGZhaWxlZCB0byBzdWNjZWVkIChleGl0IGNvZGUgJHtydn0pIG9uIGluc3RhbmNlICR7RUMyX0hPU1ROQU1FfSBpbiAke0VOVklST05NRU5UfS4gIFN0b3BwaW5nICR7QVBQX05BTUV9IHNvIHRoYXQgaW5zdGFuY2UgZG9lcyBub3QgcmVjZWl2ZSBhbnkgdHJhZmZpYyBhbmQgc28gdGhhdCBkZXBsb3ltZW50IGNhbiBmYWlsLiIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHtFUlJPUl9NU0d9IgogICAgZXhpdCAkcnYKICBmaQp9CnRyYXAgIm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvciIgSU5UIFRFUk0gRVhJVApFQzJfSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKRUMyX0lQVjRfTE9DQUxfQUREUj0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCkVDMl9BVkFJTEFCSUxJVFlfWk9ORT0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL3BsYWNlbWVudC9hdmFpbGFiaWxpdHktem9uZS8pCkVDMl9SRUdJT049JChlY2hvICR7RUMyX0FWQUlMQUJJTElUWV9aT05FfSB8IHNlZCAncy8uJC8vJykKCiMgRmV0Y2ggYGRvZ2Zvb2RDYW5hcnlgIHRhZyBmb3IgdGhpcyBlYzIgaW5zdGFuY2UuIFVzaW5nIGF3cyBjbGkgYmVjYXVzZSBTcGlubmFrZXIgZG9lc24ndCAoeWV0KSBoYXZlIGFuIGVhc3kgd2F5IHRvIGVuYWJsZSB0aGUgSW5zdGFuY2VNZXRhZGF0YVRhZ3MgZmVhdHVyZS4KIyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQuIElmIHRoZSBJQU0gcGVybWlzc2lvbnMgYXJlbid0IHNldCB1cCBjb3JyZWN0bHksIHRoaXMgd2lsbCBxdWlldGx5IGZhaWwgYW5kIERPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQgd2lsbCBiZSBzZXQgdG8gImZhbHNlIi4KRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0kKGF3cyBlYzIgZGVzY3JpYmUtdGFncyAtLWZpbHRlcnMgIk5hbWU9cmVzb3VyY2UtaWQsVmFsdWVzPSR7RUMyX0lOU1RBTkNFX0lEfSIgIk5hbWU9a2V5LFZhbHVlcz1kb2dmb29kQ2FuYXJ5IiAtLXJlZ2lvbiAke0VDMl9SRUdJT059IC0tcXVlcnkgJ1RhZ3NbMF0uVmFsdWUnIC0tb3V0cHV0IHRleHQgfHwgdHJ1ZSkKCiMgT25seSBhbGxvdyBlaXRoZXIgYHRydWVgIG9yIGBmYWxzZWAgdmFsdWVzIHNvIHdlIGVyciBvbiB0aGUgc2lkZSBvZiBzZXR0aW5nIHRoaXMgdG8gZmFsc2UuCmlmIFsgIiR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iICE9ICJ0cnVlIiBdOyB0aGVuCglET0dGT09EX0NBTkFSWV9FTkFCTEVEPSJmYWxzZSIKZmkKCiMgVGhpcyBmaWxlIGdldHMgcGlja2VkIHVwIGJ5IG91ciBzeXN0ZW1kIHNlcnZpY2UKZWNobyAiRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0ke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiA+IC9vcHQvc3lzdGVtZGVudgoKCktJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQ9InZwY2UtMGM4ZTg4NjdmZWE3N2YzM2MtaXQ0dnplcTMtJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9LmZpcmVob3NlLnVzLXdlc3QtMi52cGNlLmFtYXpvbmF3cy5jb20iCgpLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVD0idnBjZS0wMWU3ZWFjOGYwNzE3ZDc2ZS10NGVyN3poci0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0ua2luZXNpcy51cy13ZXN0LTIudnBjZS5hbWF6b25hd3MuY29tIgoKZWNobyAiPj4gRGF0YWRvZyBhZ2VudCBjb25maWd1cmF0aW9uIgphd3MgczMgc3luYyBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2RhdGFkb2ctYWdlbnQvIC9ldGMvZGF0YWRvZy1hZ2VudC8gLS1kZWxldGUKClsgISAtZCAvdmFyL3J1bi9kYXRhZG9nIF0gJiYgbWtkaXIgLXAgL3Zhci9ydW4vZGF0YWRvZwoKY2hvd24gZGQtYWdlbnQ6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50LyogL3Zhci9ydW4vZGF0YWRvZwpjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG1vZCAwNjQwIC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zZWN1cml0eS1hZ2VudC55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKCmlmIFsgLWYgIi9vcHQvJHtBUFBfTkFNRX0tY3VycmVudC9TSEEiIF07IHRoZW4KICBTSEE9JChjYXQgL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSkKICBzZWQgLWkgInMvcmVwbGFjZS13aXRoLXNoYS8ke1NIQX0vIiAvZXRjL2RhdGFkb2ctYWdlbnQvZGF0YWRvZy55YW1sCmZpCgpmb3Igc2VydmljZV9uYW1lIGluIGRhdGFkb2ctYWdlbnQgZGF0YWRvZy1hZ2VudC1wcm9jZXNzIGRhdGFkb2ctYWdlbnQtdHJhY2UgZGF0YWRvZy1hZ2VudC1zeXNwcm9iZTsgZG8KICBzZXJ2aWNlICIke3NlcnZpY2VfbmFtZX0iIHJlc3RhcnQgfHwgdGVsbF9zbGFja19vcHMgIiR7c2VydmljZV9uYW1lfSByZXN0YXJ0IGZhaWxlZCIKZG9uZQoKZWNobyAiPj4gcGdib3VuY2VyIENvbmZpZ3VyYXRpb24iCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3VzZXJsaXN0LnR4dCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2hvd24gcG9zdGdyZXM6cG9zdGdyZXMgL2V0Yy9wZ2JvdW5jZXIvdXNlcmxpc3QudHh0CmNobW9kIDYwMCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9wZ2JvdW5jZXIuY210cGwKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vY29uc3VsLXRlbXBsYXRlLmNvbmYgL2V0Yy9jb25zdWwtdGVtcGxhdGUvY29uc3VsLXRlbXBsYXRlLmNvbmYKc2VydmljZSBjb25zdWwtdGVtcGxhdGUgcmVzdGFydApzbGVlcCAxMAoKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgojIFNldCBLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UIGFuZCBLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVApzZWQgLWkgInMvS0lORVNJU19TVFJFQU1fRU5EUE9JTlQvJHtLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVH0vZyIgIiRDT05GSUdfUEFUSCIKc2VkIC1pICJzL0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQvJHtLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgoKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1MjcyOTEwOTQ0NjA6Y2VydGlmaWNhdGUtYXV0aG9yaXR5L2Q1ZmZjODZkLWUwMzUtNDI5Yi1hYjM2LWJmMjJkYmU2MTQxYyIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnByb2QuaW50dWl0LmxhdW5jaGRhcmtseS5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049Z29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKICBlY2hvICJFeGVjU3RhcnRQb3N0PS9iaW4vc2ggLWMgJ2Nob3duIG5vYm9keTpub2dyb3VwIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzL2NsaWVudC5nb25mYWxvbi4qJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKIyBXZSBkb24ndCB3YW50IHRvIHN0YXJ0IHRoZSBkYXRhZG9nIHNlcnZpY2UgZm9yIHRoZSBzbGFjay1hcHAKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy13ZXN0LTI6NTI3MjkxMDk0NDYwOmNlcnRpZmljYXRlLWF1dGhvcml0eS9kNWZmYzg2ZC1lMDM1LTQyOWItYWIzNi1iZjIyZGJlNjE0MWMiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5wcm9kLmludHVpdC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKCgoKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCiMgZGlzYWJsZSBzY2hlZHVsZWQgdXBkYXRlcyBiZWNhdXNlIGdvbmZhbG9uIHdpbGwgbm90IHJlbG9hZCB0aGUgY2VydAojIGJ5IGFsbG93aW5nIHRoZSBjZXJ0IHRvIHJlbWFpbiB1bmNoYW5nZWQsIHdlIGNhbiBiZSBhbGVydGVkIHdoZW4gaXQgaXMgYWJvdXQgdG8gZXhwaXJlCiMgc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUudGltZXIKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnRpbWVyCgoKCnNlcnZpY2UgIiR7QVBQX05BTUV9IiByZXN0YXJ0CgpBVFRFTVBUUz0wCk1BWF9BVFRFTVBUUz0xMjAKUE9SVD0zMDAwCndoaWxlIFsgJEFUVEVNUFRTIC1uZSAkTUFYX0FUVEVNUFRTIF0gOyBkbwogICAgQVRURU1QVFM9JCgoQVRURU1QVFMrMSkpCiAgICBlY2hvICJXYWl0aW5nIGZvciBhcHBsaWNhdGlvbi4uLiAoJHtBVFRFTVBUU30vJHtNQVhfQVRURU1QVFN9KSIKICAgIGlmICEgdGltZW91dCAxIGJhc2ggLWMgImVjaG8gPi9kZXYvdGNwL2xvY2FsaG9zdC8ke1BPUlR9IjsgdGhlbgogICAgICAgIHNsZWVwIDE7CiAgICBlbHNlCiAgICAgICAgZWNobyAiQXBwbGljYXRpb24gaXMgcnVubmluZy4iCiAgICAgICAgYnJlYWsKICAgIGZpCiAgICBpZiBbICRBVFRFTVBUUyAtZXEgJE1BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgICAgZXhpdCAxOwogICAgZmkKZG9uZQoKc3lzdGVtY3RsIGVuYWJsZSAtLW5vdyBzeXNzdGF0LnNlcnZpY2UK",
              "capacity": {
                "desired": 1,
                "max": 1,
                "min": 1
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "int-prd-dogfood-canary",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "intuit_production-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "int-prd",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-af99f0d0",
                "sg-3f1f8d45",
                "sg-b30261c3",
                "sg-07c3c9da1900da928",
                "sg-22f66e58",
                "sg-2630ae5c",
                "sg-21f36b5b",
                "sg-0f7b85f2e582250a5",
                "sg-01f54be78932eda9f",
                "sg-08c617a04f46224a0",
                "sg-04b276c4262b8143b",
                "sg-0a9bcc49dfe8ec3a0"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "production-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (intuit_production)",
                "dogfoodCanary": "true",
                "env": "intuit_production",
                "environment": "intuit_production",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-west-2",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "production"
              },
              "targetGroups": [
                "gonfalon-web-int-prd",
                "gonfalon-web-internal-int-prd"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to intuit_production",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-intuit_production@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to intuit_production.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!intuit_production !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id",
            "run_db_migrations_coderefs-crdb",
            "run_db_migrations_oauth2-crdb",
            "run_db_migrations_accounts-crdb",
            "run_db_migrations_gonfalon-accounts-crdb",
            "run_db_migrations_gonfalon-billing-crdb",
            "run_db_migrations_gonfalon-integrations-crdb",
            "run_db_migrations_gonfalon-workflows-crdb"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 7200000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "intuit_production"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/managed-intuit_production"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - intuit_production - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"managed-intuit-prod\",\n  \"eventType\": \"started\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate started notification",
          "refId": "accelerate_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"managed-intuit-prod\",\n  \"eventType\": \"finished\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate finished notification",
          "refId": "accelerate_finished",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #intuit deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#intuit",
            "text": "${ trigger.user } is done deploying gonfalon-web - intuit_production with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_intuit",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-intuit deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-intuit",
            "text": "${ trigger.user } is done deploying gonfalon-web - intuit_production with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-intuit",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"intuit_production\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": null
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - intuit_production_dr",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/production/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.prod-dr.intuit.launchdarkly.com/api/status"
        },
        {
          "method": "POST",
          "name": "Seek #intuit deploy approval",
          "overrideTimeout": true,
          "payload": {
            "channel": "#intuit",
            "text": "${ trigger.user } wants to :deploying: gonfalon-web - intuit_production_dr with version ${ parameters['sha'] }.\nSHA diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] } | See https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } for more information.\n\n:thumbsup: / :thumbsdown:?"
          },
          "refId": "notification_deploy_waiting_for_approval_intuit",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "failPipeline": true,
          "instructions": "Deploying gonfalon-web - intuit_production_dr with version ${ parameters['sha'] }. The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }",
          "judgmentInputs": [],
          "name": "Confirm that deploy should continue",
          "notifications": [
            {
              "address": "deploys",
              "level": "stage",
              "type": "slack",
              "when": [
                "manualJudgment",
                "manualJudgmentContinue",
                "manualJudgmentStop"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "confirm_deployment",
          "requisiteStageRefIds": [
            "notification_deploy_waiting_for_approval_intuit"
          ],
          "sendNotifications": true,
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 3600000,
          "type": "manualJudgment"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #intuit deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#intuit",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - intuit_production_dr with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_intuit",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-dr deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-dr",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - intuit_production_dr with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-dr",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"intuit_production_dr\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-east-2"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version",
            "notification_deploy_waiting_for_approval_intuit",
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-coderefs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "coderefs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for coderefs-crdb",
          "refId": "run_db_migrations_coderefs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-oauth2-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "oauth2-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for oauth2-crdb",
          "refId": "run_db_migrations_oauth2-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for accounts-crdb",
          "refId": "run_db_migrations_accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-accounts-crdb",
          "refId": "run_db_migrations_gonfalon-accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-billing-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-billing-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-billing-crdb",
          "refId": "run_db_migrations_gonfalon-billing-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-integrations-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-integrations-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-integrations-crdb",
          "refId": "run_db_migrations_gonfalon-integrations-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-workflows-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-workflows-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-workflows-crdb",
          "refId": "run_db_migrations_gonfalon-workflows-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "intuit-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-2": [
                  "us-east-2a",
                  "us-east-2b",
                  "us-east-2c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1pbnR1aXRfcHJvZHVjdGlvbl9kcgpMRF9BUFBfQ09ORklHPW1hbmFnZWQtaW50dWl0X3Byb2R1Y3Rpb24KRU5WX1NIT1JUX05BTUU9ZHIKRUMyX0hPU1ROQU1FPSQoaG9zdG5hbWUpClMzX0NPTkZJR1NfQlVDS0VUPWxhdW5jaGRhcmtseS1pbnR1aXQtY29uZmlncy11cy1lYXN0LTIKClNMQUNLX0VORFBPSU5UPSJodHRwczovL2hvb2tzLnNsYWNrLmNvbS9zZXJ2aWNlcy9UMDNOWDI0MFcvQkdRME5UVDFTL1Q2QlF1czZnYW1OMnBhTjF4aE9UNVR2NSIKdGVsbF9zbGFja19jaGFubmVsKCkgewogICAgY2hhbm5lbD0iJDEiCiAgICBtZXNzYWdlPSIkMiIKICAgIGN1cmwgXAogICAgICAgIC0tc2lsZW50IFwKICAgICAgICAtLXNob3ctZXJyb3IgXAogICAgICAgIC0tcmVxdWVzdCBQT1NUIFwKICAgICAgICAtLWhlYWRlciAnQ29udGVudC10eXBlOiBhcHBsaWNhdGlvbi9qc29uJyBcCiAgICAgICAgLS1kYXRhICJ7J2NoYW5uZWwnOlwiJHtjaGFubmVsfVwiLCAndGV4dCc6XCIke21lc3NhZ2V9XCJ9IiBcCiAgICAgICAgIiR7U0xBQ0tfRU5EUE9JTlR9IiBcCiAgICB8fCBlY2hvICJGYWlsZWQgdG8gc2VuZCBtZXNzYWdlIHRvIFNsYWNrICMke2NoYW5uZWx9OiAke21lc3NhZ2V9IiA+JjIKfQoKdGVsbF9zbGFja19vcHNfcmF3KCkgewogICAgbWVzc2FnZT0iJDEiCiAgICBlY2hvICI+PiAke21lc3NhZ2V9IiA+JjIKICAgIHRlbGxfc2xhY2tfY2hhbm5lbCAib3BzLWRyIiAiJHttZXNzYWdlfSIKfQoKdGVsbF9zbGFja19vcHMoKSB7CiAgICByYXdfbWVzc2FnZT0iJDEiCiAgICBtZXNzYWdlPSIke0VOVklST05NRU5UfS8ke0VDMl9IT1NUTkFNRX0gKCR7QVBQX05BTUV9KTogJHtyYXdfbWVzc2FnZX0iCiAgICB0ZWxsX3NsYWNrX29wc19yYXcgIiR7bWVzc2FnZX0iCn0KIyBydW4gdGhlIHNzaF9rZXlzX2NsZWFudXAgY29tbWFuZCB0byBlbnN1cmUgbm8gc2hhcmVkIGtleXMgYXJlIHByZXNlbnQKc3NoX2tleXNfY2xlYW51cCB8fCB0cnVlCgpub3RpZnlfdGhhdF93ZV9oaXRfYW5fZXJyb3IoKSB7CiAgcnY9JD8KICBpZiBbICR7cnZ9IC1lcSAwIF07IHRoZW4KICAgIGVjaG8gIkFsbCBPSyIKICBlbHNlCiAgICBzZXJ2aWNlICR7QVBQX05BTUV9IHN0b3AgfHwgdHJ1ZQogICAgRVJST1JfTVNHPSJDbG91ZC1pbml0IHVzZXItZGF0YSBmYWlsZWQgdG8gc3VjY2VlZCAoZXhpdCBjb2RlICR7cnZ9KSBvbiBpbnN0YW5jZSAke0VDMl9IT1NUTkFNRX0gaW4gJHtFTlZJUk9OTUVOVH0uICBTdG9wcGluZyAke0FQUF9OQU1FfSBzbyB0aGF0IGluc3RhbmNlIGRvZXMgbm90IHJlY2VpdmUgYW55IHRyYWZmaWMgYW5kIHNvIHRoYXQgZGVwbG95bWVudCBjYW4gZmFpbC4iCiAgICB0ZWxsX3NsYWNrX29wc19yYXcgIiR7RVJST1JfTVNHfSIKICAgIGV4aXQgJHJ2CiAgZmkKfQp0cmFwICJub3RpZnlfdGhhdF93ZV9oaXRfYW5fZXJyb3IiIElOVCBURVJNIEVYSVQKRUMyX0lOU1RBTkNFX0lEPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvaW5zdGFuY2UtaWQpCkVDMl9JUFY0X0xPQ0FMX0FERFI9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9sb2NhbC1pcHY0KQpFQzJfQVZBSUxBQklMSVRZX1pPTkU9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9wbGFjZW1lbnQvYXZhaWxhYmlsaXR5LXpvbmUvKQpFQzJfUkVHSU9OPSQoZWNobyAke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0gfCBzZWQgJ3MvLiQvLycpCgojIEZldGNoIGBkb2dmb29kQ2FuYXJ5YCB0YWcgZm9yIHRoaXMgZWMyIGluc3RhbmNlLiBVc2luZyBhd3MgY2xpIGJlY2F1c2UgU3Bpbm5ha2VyIGRvZXNuJ3QgKHlldCkgaGF2ZSBhbiBlYXN5IHdheSB0byBlbmFibGUgdGhlIEluc3RhbmNlTWV0YWRhdGFUYWdzIGZlYXR1cmUuCiMgVGhpcyBpcyBhIGJlc3QgZWZmb3J0LiBJZiB0aGUgSUFNIHBlcm1pc3Npb25zIGFyZW4ndCBzZXQgdXAgY29ycmVjdGx5LCB0aGlzIHdpbGwgcXVpZXRseSBmYWlsIGFuZCBET0dGT09EX0NBTkFSWV9FTkFCTEVEIHdpbGwgYmUgc2V0IHRvICJmYWxzZSIuCkRPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9JChhd3MgZWMyIGRlc2NyaWJlLXRhZ3MgLS1maWx0ZXJzICJOYW1lPXJlc291cmNlLWlkLFZhbHVlcz0ke0VDMl9JTlNUQU5DRV9JRH0iICJOYW1lPWtleSxWYWx1ZXM9ZG9nZm9vZENhbmFyeSIgLS1yZWdpb24gJHtFQzJfUkVHSU9OfSAtLXF1ZXJ5ICdUYWdzWzBdLlZhbHVlJyAtLW91dHB1dCB0ZXh0IHx8IHRydWUpCgojIE9ubHkgYWxsb3cgZWl0aGVyIGB0cnVlYCBvciBgZmFsc2VgIHZhbHVlcyBzbyB3ZSBlcnIgb24gdGhlIHNpZGUgb2Ygc2V0dGluZyB0aGlzIHRvIGZhbHNlLgppZiBbICIke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiAhPSAidHJ1ZSIgXTsgdGhlbgoJRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0iZmFsc2UiCmZpCgojIFRoaXMgZmlsZSBnZXRzIHBpY2tlZCB1cCBieSBvdXIgc3lzdGVtZCBzZXJ2aWNlCmVjaG8gIkRPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9JHtET0dGT09EX0NBTkFSWV9FTkFCTEVEfSIgPiAvb3B0L3N5c3RlbWRlbnYKCgpLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UPSJ2cGNlLTA4MWU2NTk3ZDk1NjI4NjIyLWo1N3N5M29jLmtpbmVzaXMudXMtZWFzdC0yLnZwY2UuYW1hem9uYXdzLmNvbSIKCktJTkVTSVNfU1RSRUFNX0VORFBPSU5UPSJ2cGNlLTA4MWU2NTk3ZDk1NjI4NjIyLWo1N3N5M29jLSR7RUMyX0FWQUlMQUJJTElUWV9aT05FfS5raW5lc2lzLnVzLWVhc3QtMi52cGNlLmFtYXpvbmF3cy5jb20iCgplY2hvICI+PiBEYXRhZG9nIGFnZW50IGNvbmZpZ3VyYXRpb24iCmF3cyBzMyBzeW5jIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vZGF0YWRvZy1hZ2VudC8gL2V0Yy9kYXRhZG9nLWFnZW50LyAtLWRlbGV0ZQoKWyAhIC1kIC92YXIvcnVuL2RhdGFkb2cgXSAmJiBta2RpciAtcCAvdmFyL3J1bi9kYXRhZG9nCgpjaG93biBkZC1hZ2VudDpkZC1hZ2VudCAvZXRjL2RhdGFkb2ctYWdlbnQvKiAvdmFyL3J1bi9kYXRhZG9nCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKY2htb2QgMDY0MCAvZXRjL2RhdGFkb2ctYWdlbnQvc2VjdXJpdHktYWdlbnQueWFtbAoKaWYgWyAtZiAiL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSIgXTsgdGhlbgogIFNIQT0kKGNhdCAvb3B0LyR7QVBQX05BTUV9LWN1cnJlbnQvU0hBKQogIHNlZCAtaSAicy9yZXBsYWNlLXdpdGgtc2hhLyR7U0hBfS8iIC9ldGMvZGF0YWRvZy1hZ2VudC9kYXRhZG9nLnlhbWwKZmkKCmZvciBzZXJ2aWNlX25hbWUgaW4gZGF0YWRvZy1hZ2VudCBkYXRhZG9nLWFnZW50LXByb2Nlc3MgZGF0YWRvZy1hZ2VudC10cmFjZSBkYXRhZG9nLWFnZW50LXN5c3Byb2JlOyBkbwogIHNlcnZpY2UgIiR7c2VydmljZV9uYW1lfSIgcmVzdGFydCB8fCB0ZWxsX3NsYWNrX29wcyAiJHtzZXJ2aWNlX25hbWV9IHJlc3RhcnQgZmFpbGVkIgpkb25lCgplY2hvICI+PiBwZ2JvdW5jZXIgQ29uZmlndXJhdGlvbiIKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vdXNlcmxpc3QudHh0IC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dApjaG93biBwb3N0Z3Jlczpwb3N0Z3JlcyAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dAoKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL3BnYm91bmNlci9wZ2JvdW5jZXIuaW5pCmNob3duIHBvc3RncmVzOnBvc3RncmVzIC9ldGMvcGdib3VuY2VyL3BnYm91bmNlci5pbmkKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3BnYm91bmNlci5pbmkKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgojIFNldCBLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UIGFuZCBLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVApzZWQgLWkgInMvS0lORVNJU19TVFJFQU1fRU5EUE9JTlQvJHtLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVH0vZyIgIiRDT05GSUdfUEFUSCIKc2VkIC1pICJzL0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQvJHtLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgoKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLWVhc3QtMjo1MjcyOTEwOTQ0NjA6Y2VydGlmaWNhdGUtYXV0aG9yaXR5L2ZjZmU0ZTk2LThlNGYtNDNmMy04NWQxLTVkMzBlYjE3YWEyMCIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnByb2QtZHIuaW50dWl0LmxhdW5jaGRhcmtseS5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049Z29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKICBlY2hvICJFeGVjU3RhcnRQb3N0PS9iaW4vc2ggLWMgJ2Nob3duIG5vYm9keTpub2dyb3VwIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzL2NsaWVudC5nb25mYWxvbi4qJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKIyBXZSBkb24ndCB3YW50IHRvIHN0YXJ0IHRoZSBkYXRhZG9nIHNlcnZpY2UgZm9yIHRoZSBzbGFjay1hcHAKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQKeyBlY2hvICJbU2VydmljZV0iCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0FfQVJOPWFybjphd3M6YWNtLXBjYTp1cy1lYXN0LTI6NTI3MjkxMDk0NDYwOmNlcnRpZmljYXRlLWF1dGhvcml0eS9mY2ZlNGU5Ni04ZTRmLTQzZjMtODVkMS01ZDMwZWIxN2FhMjAiCiAgZWNobyAiRW52aXJvbm1lbnQ9Q0VSVF9ESVI9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMiCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9DTj0ke0FQUF9OQU1FfS5wcm9kLWRyLmludHVpdC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKCgoKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCiMgZGlzYWJsZSBzY2hlZHVsZWQgdXBkYXRlcyBiZWNhdXNlIGdvbmZhbG9uIHdpbGwgbm90IHJlbG9hZCB0aGUgY2VydAojIGJ5IGFsbG93aW5nIHRoZSBjZXJ0IHRvIHJlbWFpbiB1bmNoYW5nZWQsIHdlIGNhbiBiZSBhbGVydGVkIHdoZW4gaXQgaXMgYWJvdXQgdG8gZXhwaXJlCiMgc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUudGltZXIKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnRpbWVyCgoKCnNlcnZpY2UgIiR7QVBQX05BTUV9IiByZXN0YXJ0CgpBVFRFTVBUUz0wCk1BWF9BVFRFTVBUUz0xMjAKUE9SVD0zMDAwCndoaWxlIFsgJEFUVEVNUFRTIC1uZSAkTUFYX0FUVEVNUFRTIF0gOyBkbwogICAgQVRURU1QVFM9JCgoQVRURU1QVFMrMSkpCiAgICBlY2hvICJXYWl0aW5nIGZvciBhcHBsaWNhdGlvbi4uLiAoJHtBVFRFTVBUU30vJHtNQVhfQVRURU1QVFN9KSIKICAgIGlmICEgdGltZW91dCAxIGJhc2ggLWMgImVjaG8gPi9kZXYvdGNwL2xvY2FsaG9zdC8ke1BPUlR9IjsgdGhlbgogICAgICAgIHNsZWVwIDE7CiAgICBlbHNlCiAgICAgICAgZWNobyAiQXBwbGljYXRpb24gaXMgcnVubmluZy4iCiAgICAgICAgYnJlYWsKICAgIGZpCiAgICBpZiBbICRBVFRFTVBUUyAtZXEgJE1BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgICAgZXhpdCAxOwogICAgZmkKZG9uZQoKc3lzdGVtY3RsIGVuYWJsZSAtLW5vdyBzeXNzdGF0LnNlcnZpY2UK",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "dr",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "intuit_production_dr-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "dr",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-09d7eb181154c9e03",
                "sg-0ac7f0e7288940ac0",
                "sg-0aeb4143cfbd2a6e6",
                "sg-099dd65436ef6a437",
                "sg-0b8e9306ee9121d04",
                "sg-013cce4b54d7295d7",
                "sg-034a83c89d0b60a1c"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "dr-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (intuit_production_dr)",
                "dogfoodCanary": "false",
                "env": "intuit_production_dr",
                "environment": "intuit_production_dr",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-2",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "dr"
              },
              "targetGroups": [
                "gonfalon-web-dr",
                "gonfalon-web-internal-dr"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to intuit_production_dr",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-intuit_production_dr@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to intuit_production_dr.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!intuit_production_dr !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id",
            "run_db_migrations_coderefs-crdb",
            "run_db_migrations_oauth2-crdb",
            "run_db_migrations_accounts-crdb",
            "run_db_migrations_gonfalon-accounts-crdb",
            "run_db_migrations_gonfalon-billing-crdb",
            "run_db_migrations_gonfalon-integrations-crdb",
            "run_db_migrations_gonfalon-workflows-crdb"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 7200000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "intuit_production_dr"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/managed-intuit_production"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - intuit_production_dr - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #intuit deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#intuit",
            "text": "${ trigger.user } is done deploying gonfalon-web - intuit_production_dr with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_intuit",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-dr deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-dr",
            "text": "${ trigger.user } is done deploying gonfalon-web - intuit_production_dr with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-dr",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"intuit_production_dr\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": null
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - intuit_staging",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/staging/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.stg.intuit.launchdarkly.com/api/status"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-intuit deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-intuit",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - intuit_staging with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-intuit",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"intuit_staging\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-west-2"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-coderefs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "coderefs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for coderefs-crdb",
          "refId": "run_db_migrations_coderefs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-oauth2-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "oauth2-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for oauth2-crdb",
          "refId": "run_db_migrations_oauth2-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for accounts-crdb",
          "refId": "run_db_migrations_accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-accounts-crdb",
          "refId": "run_db_migrations_gonfalon-accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-billing-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-billing-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-billing-crdb",
          "refId": "run_db_migrations_gonfalon-billing-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-integrations-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-integrations-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-integrations-crdb",
          "refId": "run_db_migrations_gonfalon-integrations-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-workflows-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-workflows-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-workflows-crdb",
          "refId": "run_db_migrations_gonfalon-workflows-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "intuit-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-west-2": [
                  "us-west-2a",
                  "us-west-2b",
                  "us-west-2c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1pbnR1aXRfc3RhZ2luZwpMRF9BUFBfQ09ORklHPW1hbmFnZWQtaW50dWl0X3N0YWdpbmcKRU5WX1NIT1JUX05BTUU9aW50LXN0ZwpFQzJfSE9TVE5BTUU9JChob3N0bmFtZSkKUzNfQ09ORklHU19CVUNLRVQ9bGF1bmNoZGFya2x5LWludHVpdC1jb25maWdzCgpTTEFDS19FTkRQT0lOVD0iaHR0cHM6Ly9ob29rcy5zbGFjay5jb20vc2VydmljZXMvVDAzTlgyNDBXL0JHUTBOVFQxUy9UNkJRdXM2Z2FtTjJwYU4xeGhPVDVUdjUiCnRlbGxfc2xhY2tfY2hhbm5lbCgpIHsKICAgIGNoYW5uZWw9IiQxIgogICAgbWVzc2FnZT0iJDIiCiAgICBjdXJsIFwKICAgICAgICAtLXNpbGVudCBcCiAgICAgICAgLS1zaG93LWVycm9yIFwKICAgICAgICAtLXJlcXVlc3QgUE9TVCBcCiAgICAgICAgLS1oZWFkZXIgJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vanNvbicgXAogICAgICAgIC0tZGF0YSAieydjaGFubmVsJzpcIiR7Y2hhbm5lbH1cIiwgJ3RleHQnOlwiJHttZXNzYWdlfVwifSIgXAogICAgICAgICIke1NMQUNLX0VORFBPSU5UfSIgXAogICAgfHwgZWNobyAiRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSB0byBTbGFjayAjJHtjaGFubmVsfTogJHttZXNzYWdlfSIgPiYyCn0KCnRlbGxfc2xhY2tfb3BzX3JhdygpIHsKICAgIG1lc3NhZ2U9IiQxIgogICAgZWNobyAiPj4gJHttZXNzYWdlfSIgPiYyCiAgICB0ZWxsX3NsYWNrX2NoYW5uZWwgIm9wcy1pbnR1aXQiICIke21lc3NhZ2V9Igp9Cgp0ZWxsX3NsYWNrX29wcygpIHsKICAgIHJhd19tZXNzYWdlPSIkMSIKICAgIG1lc3NhZ2U9IiR7RU5WSVJPTk1FTlR9LyR7RUMyX0hPU1ROQU1FfSAoJHtBUFBfTkFNRX0pOiAke3Jhd19tZXNzYWdlfSIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHttZXNzYWdlfSIKfQojIHJ1biB0aGUgc3NoX2tleXNfY2xlYW51cCBjb21tYW5kIHRvIGVuc3VyZSBubyBzaGFyZWQga2V5cyBhcmUgcHJlc2VudApzc2hfa2V5c19jbGVhbnVwIHx8IHRydWUKCm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvcigpIHsKICBydj0kPwogIGlmIFsgJHtydn0gLWVxIDAgXTsgdGhlbgogICAgZWNobyAiQWxsIE9LIgogIGVsc2UKICAgIHNlcnZpY2UgJHtBUFBfTkFNRX0gc3RvcCB8fCB0cnVlCiAgICBFUlJPUl9NU0c9IkNsb3VkLWluaXQgdXNlci1kYXRhIGZhaWxlZCB0byBzdWNjZWVkIChleGl0IGNvZGUgJHtydn0pIG9uIGluc3RhbmNlICR7RUMyX0hPU1ROQU1FfSBpbiAke0VOVklST05NRU5UfS4gIFN0b3BwaW5nICR7QVBQX05BTUV9IHNvIHRoYXQgaW5zdGFuY2UgZG9lcyBub3QgcmVjZWl2ZSBhbnkgdHJhZmZpYyBhbmQgc28gdGhhdCBkZXBsb3ltZW50IGNhbiBmYWlsLiIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHtFUlJPUl9NU0d9IgogICAgZXhpdCAkcnYKICBmaQp9CnRyYXAgIm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvciIgSU5UIFRFUk0gRVhJVApFQzJfSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKRUMyX0lQVjRfTE9DQUxfQUREUj0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCkVDMl9BVkFJTEFCSUxJVFlfWk9ORT0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL3BsYWNlbWVudC9hdmFpbGFiaWxpdHktem9uZS8pCkVDMl9SRUdJT049JChlY2hvICR7RUMyX0FWQUlMQUJJTElUWV9aT05FfSB8IHNlZCAncy8uJC8vJykKCiMgRmV0Y2ggYGRvZ2Zvb2RDYW5hcnlgIHRhZyBmb3IgdGhpcyBlYzIgaW5zdGFuY2UuIFVzaW5nIGF3cyBjbGkgYmVjYXVzZSBTcGlubmFrZXIgZG9lc24ndCAoeWV0KSBoYXZlIGFuIGVhc3kgd2F5IHRvIGVuYWJsZSB0aGUgSW5zdGFuY2VNZXRhZGF0YVRhZ3MgZmVhdHVyZS4KIyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQuIElmIHRoZSBJQU0gcGVybWlzc2lvbnMgYXJlbid0IHNldCB1cCBjb3JyZWN0bHksIHRoaXMgd2lsbCBxdWlldGx5IGZhaWwgYW5kIERPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQgd2lsbCBiZSBzZXQgdG8gImZhbHNlIi4KRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0kKGF3cyBlYzIgZGVzY3JpYmUtdGFncyAtLWZpbHRlcnMgIk5hbWU9cmVzb3VyY2UtaWQsVmFsdWVzPSR7RUMyX0lOU1RBTkNFX0lEfSIgIk5hbWU9a2V5LFZhbHVlcz1kb2dmb29kQ2FuYXJ5IiAtLXJlZ2lvbiAke0VDMl9SRUdJT059IC0tcXVlcnkgJ1RhZ3NbMF0uVmFsdWUnIC0tb3V0cHV0IHRleHQgfHwgdHJ1ZSkKCiMgT25seSBhbGxvdyBlaXRoZXIgYHRydWVgIG9yIGBmYWxzZWAgdmFsdWVzIHNvIHdlIGVyciBvbiB0aGUgc2lkZSBvZiBzZXR0aW5nIHRoaXMgdG8gZmFsc2UuCmlmIFsgIiR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iICE9ICJ0cnVlIiBdOyB0aGVuCglET0dGT09EX0NBTkFSWV9FTkFCTEVEPSJmYWxzZSIKZmkKCiMgVGhpcyBmaWxlIGdldHMgcGlja2VkIHVwIGJ5IG91ciBzeXN0ZW1kIHNlcnZpY2UKZWNobyAiRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0ke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiA+IC9vcHQvc3lzdGVtZGVudgoKCktJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQ9InZwY2UtMGM4ZTg4NjdmZWE3N2YzM2MtaXQ0dnplcTMtJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9LmZpcmVob3NlLnVzLXdlc3QtMi52cGNlLmFtYXpvbmF3cy5jb20iCgpLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVD0idnBjZS0wMWU3ZWFjOGYwNzE3ZDc2ZS10NGVyN3poci0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0ua2luZXNpcy51cy13ZXN0LTIudnBjZS5hbWF6b25hd3MuY29tIgoKZWNobyAiPj4gRGF0YWRvZyBhZ2VudCBjb25maWd1cmF0aW9uIgphd3MgczMgc3luYyBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2RhdGFkb2ctYWdlbnQvIC9ldGMvZGF0YWRvZy1hZ2VudC8gLS1kZWxldGUKClsgISAtZCAvdmFyL3J1bi9kYXRhZG9nIF0gJiYgbWtkaXIgLXAgL3Zhci9ydW4vZGF0YWRvZwoKY2hvd24gZGQtYWdlbnQ6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50LyogL3Zhci9ydW4vZGF0YWRvZwpjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG1vZCAwNjQwIC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zZWN1cml0eS1hZ2VudC55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKCmlmIFsgLWYgIi9vcHQvJHtBUFBfTkFNRX0tY3VycmVudC9TSEEiIF07IHRoZW4KICBTSEE9JChjYXQgL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSkKICBzZWQgLWkgInMvcmVwbGFjZS13aXRoLXNoYS8ke1NIQX0vIiAvZXRjL2RhdGFkb2ctYWdlbnQvZGF0YWRvZy55YW1sCmZpCgpmb3Igc2VydmljZV9uYW1lIGluIGRhdGFkb2ctYWdlbnQgZGF0YWRvZy1hZ2VudC1wcm9jZXNzIGRhdGFkb2ctYWdlbnQtdHJhY2UgZGF0YWRvZy1hZ2VudC1zeXNwcm9iZTsgZG8KICBzZXJ2aWNlICIke3NlcnZpY2VfbmFtZX0iIHJlc3RhcnQgfHwgdGVsbF9zbGFja19vcHMgIiR7c2VydmljZV9uYW1lfSByZXN0YXJ0IGZhaWxlZCIKZG9uZQoKZWNobyAiPj4gcGdib3VuY2VyIENvbmZpZ3VyYXRpb24iCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3VzZXJsaXN0LnR4dCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2hvd24gcG9zdGdyZXM6cG9zdGdyZXMgL2V0Yy9wZ2JvdW5jZXIvdXNlcmxpc3QudHh0CmNobW9kIDYwMCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9wZ2JvdW5jZXIuY210cGwKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vY29uc3VsLXRlbXBsYXRlLmNvbmYgL2V0Yy9jb25zdWwtdGVtcGxhdGUvY29uc3VsLXRlbXBsYXRlLmNvbmYKc2VydmljZSBjb25zdWwtdGVtcGxhdGUgcmVzdGFydApzbGVlcCAxMAoKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgojIFNldCBLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UIGFuZCBLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVApzZWQgLWkgInMvS0lORVNJU19TVFJFQU1fRU5EUE9JTlQvJHtLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVH0vZyIgIiRDT05GSUdfUEFUSCIKc2VkIC1pICJzL0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQvJHtLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgoKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1MjcyOTEwOTQ0NjA6Y2VydGlmaWNhdGUtYXV0aG9yaXR5L2FlMTBjZGI1LTBiZjAtNGUwMS1hZmVmLTQwY2Q2MTY0M2M1ZCIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnN0Zy5pbnR1aXQubGF1bmNoZGFya2x5LmNvbSIKICBlY2hvICJFbnZpcm9ubWVudD1FWFBMSUNJVF9DTj1nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZ29uZmFsb24iCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgogIGVjaG8gIkV4ZWNTdGFydFBvc3Q9L2Jpbi9zaCAtYyAnY2hvd24gbm9ib2R5Om5vZ3JvdXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L2NyZGItY2VydHMvY2xpZW50LmdvbmZhbG9uLionIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgojIFdlIGRvbid0IHdhbnQgdG8gc3RhcnQgdGhlIGRhdGFkb2cgc2VydmljZSBmb3IgdGhlIHNsYWNrLWFwcApta2RpciAtcCAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLXdlc3QtMjo1MjcyOTEwOTQ0NjA6Y2VydGlmaWNhdGUtYXV0aG9yaXR5L2FlMTBjZGI1LTBiZjAtNGUwMS1hZmVmLTQwY2Q2MTY0M2M1ZCIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnN0Zy5pbnR1aXQubGF1bmNoZGFya2x5LmNvbSIKICBlY2hvICJFbnZpcm9ubWVudD1FWFBMSUNJVF9DTj1kYXRhZG9nIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FPWNsaWVudC5kYXRhZG9nIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FX0ZMQUc9Jy1mJyIKfSB8IHRlZSAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UuZC8xMC1jZXJ0LWNvbmZpZy5jb25mCgoKCgpzeXN0ZW1jdGwgZGFlbW9uLXJlbG9hZAoKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZQojIGRpc2FibGUgc2NoZWR1bGVkIHVwZGF0ZXMgYmVjYXVzZSBnb25mYWxvbiB3aWxsIG5vdCByZWxvYWQgdGhlIGNlcnQKIyBieSBhbGxvd2luZyB0aGUgY2VydCB0byByZW1haW4gdW5jaGFuZ2VkLCB3ZSBjYW4gYmUgYWxlcnRlZCB3aGVuIGl0IGlzIGFib3V0IHRvIGV4cGlyZQojIHN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnRpbWVyCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS50aW1lcgoKCgpzZXJ2aWNlICIke0FQUF9OQU1FfSIgcmVzdGFydAoKQVRURU1QVFM9MApNQVhfQVRURU1QVFM9MTIwClBPUlQ9MzAwMAp3aGlsZSBbICRBVFRFTVBUUyAtbmUgJE1BWF9BVFRFTVBUUyBdIDsgZG8KICAgIEFUVEVNUFRTPSQoKEFUVEVNUFRTKzEpKQogICAgZWNobyAiV2FpdGluZyBmb3IgYXBwbGljYXRpb24uLi4gKCR7QVRURU1QVFN9LyR7TUFYX0FUVEVNUFRTfSkiCiAgICBpZiAhIHRpbWVvdXQgMSBiYXNoIC1jICJlY2hvID4vZGV2L3RjcC9sb2NhbGhvc3QvJHtQT1JUfSI7IHRoZW4KICAgICAgICBzbGVlcCAxOwogICAgZWxzZQogICAgICAgIGVjaG8gIkFwcGxpY2F0aW9uIGlzIHJ1bm5pbmcuIgogICAgICAgIGJyZWFrCiAgICBmaQogICAgaWYgWyAkQVRURU1QVFMgLWVxICRNQVhfQVRURU1QVFMgXTsgdGhlbgogICAgICAgIGV4aXQgMTsKICAgIGZpCmRvbmUKCnN5c3RlbWN0bCBlbmFibGUgLS1ub3cgc3lzc3RhdC5zZXJ2aWNlCg==",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 300,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "int-stg",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "intuit_staging-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "int-stg",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-daab32a0",
                "sg-3f1f8d45",
                "sg-11b32d6b",
                "sg-076611569209e98be",
                "sg-74b82304",
                "sg-5ba83121",
                "sg-015dadb6be57e519f",
                "sg-09717b62e0730fa34",
                "sg-035d5342f546b6368",
                "sg-0eb0f2cc096b5781b",
                "sg-02ab734438fd820c7"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "staging-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (intuit_staging)",
                "dogfoodCanary": "false",
                "env": "intuit_staging",
                "environment": "intuit_staging",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-west-2",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "staging"
              },
              "targetGroups": [
                "gonfalon-web-int-stg",
                "gonfalon-web-internal-int-stg"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to intuit_staging",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-intuit_staging@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to intuit_staging.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!intuit_staging !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id",
            "run_db_migrations_coderefs-crdb",
            "run_db_migrations_oauth2-crdb",
            "run_db_migrations_accounts-crdb",
            "run_db_migrations_gonfalon-accounts-crdb",
            "run_db_migrations_gonfalon-billing-crdb",
            "run_db_migrations_gonfalon-integrations-crdb",
            "run_db_migrations_gonfalon-workflows-crdb"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 2700000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "intuit_staging"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/managed-intuit_staging"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - intuit_staging - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"managed-intuit-stg\",\n  \"eventType\": \"started\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate started notification",
          "refId": "accelerate_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"managed-intuit-stg\",\n  \"eventType\": \"finished\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate finished notification",
          "refId": "accelerate_finished",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-intuit deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-intuit",
            "text": "${ trigger.user } is done deploying gonfalon-web - intuit_staging with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-intuit",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"intuit_staging\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-west-2"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "527291094460"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": null
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - production",
      "notifications": [
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/production/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.prod.launchdarkly.com/api/status"
        },
        {
          "method": "POST",
          "name": "Seek #eng-deploys deploy approval",
          "overrideTimeout": true,
          "payload": {
            "channel": "#eng-deploys",
            "text": "${ trigger.user } wants to :deploying: gonfalon-web - production with version ${ parameters['sha'] }.\nSHA diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] } | See https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } for more information.\n\n:thumbsup: / :thumbsdown:?"
          },
          "refId": "notification_deploy_waiting_for_approval_eng-deploys",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "failPipeline": true,
          "instructions": "Deploying gonfalon-web - production with version ${ parameters['sha'] }. The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }",
          "judgmentInputs": [],
          "name": "Confirm that deploy should continue",
          "notifications": [
            {
              "address": "deploys",
              "level": "stage",
              "type": "slack",
              "when": [
                "manualJudgment",
                "manualJudgmentContinue",
                "manualJudgmentStop"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "confirm_deployment",
          "requisiteStageRefIds": [
            "notification_deploy_waiting_for_approval_eng-deploys"
          ],
          "sendNotifications": true,
          "stageEnabled": {
            "expression": "!(trigger['payload'] != null \u0026\u0026 trigger['payload']['status'] == 'thumbed')",
            "type": "expression"
          },
          "stageTimeoutMs": 3600000,
          "type": "manualJudgment"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-production deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-production",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - production with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-production",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"production\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "confirm_deployment"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "cloudProvider": "aws",
          "cloudProviderType": "aws",
          "name": "Lookup AMI ID for Baked Artifact AMI",
          "overrideTimeout": true,
          "packageName": "gonfalon-web-${ parameters.sha }*ubuntu",
          "refId": "lookup_baked_artifact_ami_id",
          "regions": [
            "us-east-1"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version",
            "notification_deploy_waiting_for_approval_eng-deploys",
            "confirm_deployment"
          ],
          "stageTimeoutMs": 60000,
          "tags": {},
          "type": "findImageFromTags"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-coderefs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "coderefs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for coderefs-crdb",
          "refId": "run_db_migrations_coderefs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-oauth2-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "oauth2-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for oauth2-crdb",
          "refId": "run_db_migrations_oauth2-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for accounts-crdb",
          "refId": "run_db_migrations_accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-accounts-crdb",
          "refId": "run_db_migrations_gonfalon-accounts-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-billing-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-billing-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-billing-crdb",
          "refId": "run_db_migrations_gonfalon-billing-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-file-jobs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-file-jobs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-file-jobs-crdb",
          "refId": "run_db_migrations_gonfalon-file-jobs-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-integrations-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-integrations-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-integrations-crdb",
          "refId": "run_db_migrations_gonfalon-integrations-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-workflows-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-workflows-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-workflows-crdb",
          "refId": "run_db_migrations_gonfalon-workflows-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-experimentation-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-experimentation-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "production"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-experimentation-crdb",
          "refId": "run_db_migrations_gonfalon-experimentation-crdb",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-1": [
                  "us-east-1a",
                  "us-east-1b",
                  "us-east-1c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1wcm9kdWN0aW9uCkxEX0FQUF9DT05GSUc9cHJvZApFTlZfU0hPUlRfTkFNRT1sZC1wcm9kCkVDMl9IT1NUTkFNRT0kKGhvc3RuYW1lKQpTM19DT05GSUdTX0JVQ0tFVD1sYXVuY2hkYXJrbHktY29uZmlncwoKU0xBQ0tfRU5EUE9JTlQ9Imh0dHBzOi8vaG9va3Muc2xhY2suY29tL3NlcnZpY2VzL1QwM05YMjQwVy9CR1EwTlRUMVMvVDZCUXVzNmdhbU4ycGFOMXhoT1Q1VHY1Igp0ZWxsX3NsYWNrX2NoYW5uZWwoKSB7CiAgICBjaGFubmVsPSIkMSIKICAgIG1lc3NhZ2U9IiQyIgogICAgY3VybCBcCiAgICAgICAgLS1zaWxlbnQgXAogICAgICAgIC0tc2hvdy1lcnJvciBcCiAgICAgICAgLS1yZXF1ZXN0IFBPU1QgXAogICAgICAgIC0taGVhZGVyICdDb250ZW50LXR5cGU6IGFwcGxpY2F0aW9uL2pzb24nIFwKICAgICAgICAtLWRhdGEgInsnY2hhbm5lbCc6XCIke2NoYW5uZWx9XCIsICd0ZXh0JzpcIiR7bWVzc2FnZX1cIn0iIFwKICAgICAgICAiJHtTTEFDS19FTkRQT0lOVH0iIFwKICAgIHx8IGVjaG8gIkZhaWxlZCB0byBzZW5kIG1lc3NhZ2UgdG8gU2xhY2sgIyR7Y2hhbm5lbH06ICR7bWVzc2FnZX0iID4mMgp9Cgp0ZWxsX3NsYWNrX29wc19yYXcoKSB7CiAgICBtZXNzYWdlPSIkMSIKICAgIGVjaG8gIj4+ICR7bWVzc2FnZX0iID4mMgogICAgdGVsbF9zbGFja19jaGFubmVsICJvcHMtcHJvZHVjdGlvbiIgIiR7bWVzc2FnZX0iCn0KCnRlbGxfc2xhY2tfb3BzKCkgewogICAgcmF3X21lc3NhZ2U9IiQxIgogICAgbWVzc2FnZT0iJHtFTlZJUk9OTUVOVH0vJHtFQzJfSE9TVE5BTUV9ICgke0FQUF9OQU1FfSk6ICR7cmF3X21lc3NhZ2V9IgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke21lc3NhZ2V9Igp9CiMgcnVuIHRoZSBzc2hfa2V5c19jbGVhbnVwIGNvbW1hbmQgdG8gZW5zdXJlIG5vIHNoYXJlZCBrZXlzIGFyZSBwcmVzZW50CnNzaF9rZXlzX2NsZWFudXAgfHwgdHJ1ZQoKbm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yKCkgewogIHJ2PSQ/CiAgaWYgWyAke3J2fSAtZXEgMCBdOyB0aGVuCiAgICBlY2hvICJBbGwgT0siCiAgZWxzZQogICAgc2VydmljZSAke0FQUF9OQU1FfSBzdG9wIHx8IHRydWUKICAgIEVSUk9SX01TRz0iQ2xvdWQtaW5pdCB1c2VyLWRhdGEgZmFpbGVkIHRvIHN1Y2NlZWQgKGV4aXQgY29kZSAke3J2fSkgb24gaW5zdGFuY2UgJHtFQzJfSE9TVE5BTUV9IGluICR7RU5WSVJPTk1FTlR9LiAgU3RvcHBpbmcgJHtBUFBfTkFNRX0gc28gdGhhdCBpbnN0YW5jZSBkb2VzIG5vdCByZWNlaXZlIGFueSB0cmFmZmljIGFuZCBzbyB0aGF0IGRlcGxveW1lbnQgY2FuIGZhaWwuIgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke0VSUk9SX01TR30iCiAgICBleGl0ICRydgogIGZpCn0KdHJhcCAibm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yIiBJTlQgVEVSTSBFWElUCkVDMl9JTlNUQU5DRV9JRD0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLWlkKQpFQzJfSVBWNF9MT0NBTF9BRERSPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvbG9jYWwtaXB2NCkKRUMyX0FWQUlMQUJJTElUWV9aT05FPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvcGxhY2VtZW50L2F2YWlsYWJpbGl0eS16b25lLykKRUMyX1JFR0lPTj0kKGVjaG8gJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9IHwgc2VkICdzLy4kLy8nKQoKIyBGZXRjaCBgZG9nZm9vZENhbmFyeWAgdGFnIGZvciB0aGlzIGVjMiBpbnN0YW5jZS4gVXNpbmcgYXdzIGNsaSBiZWNhdXNlIFNwaW5uYWtlciBkb2Vzbid0ICh5ZXQpIGhhdmUgYW4gZWFzeSB3YXkgdG8gZW5hYmxlIHRoZSBJbnN0YW5jZU1ldGFkYXRhVGFncyBmZWF0dXJlLgojIFRoaXMgaXMgYSBiZXN0IGVmZm9ydC4gSWYgdGhlIElBTSBwZXJtaXNzaW9ucyBhcmVuJ3Qgc2V0IHVwIGNvcnJlY3RseSwgdGhpcyB3aWxsIHF1aWV0bHkgZmFpbCBhbmQgRE9HRk9PRF9DQU5BUllfRU5BQkxFRCB3aWxsIGJlIHNldCB0byAiZmFsc2UiLgpET0dGT09EX0NBTkFSWV9FTkFCTEVEPSQoYXdzIGVjMiBkZXNjcmliZS10YWdzIC0tZmlsdGVycyAiTmFtZT1yZXNvdXJjZS1pZCxWYWx1ZXM9JHtFQzJfSU5TVEFOQ0VfSUR9IiAiTmFtZT1rZXksVmFsdWVzPWRvZ2Zvb2RDYW5hcnkiIC0tcmVnaW9uICR7RUMyX1JFR0lPTn0gLS1xdWVyeSAnVGFnc1swXS5WYWx1ZScgLS1vdXRwdXQgdGV4dCB8fCB0cnVlKQoKIyBPbmx5IGFsbG93IGVpdGhlciBgdHJ1ZWAgb3IgYGZhbHNlYCB2YWx1ZXMgc28gd2UgZXJyIG9uIHRoZSBzaWRlIG9mIHNldHRpbmcgdGhpcyB0byBmYWxzZS4KaWYgWyAiJHtET0dGT09EX0NBTkFSWV9FTkFCTEVEfSIgIT0gInRydWUiIF07IHRoZW4KCURPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9ImZhbHNlIgpmaQoKIyBUaGlzIGZpbGUgZ2V0cyBwaWNrZWQgdXAgYnkgb3VyIHN5c3RlbWQgc2VydmljZQplY2hvICJET0dGT09EX0NBTkFSWV9FTkFCTEVEPSR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iID4gL29wdC9zeXN0ZW1kZW52CgoKS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVD0idnBjZS0wMjI5N2NiZTMzMjk5YTdkYi1ueDVqaGRvZi0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0uZmlyZWhvc2UudXMtZWFzdC0xLnZwY2UuYW1hem9uYXdzLmNvbSIKCktJTkVTSVNfU1RSRUFNX0VORFBPSU5UPSJ2cGNlLTAzOWIxNGRiZWIxMTk1MmRmLXN1N2t4NTRqLSR7RUMyX0FWQUlMQUJJTElUWV9aT05FfS5raW5lc2lzLnVzLWVhc3QtMS52cGNlLmFtYXpvbmF3cy5jb20iCgplY2hvICI+PiBEYXRhZG9nIGFnZW50IGNvbmZpZ3VyYXRpb24iCmF3cyBzMyBzeW5jIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vZGF0YWRvZy1hZ2VudC8gL2V0Yy9kYXRhZG9nLWFnZW50LyAtLWRlbGV0ZQoKWyAhIC1kIC92YXIvcnVuL2RhdGFkb2cgXSAmJiBta2RpciAtcCAvdmFyL3J1bi9kYXRhZG9nCgpjaG93biBkZC1hZ2VudDpkZC1hZ2VudCAvZXRjL2RhdGFkb2ctYWdlbnQvKiAvdmFyL3J1bi9kYXRhZG9nCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKY2htb2QgMDY0MCAvZXRjL2RhdGFkb2ctYWdlbnQvc2VjdXJpdHktYWdlbnQueWFtbAoKaWYgWyAtZiAiL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSIgXTsgdGhlbgogIFNIQT0kKGNhdCAvb3B0LyR7QVBQX05BTUV9LWN1cnJlbnQvU0hBKQogIHNlZCAtaSAicy9yZXBsYWNlLXdpdGgtc2hhLyR7U0hBfS8iIC9ldGMvZGF0YWRvZy1hZ2VudC9kYXRhZG9nLnlhbWwKZmkKCmZvciBzZXJ2aWNlX25hbWUgaW4gZGF0YWRvZy1hZ2VudCBkYXRhZG9nLWFnZW50LXByb2Nlc3MgZGF0YWRvZy1hZ2VudC10cmFjZSBkYXRhZG9nLWFnZW50LXN5c3Byb2JlOyBkbwogIHNlcnZpY2UgIiR7c2VydmljZV9uYW1lfSIgcmVzdGFydCB8fCB0ZWxsX3NsYWNrX29wcyAiJHtzZXJ2aWNlX25hbWV9IHJlc3RhcnQgZmFpbGVkIgpkb25lCgplY2hvICI+PiBwZ2JvdW5jZXIgQ29uZmlndXJhdGlvbiIKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vdXNlcmxpc3QudHh0IC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dApjaG93biBwb3N0Z3Jlczpwb3N0Z3JlcyAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dAoKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vcGdib3VuY2VyLmNtdHBsIC9ldGMvY29uc3VsLXRlbXBsYXRlL3BnYm91bmNlci5jbXRwbAphd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS9nb25mYWxvbi9jb25zdWwtdGVtcGxhdGUuY29uZiAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9jb25zdWwtdGVtcGxhdGUuY29uZgpzZXJ2aWNlIGNvbnN1bC10ZW1wbGF0ZSByZXN0YXJ0CnNsZWVwIDEwCgoKc2VydmljZSBwZ2JvdW5jZXIgcmVzdGFydAoKCmVjaG8gIj4+ICR7QVBQX05BTUV9IEFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb24iCgpjYXNlICR7QVBQX05BTUV9IGluCnN0cmVhbWVyKikKICBDVVJSRU5UX0FQUF9ESVI9c3RyZWFtZXItY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj1zdHJlYW1lcl9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmRhdGEtZXhwb3J0LXRlc3RlcikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9kZWZhdWx0LnltbAogIG12IC9vcHQvZXZlbnQtJHtBUFBfTkFNRX0tY3VycmVudC8gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vCiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgbXYgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX0gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX1fbGludXhfYW1kNjQvJHtBUFBfTkFNRX0KICA7OwoqKQogIENVUlJFTlRfQVBQX0RJUj0ke0FQUF9OQU1FfS1jdXJyZW50CiAgTElOVVhfQU1ENjRfRElSPSR7QVBQX05BTUV9X2xpbnV4X2FtZDY0CiAgQ09ORklHX1BBVEg9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZgogIG1rZGlyIC1wIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9CiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgOzsKZXNhYwoKZWNobyAiPj4gQ3JlYXRpbmcgc2VsZi1zaWduZWQgY2VydGlmaWNhdGUgZm9yIGFwcCB1c2UiCm9wZW5zc2wgcmVxIC1uZXdrZXkgcnNhOjQwOTYgXAogIC14NTA5IFwKICAtc2hhMjU2IFwKICAtZGF5cyAzNjUwIFwKICAtbm9kZXMgXAogIC1vdXQgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQuY3J0IFwKICAta2V5b3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmtleSBcCiAgLXN1YmogIi9DPVVTL1NUPUNBL0w9T2FrbGFuZC9PPUxhdW5jaERhcmtseS9PVT1TZWN1cml0eS9DTj0ke0VDMl9JTlNUQU5DRV9JRH0iCmlmIFsgIC1uICIkKHVuYW1lIC1hIHwgZ3JlcCBVYnVudHUpIiBdOyB0aGVuCiAgY2hvd24gbm9ib2R5IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydAogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkKZmkKCiMgU2V0IEtJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQgYW5kIEtJTkVTSVNfU1RSRUFNX0VORFBPSU5UCnNlZCAtaSAicy9LSU5FU0lTX1NUUkVBTV9FTkRQT0lOVC8ke0tJTkVTSVNfU1RSRUFNX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgpzZWQgLWkgInMvS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVC8ke0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlR9L2ciICIkQ09ORklHX1BBVEgiCgoKCgplY2hvICI+PiBTeXN0ZW1kIENvbmZpZ3VyYXRpb24iCmFwcF9zM19wcmVmaXg9InMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0iCnN5c3RlbWRfdW5pdF9maWxlPSIvdXNyL2xvY2FsL2xpYi9zeXN0ZW1kL3N5c3RlbS8ke0FQUF9OQU1FfS5zZXJ2aWNlIgpta2RpciAtcCAiJChkaXJuYW1lICIkc3lzdGVtZF91bml0X2ZpbGUiKSIKYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LnN5c3RlbWQuY29uZiIgIiRzeXN0ZW1kX3VuaXRfZmlsZSIKCmlmIGdyZXAgLXFGICdzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiOyB0aGVuCiAgaWYgISBhd3MgczMgY3AgIiRhcHBfczNfcHJlZml4L3NzbS1lbnYtd3JhcHBlci5zaCIgL3Vzci9sb2NhbC9iaW4vc3NtLWVudi13cmFwcGVyLnNoOyB0aGVuCiAgICA+JjIgcHJpbnRmICdFUlJPUjogc3lzdGVtZCB1bml0ICIlcyIgdXNlcyAic3NtLWVudi13cmFwcGVyLnNoIiBidXQgY291bGQgbm90IGRvd25sb2FkIHNzbS1lbnYtd3JhcHBlci5zaCcgIiRzeXN0ZW1kX3VuaXRfZmlsZSIKICAgIGV4aXQgMQogIGZpCiAgY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vc3NtLWVudi13cmFwcGVyLnNoCmZpCgoKZWNobyAiPj4gU2V0IHVwIENvY2tyb2FjaGRiIGNlcnRzIgpta2RpciAtcCAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtZWFzdC0xOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvNjVhNjdhNWQtZTUyMS00MTk2LTg5ZWMtZWIxOWI3M2EyNjgwIgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0ucHJvZC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FPWNsaWVudC5nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCiAgZWNobyAiRXhlY1N0YXJ0UG9zdD0vYmluL3NoIC1jICdjaG93biBub2JvZHk6bm9ncm91cCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cy9jbGllbnQuZ29uZmFsb24uKiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZC8xMC1jZXJ0LWNvbmZpZy5jb25mCiMgV2UgZG9uJ3Qgd2FudCB0byBzdGFydCB0aGUgZGF0YWRvZyBzZXJ2aWNlIGZvciB0aGUgc2xhY2stYXBwCm1rZGlyIC1wIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtZWFzdC0xOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvNjVhNjdhNWQtZTUyMS00MTk2LTg5ZWMtZWIxOWI3M2EyNjgwIgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0ucHJvZC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKCgoKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCiMgZGlzYWJsZSBzY2hlZHVsZWQgdXBkYXRlcyBiZWNhdXNlIGdvbmZhbG9uIHdpbGwgbm90IHJlbG9hZCB0aGUgY2VydAojIGJ5IGFsbG93aW5nIHRoZSBjZXJ0IHRvIHJlbWFpbiB1bmNoYW5nZWQsIHdlIGNhbiBiZSBhbGVydGVkIHdoZW4gaXQgaXMgYWJvdXQgdG8gZXhwaXJlCiMgc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUudGltZXIKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnRpbWVyCgoKCnNlcnZpY2UgIiR7QVBQX05BTUV9IiByZXN0YXJ0CgpBVFRFTVBUUz0wCk1BWF9BVFRFTVBUUz0xMjAKUE9SVD0zMDAwCndoaWxlIFsgJEFUVEVNUFRTIC1uZSAkTUFYX0FUVEVNUFRTIF0gOyBkbwogICAgQVRURU1QVFM9JCgoQVRURU1QVFMrMSkpCiAgICBlY2hvICJXYWl0aW5nIGZvciBhcHBsaWNhdGlvbi4uLiAoJHtBVFRFTVBUU30vJHtNQVhfQVRURU1QVFN9KSIKICAgIGlmICEgdGltZW91dCAxIGJhc2ggLWMgImVjaG8gPi9kZXYvdGNwL2xvY2FsaG9zdC8ke1BPUlR9IjsgdGhlbgogICAgICAgIHNsZWVwIDE7CiAgICBlbHNlCiAgICAgICAgZWNobyAiQXBwbGljYXRpb24gaXMgcnVubmluZy4iCiAgICAgICAgYnJlYWsKICAgIGZpCiAgICBpZiBbICRBVFRFTVBUUyAtZXEgJE1BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgICAgZXhpdCAxOwogICAgZmkKZG9uZQoKc3lzdGVtY3RsIGVuYWJsZSAtLW5vdyBzeXNzdGF0LnNlcnZpY2UK",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "ld-prod",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "production-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "ld-prod",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-c1194aa5",
                "sg-d94f90ae",
                "sg-bdc1dbc2",
                "sg-b016fcd6",
                "sg-8e07b8c7",
                "sg-0210f16374948f868",
                "sg-0c4b952a1832d9abd",
                "sg-01c31bcefc5ffffa7",
                "sg-01b4a9c94632dcff1",
                "sg-07776fab78e8e27a3",
                "sg-03fdb07d91305fac6",
                "sg-04a1a4525abd517df",
                "sg-01391d5e3467d75d0",
                "sg-05bf7e2740de149d9"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "launchdarkly-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (production)",
                "dogfoodCanary": "false",
                "env": "production",
                "environment": "production",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-1",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "production"
              },
              "targetGroups": [
                "gonfalon-web-ld-prod",
                "gonfalon-web-internal-ld-prod"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            },
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-1": [
                  "us-east-1a"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1wcm9kdWN0aW9uCkxEX0FQUF9DT05GSUc9cHJvZApFTlZfU0hPUlRfTkFNRT1sZC1wcm9kCkVDMl9IT1NUTkFNRT0kKGhvc3RuYW1lKQpTM19DT05GSUdTX0JVQ0tFVD1sYXVuY2hkYXJrbHktY29uZmlncwoKU0xBQ0tfRU5EUE9JTlQ9Imh0dHBzOi8vaG9va3Muc2xhY2suY29tL3NlcnZpY2VzL1QwM05YMjQwVy9CR1EwTlRUMVMvVDZCUXVzNmdhbU4ycGFOMXhoT1Q1VHY1Igp0ZWxsX3NsYWNrX2NoYW5uZWwoKSB7CiAgICBjaGFubmVsPSIkMSIKICAgIG1lc3NhZ2U9IiQyIgogICAgY3VybCBcCiAgICAgICAgLS1zaWxlbnQgXAogICAgICAgIC0tc2hvdy1lcnJvciBcCiAgICAgICAgLS1yZXF1ZXN0IFBPU1QgXAogICAgICAgIC0taGVhZGVyICdDb250ZW50LXR5cGU6IGFwcGxpY2F0aW9uL2pzb24nIFwKICAgICAgICAtLWRhdGEgInsnY2hhbm5lbCc6XCIke2NoYW5uZWx9XCIsICd0ZXh0JzpcIiR7bWVzc2FnZX1cIn0iIFwKICAgICAgICAiJHtTTEFDS19FTkRQT0lOVH0iIFwKICAgIHx8IGVjaG8gIkZhaWxlZCB0byBzZW5kIG1lc3NhZ2UgdG8gU2xhY2sgIyR7Y2hhbm5lbH06ICR7bWVzc2FnZX0iID4mMgp9Cgp0ZWxsX3NsYWNrX29wc19yYXcoKSB7CiAgICBtZXNzYWdlPSIkMSIKICAgIGVjaG8gIj4+ICR7bWVzc2FnZX0iID4mMgogICAgdGVsbF9zbGFja19jaGFubmVsICJvcHMtcHJvZHVjdGlvbiIgIiR7bWVzc2FnZX0iCn0KCnRlbGxfc2xhY2tfb3BzKCkgewogICAgcmF3X21lc3NhZ2U9IiQxIgogICAgbWVzc2FnZT0iJHtFTlZJUk9OTUVOVH0vJHtFQzJfSE9TVE5BTUV9ICgke0FQUF9OQU1FfSk6ICR7cmF3X21lc3NhZ2V9IgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke21lc3NhZ2V9Igp9CiMgcnVuIHRoZSBzc2hfa2V5c19jbGVhbnVwIGNvbW1hbmQgdG8gZW5zdXJlIG5vIHNoYXJlZCBrZXlzIGFyZSBwcmVzZW50CnNzaF9rZXlzX2NsZWFudXAgfHwgdHJ1ZQoKbm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yKCkgewogIHJ2PSQ/CiAgaWYgWyAke3J2fSAtZXEgMCBdOyB0aGVuCiAgICBlY2hvICJBbGwgT0siCiAgZWxzZQogICAgc2VydmljZSAke0FQUF9OQU1FfSBzdG9wIHx8IHRydWUKICAgIEVSUk9SX01TRz0iQ2xvdWQtaW5pdCB1c2VyLWRhdGEgZmFpbGVkIHRvIHN1Y2NlZWQgKGV4aXQgY29kZSAke3J2fSkgb24gaW5zdGFuY2UgJHtFQzJfSE9TVE5BTUV9IGluICR7RU5WSVJPTk1FTlR9LiAgU3RvcHBpbmcgJHtBUFBfTkFNRX0gc28gdGhhdCBpbnN0YW5jZSBkb2VzIG5vdCByZWNlaXZlIGFueSB0cmFmZmljIGFuZCBzbyB0aGF0IGRlcGxveW1lbnQgY2FuIGZhaWwuIgogICAgdGVsbF9zbGFja19vcHNfcmF3ICIke0VSUk9SX01TR30iCiAgICBleGl0ICRydgogIGZpCn0KdHJhcCAibm90aWZ5X3RoYXRfd2VfaGl0X2FuX2Vycm9yIiBJTlQgVEVSTSBFWElUCkVDMl9JTlNUQU5DRV9JRD0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLWlkKQpFQzJfSVBWNF9MT0NBTF9BRERSPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvbG9jYWwtaXB2NCkKRUMyX0FWQUlMQUJJTElUWV9aT05FPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9tZXRhLWRhdGEvcGxhY2VtZW50L2F2YWlsYWJpbGl0eS16b25lLykKRUMyX1JFR0lPTj0kKGVjaG8gJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9IHwgc2VkICdzLy4kLy8nKQoKIyBGZXRjaCBgZG9nZm9vZENhbmFyeWAgdGFnIGZvciB0aGlzIGVjMiBpbnN0YW5jZS4gVXNpbmcgYXdzIGNsaSBiZWNhdXNlIFNwaW5uYWtlciBkb2Vzbid0ICh5ZXQpIGhhdmUgYW4gZWFzeSB3YXkgdG8gZW5hYmxlIHRoZSBJbnN0YW5jZU1ldGFkYXRhVGFncyBmZWF0dXJlLgojIFRoaXMgaXMgYSBiZXN0IGVmZm9ydC4gSWYgdGhlIElBTSBwZXJtaXNzaW9ucyBhcmVuJ3Qgc2V0IHVwIGNvcnJlY3RseSwgdGhpcyB3aWxsIHF1aWV0bHkgZmFpbCBhbmQgRE9HRk9PRF9DQU5BUllfRU5BQkxFRCB3aWxsIGJlIHNldCB0byAiZmFsc2UiLgpET0dGT09EX0NBTkFSWV9FTkFCTEVEPSQoYXdzIGVjMiBkZXNjcmliZS10YWdzIC0tZmlsdGVycyAiTmFtZT1yZXNvdXJjZS1pZCxWYWx1ZXM9JHtFQzJfSU5TVEFOQ0VfSUR9IiAiTmFtZT1rZXksVmFsdWVzPWRvZ2Zvb2RDYW5hcnkiIC0tcmVnaW9uICR7RUMyX1JFR0lPTn0gLS1xdWVyeSAnVGFnc1swXS5WYWx1ZScgLS1vdXRwdXQgdGV4dCB8fCB0cnVlKQoKIyBPbmx5IGFsbG93IGVpdGhlciBgdHJ1ZWAgb3IgYGZhbHNlYCB2YWx1ZXMgc28gd2UgZXJyIG9uIHRoZSBzaWRlIG9mIHNldHRpbmcgdGhpcyB0byBmYWxzZS4KaWYgWyAiJHtET0dGT09EX0NBTkFSWV9FTkFCTEVEfSIgIT0gInRydWUiIF07IHRoZW4KCURPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQ9ImZhbHNlIgpmaQoKIyBUaGlzIGZpbGUgZ2V0cyBwaWNrZWQgdXAgYnkgb3VyIHN5c3RlbWQgc2VydmljZQplY2hvICJET0dGT09EX0NBTkFSWV9FTkFCTEVEPSR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iID4gL29wdC9zeXN0ZW1kZW52CgoKS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVD0idnBjZS0wMjI5N2NiZTMzMjk5YTdkYi1ueDVqaGRvZi0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0uZmlyZWhvc2UudXMtZWFzdC0xLnZwY2UuYW1hem9uYXdzLmNvbSIKCktJTkVTSVNfU1RSRUFNX0VORFBPSU5UPSJ2cGNlLTAzOWIxNGRiZWIxMTk1MmRmLXN1N2t4NTRqLSR7RUMyX0FWQUlMQUJJTElUWV9aT05FfS5raW5lc2lzLnVzLWVhc3QtMS52cGNlLmFtYXpvbmF3cy5jb20iCgplY2hvICI+PiBEYXRhZG9nIGFnZW50IGNvbmZpZ3VyYXRpb24iCmF3cyBzMyBzeW5jIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vZGF0YWRvZy1hZ2VudC8gL2V0Yy9kYXRhZG9nLWFnZW50LyAtLWRlbGV0ZQoKWyAhIC1kIC92YXIvcnVuL2RhdGFkb2cgXSAmJiBta2RpciAtcCAvdmFyL3J1bi9kYXRhZG9nCgpjaG93biBkZC1hZ2VudDpkZC1hZ2VudCAvZXRjL2RhdGFkb2ctYWdlbnQvKiAvdmFyL3J1bi9kYXRhZG9nCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3N5c3RlbS1wcm9iZS55YW1sCmNob3duIHJvb3Q6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKY2htb2QgMDY0MCAvZXRjL2RhdGFkb2ctYWdlbnQvc2VjdXJpdHktYWdlbnQueWFtbAoKaWYgWyAtZiAiL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSIgXTsgdGhlbgogIFNIQT0kKGNhdCAvb3B0LyR7QVBQX05BTUV9LWN1cnJlbnQvU0hBKQogIHNlZCAtaSAicy9yZXBsYWNlLXdpdGgtc2hhLyR7U0hBfS8iIC9ldGMvZGF0YWRvZy1hZ2VudC9kYXRhZG9nLnlhbWwKZmkKCmZvciBzZXJ2aWNlX25hbWUgaW4gZGF0YWRvZy1hZ2VudCBkYXRhZG9nLWFnZW50LXByb2Nlc3MgZGF0YWRvZy1hZ2VudC10cmFjZSBkYXRhZG9nLWFnZW50LXN5c3Byb2JlOyBkbwogIHNlcnZpY2UgIiR7c2VydmljZV9uYW1lfSIgcmVzdGFydCB8fCB0ZWxsX3NsYWNrX29wcyAiJHtzZXJ2aWNlX25hbWV9IHJlc3RhcnQgZmFpbGVkIgpkb25lCgplY2hvICI+PiBwZ2JvdW5jZXIgQ29uZmlndXJhdGlvbiIKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vdXNlcmxpc3QudHh0IC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dApjaG93biBwb3N0Z3Jlczpwb3N0Z3JlcyAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2htb2QgNjAwIC9ldGMvcGdib3VuY2VyL3VzZXJsaXN0LnR4dAoKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vcGdib3VuY2VyLmNtdHBsIC9ldGMvY29uc3VsLXRlbXBsYXRlL3BnYm91bmNlci5jbXRwbAphd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS9nb25mYWxvbi9jb25zdWwtdGVtcGxhdGUuY29uZiAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9jb25zdWwtdGVtcGxhdGUuY29uZgpzZXJ2aWNlIGNvbnN1bC10ZW1wbGF0ZSByZXN0YXJ0CnNsZWVwIDEwCgoKc2VydmljZSBwZ2JvdW5jZXIgcmVzdGFydAoKCmVjaG8gIj4+ICR7QVBQX05BTUV9IEFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb24iCgpjYXNlICR7QVBQX05BTUV9IGluCnN0cmVhbWVyKikKICBDVVJSRU5UX0FQUF9ESVI9c3RyZWFtZXItY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj1zdHJlYW1lcl9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmRhdGEtZXhwb3J0LXRlc3RlcikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9kZWZhdWx0LnltbAogIG12IC9vcHQvZXZlbnQtJHtBUFBfTkFNRX0tY3VycmVudC8gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vCiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgbXYgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX0gL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtBUFBfTkFNRX1fbGludXhfYW1kNjQvJHtBUFBfTkFNRX0KICA7OwoqKQogIENVUlJFTlRfQVBQX0RJUj0ke0FQUF9OQU1FfS1jdXJyZW50CiAgTElOVVhfQU1ENjRfRElSPSR7QVBQX05BTUV9X2xpbnV4X2FtZDY0CiAgQ09ORklHX1BBVEg9L29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZgogIG1rZGlyIC1wIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9CiAgYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mICIkQ09ORklHX1BBVEgiCiAgOzsKZXNhYwoKZWNobyAiPj4gQ3JlYXRpbmcgc2VsZi1zaWduZWQgY2VydGlmaWNhdGUgZm9yIGFwcCB1c2UiCm9wZW5zc2wgcmVxIC1uZXdrZXkgcnNhOjQwOTYgXAogIC14NTA5IFwKICAtc2hhMjU2IFwKICAtZGF5cyAzNjUwIFwKICAtbm9kZXMgXAogIC1vdXQgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQuY3J0IFwKICAta2V5b3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmtleSBcCiAgLXN1YmogIi9DPVVTL1NUPUNBL0w9T2FrbGFuZC9PPUxhdW5jaERhcmtseS9PVT1TZWN1cml0eS9DTj0ke0VDMl9JTlNUQU5DRV9JRH0iCmlmIFsgIC1uICIkKHVuYW1lIC1hIHwgZ3JlcCBVYnVudHUpIiBdOyB0aGVuCiAgY2hvd24gbm9ib2R5IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydAogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkKZmkKCiMgU2V0IEtJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQgYW5kIEtJTkVTSVNfU1RSRUFNX0VORFBPSU5UCnNlZCAtaSAicy9LSU5FU0lTX1NUUkVBTV9FTkRQT0lOVC8ke0tJTkVTSVNfU1RSRUFNX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgpzZWQgLWkgInMvS0lORVNJU19GSVJFSE9TRV9FTkRQT0lOVC8ke0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlR9L2ciICIkQ09ORklHX1BBVEgiCgoKCgplY2hvICI+PiBTeXN0ZW1kIENvbmZpZ3VyYXRpb24iCmFwcF9zM19wcmVmaXg9InMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vJHtBUFBfTkFNRX0iCnN5c3RlbWRfdW5pdF9maWxlPSIvdXNyL2xvY2FsL2xpYi9zeXN0ZW1kL3N5c3RlbS8ke0FQUF9OQU1FfS5zZXJ2aWNlIgpta2RpciAtcCAiJChkaXJuYW1lICIkc3lzdGVtZF91bml0X2ZpbGUiKSIKYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LnN5c3RlbWQuY29uZiIgIiRzeXN0ZW1kX3VuaXRfZmlsZSIKCmlmIGdyZXAgLXFGICdzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiOyB0aGVuCiAgaWYgISBhd3MgczMgY3AgIiRhcHBfczNfcHJlZml4L3NzbS1lbnYtd3JhcHBlci5zaCIgL3Vzci9sb2NhbC9iaW4vc3NtLWVudi13cmFwcGVyLnNoOyB0aGVuCiAgICA+JjIgcHJpbnRmICdFUlJPUjogc3lzdGVtZCB1bml0ICIlcyIgdXNlcyAic3NtLWVudi13cmFwcGVyLnNoIiBidXQgY291bGQgbm90IGRvd25sb2FkIHNzbS1lbnYtd3JhcHBlci5zaCcgIiRzeXN0ZW1kX3VuaXRfZmlsZSIKICAgIGV4aXQgMQogIGZpCiAgY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vc3NtLWVudi13cmFwcGVyLnNoCmZpCgoKZWNobyAiPj4gU2V0IHVwIENvY2tyb2FjaGRiIGNlcnRzIgpta2RpciAtcCAvZXRjL3N5c3RlbWQvc3lzdGVtL2NvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtZWFzdC0xOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvNjVhNjdhNWQtZTUyMS00MTk2LTg5ZWMtZWIxOWI3M2EyNjgwIgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0ucHJvZC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FPWNsaWVudC5nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCiAgZWNobyAiRXhlY1N0YXJ0UG9zdD0vYmluL3NoIC1jICdjaG93biBub2JvZHk6bm9ncm91cCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cy9jbGllbnQuZ29uZmFsb24uKiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZC8xMC1jZXJ0LWNvbmZpZy5jb25mCiMgV2UgZG9uJ3Qgd2FudCB0byBzdGFydCB0aGUgZGF0YWRvZyBzZXJ2aWNlIGZvciB0aGUgc2xhY2stYXBwCm1rZGlyIC1wIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtZWFzdC0xOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvNjVhNjdhNWQtZTUyMS00MTk2LTg5ZWMtZWIxOWI3M2EyNjgwIgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0ucHJvZC5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUU9Y2xpZW50LmRhdGFkb2ciCiAgZWNobyAiRW52aXJvbm1lbnQ9QkFTRV9GSUxFX05BTUVfRkxBRz0nLWYnIgp9IHwgdGVlIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kLzEwLWNlcnQtY29uZmlnLmNvbmYKCgoKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS5zZXJ2aWNlCiMgZGlzYWJsZSBzY2hlZHVsZWQgdXBkYXRlcyBiZWNhdXNlIGdvbmZhbG9uIHdpbGwgbm90IHJlbG9hZCB0aGUgY2VydAojIGJ5IGFsbG93aW5nIHRoZSBjZXJ0IHRvIHJlbWFpbiB1bmNoYW5nZWQsIHdlIGNhbiBiZSBhbGVydGVkIHdoZW4gaXQgaXMgYWJvdXQgdG8gZXhwaXJlCiMgc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1hcHAtY2VydGlmaWNhdGUudGltZXIKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnNlcnZpY2UKc3lzdGVtY3RsIHN0YXJ0IGNvY2tyb2FjaGRiLWNsaWVudC1kYXRhZG9nLWNlcnRpZmljYXRlLnRpbWVyCgoKCnNlcnZpY2UgIiR7QVBQX05BTUV9IiByZXN0YXJ0CgpBVFRFTVBUUz0wCk1BWF9BVFRFTVBUUz0xMjAKUE9SVD0zMDAwCndoaWxlIFsgJEFUVEVNUFRTIC1uZSAkTUFYX0FUVEVNUFRTIF0gOyBkbwogICAgQVRURU1QVFM9JCgoQVRURU1QVFMrMSkpCiAgICBlY2hvICJXYWl0aW5nIGZvciBhcHBsaWNhdGlvbi4uLiAoJHtBVFRFTVBUU30vJHtNQVhfQVRURU1QVFN9KSIKICAgIGlmICEgdGltZW91dCAxIGJhc2ggLWMgImVjaG8gPi9kZXYvdGNwL2xvY2FsaG9zdC8ke1BPUlR9IjsgdGhlbgogICAgICAgIHNsZWVwIDE7CiAgICBlbHNlCiAgICAgICAgZWNobyAiQXBwbGljYXRpb24gaXMgcnVubmluZy4iCiAgICAgICAgYnJlYWsKICAgIGZpCiAgICBpZiBbICRBVFRFTVBUUyAtZXEgJE1BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgICAgZXhpdCAxOwogICAgZmkKZG9uZQoKc3lzdGVtY3RsIGVuYWJsZSAtLW5vdyBzeXNzdGF0LnNlcnZpY2UK",
              "capacity": {
                "desired": 1,
                "max": 1,
                "min": 1
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 1800,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "ld-prod-dogfood-canary",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "production-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "ld-prod",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-c1194aa5",
                "sg-d94f90ae",
                "sg-bdc1dbc2",
                "sg-b016fcd6",
                "sg-8e07b8c7",
                "sg-0210f16374948f868",
                "sg-0c4b952a1832d9abd",
                "sg-01c31bcefc5ffffa7",
                "sg-01b4a9c94632dcff1",
                "sg-07776fab78e8e27a3",
                "sg-03fdb07d91305fac6",
                "sg-04a1a4525abd517df",
                "sg-01391d5e3467d75d0",
                "sg-05bf7e2740de149d9"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "launchdarkly-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (production)",
                "dogfoodCanary": "true",
                "env": "production",
                "environment": "production",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-1",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "production"
              },
              "targetGroups": [
                "gonfalon-web-ld-prod",
                "gonfalon-web-internal-ld-prod"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to production",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-production@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to production.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!production !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "lookup_baked_artifact_ami_id",
            "run_db_migrations_coderefs-crdb",
            "run_db_migrations_oauth2-crdb",
            "run_db_migrations_accounts-crdb",
            "run_db_migrations_gonfalon-accounts-crdb",
            "run_db_migrations_gonfalon-billing-crdb",
            "run_db_migrations_gonfalon-file-jobs-crdb",
            "run_db_migrations_gonfalon-integrations-crdb",
            "run_db_migrations_gonfalon-workflows-crdb",
            "run_db_migrations_gonfalon-experimentation-crdb"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 7200000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "production"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/production"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - production - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"production\",\n  \"eventType\": \"started\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate started notification",
          "refId": "accelerate_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"production\",\n  \"eventType\": \"finished\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate finished notification",
          "refId": "accelerate_finished",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://zepq2yt1c5.execute-api.us-east-1.amazonaws.com/beta/cleanup"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\"repoName\": \"gonfalon\",\n\t\"startSHA\": \"${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }\",\n\t\"endSHA\": \"${ trigger['parameters']['sha'] }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/global/services/cloubhouse_cleanup/authorization_key\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Close related Clubhouse issues",
          "refId": "clubhouse",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://calibreapp.com/api/sites/launchdarkly-front-end-perf/deploys"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"secret\": \"{{`{{ ssm \"/shared-services/us-east-1/applications/spinnaker/gonfalon_production_calibre_site_secret\" }}`}}\",\n\t\t\"revision\": \"${ parameters.sha }\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Post deploy to Calibre",
          "refId": "calibre",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "continuePipeline": true,
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-redocly-deploy",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "REDOCLY_API_TOKEN_SSM_PATH",
                          "value": "/production/common/services/apidocs/redocly_api_key"
                        },
                        {
                          "name": "OPENAPI_VERSION",
                          "value": "20191212"
                        },
                        {
                          "name": "REDOCLY_REGISTRY",
                          "value": "LaunchDarkly Production"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/redocly-deploy:latest",
                      "name": "redocly-deploy"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run Deploy API Docs",
          "refId": "deploy_redocly",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-production deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-production",
            "text": "${ trigger.user } is done deploying gonfalon-web - production with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-production",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish",
            "clubhouse",
            "calibre",
            "deploy_redocly"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"production\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": [
        {
          "enabled": true,
          "expectedArtifactIds": [],
          "payloadConstraints": {
            "status": "thumbed"
          },
          "runAsUser": "api-service-account@launchdarkly.com",
          "source": "01d08837-5c1f-4f6e-acbd-a6bbb992e352",
          "type": "webhook"
        }
      ]
    },
    {
      "appConfig": {},
      "application": "gonfalon",
      "expectedArtifacts": [],
      "keepWaitingPipelines": false,
      "limitConcurrent": true,
      "name": "gonfalon-web - staging",
      "notifications": [
        {
          "address": "gonfalon",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "eng-deploys",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "ops-deploy-alerts",
          "level": "pipeline",
          "type": "slack",
          "when": [
            "pipeline.failed"
          ]
        },
        {
          "address": "gonfalon-drift-email.oqd3r7nr@launchdarkly.pagerduty.com",
          "level": "pipeline",
          "type": "email",
          "when": [
            "pipeline.failed"
          ]
        }
      ],
      "parameterConfig": [
        {
          "name": "sha",
          "description": "Artifact SHA to deploy",
          "hasOptions": false,
          "label": "Artifact SHA to deploy",
          "required": true,
          "default": ""
        },
        {
          "name": "ec2_instance_type",
          "description": "EC2 instance type",
          "hasOptions": true,
          "label": "EC2 instance type",
          "required": true,
          "options": [
            {
              "value": "m5a.xlarge"
            },
            {
              "value": "m5a.2xlarge"
            }
          ],
          "default": "m5a.xlarge"
        },
        {
          "name": "base_ami_name_prefix",
          "description": "Prefix for the base AMI name",
          "hasOptions": false,
          "label": "Prefix for the base AMI name",
          "required": true,
          "default": "ld-"
        },
        {
          "name": "rollbar_access_token_ssm_path",
          "description": "Rollbar Access Token SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/gonfalon/rollbar_token"
        },
        {
          "name": "sleuth_api_key_ssm_path",
          "description": "Sleuth Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/global/services/sleuth/api_key"
        },
        {
          "name": "honeycomb_api_key_ssm_path",
          "description": "Honeycomb Api Key SSM Path",
          "hasOptions": false,
          "label": "",
          "required": false,
          "default": "/staging/common/services/honeycomb/write_key"
        }
      ],
      "stages": [
        {
          "continuePipeline": true,
          "customHeaders": {
            "X-LD-Private": "allowed"
          },
          "failPipeline": false,
          "method": "GET",
          "name": "Determine current version",
          "overrideTimeout": true,
          "refId": "determine_deployed_app_version",
          "requisiteStageRefIds": [],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://gonfalon-internal.stg.launchdarkly.com/api/status"
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-staging deploy is happening",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-staging",
            "text": "${ trigger.user } is really :deploying: gonfalon-web - staging with version ${ parameters.sha }. Follow progress at https://deploy.launchdarkly.com/#/applications/gonfalon/executions/${ execution.id } "
          },
          "refId": "notification_deploy_start_ops-staging",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"staging\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"started\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (started)",
          "refId": "rollbar_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "amiName": "gonfalon-web-${ parameters.sha }",
          "baseLabel": "release",
          "baseOs": "ubuntu",
          "cloudProviderType": "aws",
          "extendedAttributes": {
            "app_name": "gonfalon",
            "app_type": "web",
            "aws_ami_owners": "061661829416",
            "aws_ami_users": "554582317989,506919356135,527291094460",
            "aws_encrypt_boot": "false",
            "aws_kms_key_id": "",
            "aws_source_ami_filter": "${ parameters.base_ami_name_prefix }gonfalon-base-ami*",
            "environment": "staging",
            "iam_instance_profile": "SpinnakerPackerInstanceProfile",
            "os": "ubuntu",
            "s3_artifact_bucket": "launchdarkly-artifacts",
            "sha": "${ parameters.sha }"
          },
          "name": "Bake Multi-Region AMI",
          "package": "gonfalon-web-${ parameters.sha }",
          "rebake": false,
          "refId": "bake_multi_region_ami",
          "regions": [
            "us-east-1",
            "us-east-2",
            "us-west-2"
          ],
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "stageTimeoutMs": 2700000,
          "storeType": "ebs",
          "templateFileName": "aws-launchdarkly-filter.json",
          "type": "bake",
          "user": "[anonymous]",
          "vmType": "hvm"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-coderefs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "coderefs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for coderefs-crdb",
          "refId": "run_db_migrations_coderefs-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-oauth2-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "oauth2-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for oauth2-crdb",
          "refId": "run_db_migrations_oauth2-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for accounts-crdb",
          "refId": "run_db_migrations_accounts-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-accounts-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-accounts-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-accounts-crdb",
          "refId": "run_db_migrations_gonfalon-accounts-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-billing-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-billing-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-billing-crdb",
          "refId": "run_db_migrations_gonfalon-billing-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-file-jobs-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-file-jobs-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-file-jobs-crdb",
          "refId": "run_db_migrations_gonfalon-file-jobs-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-integrations-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-integrations-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-integrations-crdb",
          "refId": "run_db_migrations_gonfalon-integrations-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-workflows-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-workflows-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-workflows-crdb",
          "refId": "run_db_migrations_gonfalon-workflows-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-db-migrations-gonfalon-experimentation-crdb",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "command": [
                        "/bin/run-migrations"
                      ],
                      "env": [
                        {
                          "name": "SHA",
                          "value": "${ parameters['sha'] }"
                        },
                        {
                          "name": "DATABASE",
                          "value": "gonfalon-experimentation-crdb"
                        },
                        {
                          "name": "ENV_SHORT_NAME",
                          "value": "staging"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/mild:latest",
                      "name": "run-migrations"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run DB migrations for gonfalon-experimentation-crdb",
          "refId": "run_db_migrations_gonfalon-experimentation-crdb",
          "requisiteStageRefIds": [
            "bake_multi_region_ami"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "clusters": [
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-1": [
                  "us-east-1a",
                  "us-east-1b",
                  "us-east-1c"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1zdGFnaW5nCkxEX0FQUF9DT05GSUc9c3RnCkVOVl9TSE9SVF9OQU1FPWxkLXN0ZwpFQzJfSE9TVE5BTUU9JChob3N0bmFtZSkKUzNfQ09ORklHU19CVUNLRVQ9bGF1bmNoZGFya2x5LWNvbmZpZ3MKClNMQUNLX0VORFBPSU5UPSJodHRwczovL2hvb2tzLnNsYWNrLmNvbS9zZXJ2aWNlcy9UMDNOWDI0MFcvQkdRME5UVDFTL1Q2QlF1czZnYW1OMnBhTjF4aE9UNVR2NSIKdGVsbF9zbGFja19jaGFubmVsKCkgewogICAgY2hhbm5lbD0iJDEiCiAgICBtZXNzYWdlPSIkMiIKICAgIGN1cmwgXAogICAgICAgIC0tc2lsZW50IFwKICAgICAgICAtLXNob3ctZXJyb3IgXAogICAgICAgIC0tcmVxdWVzdCBQT1NUIFwKICAgICAgICAtLWhlYWRlciAnQ29udGVudC10eXBlOiBhcHBsaWNhdGlvbi9qc29uJyBcCiAgICAgICAgLS1kYXRhICJ7J2NoYW5uZWwnOlwiJHtjaGFubmVsfVwiLCAndGV4dCc6XCIke21lc3NhZ2V9XCJ9IiBcCiAgICAgICAgIiR7U0xBQ0tfRU5EUE9JTlR9IiBcCiAgICB8fCBlY2hvICJGYWlsZWQgdG8gc2VuZCBtZXNzYWdlIHRvIFNsYWNrICMke2NoYW5uZWx9OiAke21lc3NhZ2V9IiA+JjIKfQoKdGVsbF9zbGFja19vcHNfcmF3KCkgewogICAgbWVzc2FnZT0iJDEiCiAgICBlY2hvICI+PiAke21lc3NhZ2V9IiA+JjIKICAgIHRlbGxfc2xhY2tfY2hhbm5lbCAib3BzLXN0YWdpbmciICIke21lc3NhZ2V9Igp9Cgp0ZWxsX3NsYWNrX29wcygpIHsKICAgIHJhd19tZXNzYWdlPSIkMSIKICAgIG1lc3NhZ2U9IiR7RU5WSVJPTk1FTlR9LyR7RUMyX0hPU1ROQU1FfSAoJHtBUFBfTkFNRX0pOiAke3Jhd19tZXNzYWdlfSIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHttZXNzYWdlfSIKfQojIHJ1biB0aGUgc3NoX2tleXNfY2xlYW51cCBjb21tYW5kIHRvIGVuc3VyZSBubyBzaGFyZWQga2V5cyBhcmUgcHJlc2VudApzc2hfa2V5c19jbGVhbnVwIHx8IHRydWUKCm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvcigpIHsKICBydj0kPwogIGlmIFsgJHtydn0gLWVxIDAgXTsgdGhlbgogICAgZWNobyAiQWxsIE9LIgogIGVsc2UKICAgIHNlcnZpY2UgJHtBUFBfTkFNRX0gc3RvcCB8fCB0cnVlCiAgICBFUlJPUl9NU0c9IkNsb3VkLWluaXQgdXNlci1kYXRhIGZhaWxlZCB0byBzdWNjZWVkIChleGl0IGNvZGUgJHtydn0pIG9uIGluc3RhbmNlICR7RUMyX0hPU1ROQU1FfSBpbiAke0VOVklST05NRU5UfS4gIFN0b3BwaW5nICR7QVBQX05BTUV9IHNvIHRoYXQgaW5zdGFuY2UgZG9lcyBub3QgcmVjZWl2ZSBhbnkgdHJhZmZpYyBhbmQgc28gdGhhdCBkZXBsb3ltZW50IGNhbiBmYWlsLiIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHtFUlJPUl9NU0d9IgogICAgZXhpdCAkcnYKICBmaQp9CnRyYXAgIm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvciIgSU5UIFRFUk0gRVhJVApFQzJfSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKRUMyX0lQVjRfTE9DQUxfQUREUj0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCkVDMl9BVkFJTEFCSUxJVFlfWk9ORT0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL3BsYWNlbWVudC9hdmFpbGFiaWxpdHktem9uZS8pCkVDMl9SRUdJT049JChlY2hvICR7RUMyX0FWQUlMQUJJTElUWV9aT05FfSB8IHNlZCAncy8uJC8vJykKCiMgRmV0Y2ggYGRvZ2Zvb2RDYW5hcnlgIHRhZyBmb3IgdGhpcyBlYzIgaW5zdGFuY2UuIFVzaW5nIGF3cyBjbGkgYmVjYXVzZSBTcGlubmFrZXIgZG9lc24ndCAoeWV0KSBoYXZlIGFuIGVhc3kgd2F5IHRvIGVuYWJsZSB0aGUgSW5zdGFuY2VNZXRhZGF0YVRhZ3MgZmVhdHVyZS4KIyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQuIElmIHRoZSBJQU0gcGVybWlzc2lvbnMgYXJlbid0IHNldCB1cCBjb3JyZWN0bHksIHRoaXMgd2lsbCBxdWlldGx5IGZhaWwgYW5kIERPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQgd2lsbCBiZSBzZXQgdG8gImZhbHNlIi4KRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0kKGF3cyBlYzIgZGVzY3JpYmUtdGFncyAtLWZpbHRlcnMgIk5hbWU9cmVzb3VyY2UtaWQsVmFsdWVzPSR7RUMyX0lOU1RBTkNFX0lEfSIgIk5hbWU9a2V5LFZhbHVlcz1kb2dmb29kQ2FuYXJ5IiAtLXJlZ2lvbiAke0VDMl9SRUdJT059IC0tcXVlcnkgJ1RhZ3NbMF0uVmFsdWUnIC0tb3V0cHV0IHRleHQgfHwgdHJ1ZSkKCiMgT25seSBhbGxvdyBlaXRoZXIgYHRydWVgIG9yIGBmYWxzZWAgdmFsdWVzIHNvIHdlIGVyciBvbiB0aGUgc2lkZSBvZiBzZXR0aW5nIHRoaXMgdG8gZmFsc2UuCmlmIFsgIiR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iICE9ICJ0cnVlIiBdOyB0aGVuCglET0dGT09EX0NBTkFSWV9FTkFCTEVEPSJmYWxzZSIKZmkKCiMgVGhpcyBmaWxlIGdldHMgcGlja2VkIHVwIGJ5IG91ciBzeXN0ZW1kIHNlcnZpY2UKZWNobyAiRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0ke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiA+IC9vcHQvc3lzdGVtZGVudgoKCktJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQ9InZwY2UtMDIyOTdjYmUzMzI5OWE3ZGItbng1amhkb2YtJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9LmZpcmVob3NlLnVzLWVhc3QtMS52cGNlLmFtYXpvbmF3cy5jb20iCgpLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVD0idnBjZS0wMzliMTRkYmViMTE5NTJkZi1zdTdreDU0ai0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0ua2luZXNpcy51cy1lYXN0LTEudnBjZS5hbWF6b25hd3MuY29tIgoKZWNobyAiPj4gRGF0YWRvZyBhZ2VudCBjb25maWd1cmF0aW9uIgphd3MgczMgc3luYyBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2RhdGFkb2ctYWdlbnQvIC9ldGMvZGF0YWRvZy1hZ2VudC8gLS1kZWxldGUKClsgISAtZCAvdmFyL3J1bi9kYXRhZG9nIF0gJiYgbWtkaXIgLXAgL3Zhci9ydW4vZGF0YWRvZwoKY2hvd24gZGQtYWdlbnQ6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50LyogL3Zhci9ydW4vZGF0YWRvZwpjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG1vZCAwNjQwIC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zZWN1cml0eS1hZ2VudC55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKCmlmIFsgLWYgIi9vcHQvJHtBUFBfTkFNRX0tY3VycmVudC9TSEEiIF07IHRoZW4KICBTSEE9JChjYXQgL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSkKICBzZWQgLWkgInMvcmVwbGFjZS13aXRoLXNoYS8ke1NIQX0vIiAvZXRjL2RhdGFkb2ctYWdlbnQvZGF0YWRvZy55YW1sCmZpCgpmb3Igc2VydmljZV9uYW1lIGluIGRhdGFkb2ctYWdlbnQgZGF0YWRvZy1hZ2VudC1wcm9jZXNzIGRhdGFkb2ctYWdlbnQtdHJhY2UgZGF0YWRvZy1hZ2VudC1zeXNwcm9iZTsgZG8KICBzZXJ2aWNlICIke3NlcnZpY2VfbmFtZX0iIHJlc3RhcnQgfHwgdGVsbF9zbGFja19vcHMgIiR7c2VydmljZV9uYW1lfSByZXN0YXJ0IGZhaWxlZCIKZG9uZQoKZWNobyAiPj4gcGdib3VuY2VyIENvbmZpZ3VyYXRpb24iCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3VzZXJsaXN0LnR4dCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2hvd24gcG9zdGdyZXM6cG9zdGdyZXMgL2V0Yy9wZ2JvdW5jZXIvdXNlcmxpc3QudHh0CmNobW9kIDYwMCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9wZ2JvdW5jZXIuY210cGwKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vY29uc3VsLXRlbXBsYXRlLmNvbmYgL2V0Yy9jb25zdWwtdGVtcGxhdGUvY29uc3VsLXRlbXBsYXRlLmNvbmYKc2VydmljZSBjb25zdWwtdGVtcGxhdGUgcmVzdGFydApzbGVlcCAxMAoKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgojIFNldCBLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UIGFuZCBLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVApzZWQgLWkgInMvS0lORVNJU19TVFJFQU1fRU5EUE9JTlQvJHtLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVH0vZyIgIiRDT05GSUdfUEFUSCIKc2VkIC1pICJzL0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQvJHtLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgoKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLWVhc3QtMTo1NTQ1ODIzMTc5ODk6Y2VydGlmaWNhdGUtYXV0aG9yaXR5LzkwMjUzNzYxLThlMjctNDM0ZC1iNzAxLWZmNzFlNzE4YjVjYyIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnN0Zy5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FPWNsaWVudC5nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCiAgZWNobyAiRXhlY1N0YXJ0UG9zdD0vYmluL3NoIC1jICdjaG93biBub2JvZHk6bm9ncm91cCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cy9jbGllbnQuZ29uZmFsb24uKiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZC8xMC1jZXJ0LWNvbmZpZy5jb25mCiMgV2UgZG9uJ3Qgd2FudCB0byBzdGFydCB0aGUgZGF0YWRvZyBzZXJ2aWNlIGZvciB0aGUgc2xhY2stYXBwCm1rZGlyIC1wIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtZWFzdC0xOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvOTAyNTM3NjEtOGUyNy00MzRkLWI3MDEtZmY3MWU3MThiNWNjIgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0uc3RnLmxhdW5jaGRhcmtseS5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049ZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgoKCgoKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UKIyBkaXNhYmxlIHNjaGVkdWxlZCB1cGRhdGVzIGJlY2F1c2UgZ29uZmFsb24gd2lsbCBub3QgcmVsb2FkIHRoZSBjZXJ0CiMgYnkgYWxsb3dpbmcgdGhlIGNlcnQgdG8gcmVtYWluIHVuY2hhbmdlZCwgd2UgY2FuIGJlIGFsZXJ0ZWQgd2hlbiBpdCBpcyBhYm91dCB0byBleHBpcmUKIyBzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS50aW1lcgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZQpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUudGltZXIKCgoKc2VydmljZSAiJHtBUFBfTkFNRX0iIHJlc3RhcnQKCkFUVEVNUFRTPTAKTUFYX0FUVEVNUFRTPTEyMApQT1JUPTMwMDAKd2hpbGUgWyAkQVRURU1QVFMgLW5lICRNQVhfQVRURU1QVFMgXSA7IGRvCiAgICBBVFRFTVBUUz0kKChBVFRFTVBUUysxKSkKICAgIGVjaG8gIldhaXRpbmcgZm9yIGFwcGxpY2F0aW9uLi4uICgke0FUVEVNUFRTfS8ke01BWF9BVFRFTVBUU30pIgogICAgaWYgISB0aW1lb3V0IDEgYmFzaCAtYyAiZWNobyA+L2Rldi90Y3AvbG9jYWxob3N0LyR7UE9SVH0iOyB0aGVuCiAgICAgICAgc2xlZXAgMTsKICAgIGVsc2UKICAgICAgICBlY2hvICJBcHBsaWNhdGlvbiBpcyBydW5uaW5nLiIKICAgICAgICBicmVhawogICAgZmkKICAgIGlmIFsgJEFUVEVNUFRTIC1lcSAkTUFYX0FUVEVNUFRTIF07IHRoZW4KICAgICAgICBleGl0IDE7CiAgICBmaQpkb25lCgpzeXN0ZW1jdGwgZW5hYmxlIC0tbm93IHN5c3N0YXQuc2VydmljZQo=",
              "capacity": {
                "desired": 2,
                "max": 2,
                "min": 2
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 300,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "ld-stg",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "staging-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "ld-stg",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-6d2d7d09",
                "sg-8720fff0",
                "sg-ea3d2e95",
                "sg-b016fcd6",
                "sg-9eb16dd7",
                "sg-0f5148ef05cf05c3f",
                "sg-097f9a0a312508f21",
                "sg-0a6e9f9d25e69eb66",
                "sg-0c2a7585136e6ff6b",
                "sg-0aa07965745f27fd4",
                "sg-0a437487d63666bee",
                "sg-091749c543fb38405",
                "sg-050f06fe8c17db7e2",
                "sg-077d6bdb5d655df02",
                "sg-097e5a5ed46e7b6e4"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "launchdarkly-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (staging)",
                "dogfoodCanary": "false",
                "env": "staging",
                "environment": "staging",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-1",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "staging"
              },
              "targetGroups": [
                "gonfalon-web-ld-stg",
                "gonfalon-web-internal-ld-stg"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            },
            {
              "account": "launchdarkly-production",
              "application": "gonfalon",
              "associatePublicIpAddress": false,
              "availabilityZones": {
                "us-east-1": [
                  "us-east-1a"
                ]
              },
              "base64UserData": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGVidWdfdHJhcCgpIHsKICBUSU1FU1RBTVA9JCgvYmluL2RhdGUgJyslbS8lZC8lWSAlSDolTTolUycpCiAgcHJpbnRmICJbJXNdID4gJXNcbiIgIiRUSU1FU1RBTVAiICIkQkFTSF9DT01NQU5EIgogIHJldHVybiAwCn0KCnRyYXAgZGVidWdfdHJhcCBERUJVRwpzZXQgLXVlCgp1bWFzayAwMDIyCgpBUFBfTkFNRT1nb25mYWxvbgpFTlZJUk9OTUVOVD1zdGFnaW5nCkxEX0FQUF9DT05GSUc9c3RnCkVOVl9TSE9SVF9OQU1FPWxkLXN0ZwpFQzJfSE9TVE5BTUU9JChob3N0bmFtZSkKUzNfQ09ORklHU19CVUNLRVQ9bGF1bmNoZGFya2x5LWNvbmZpZ3MKClNMQUNLX0VORFBPSU5UPSJodHRwczovL2hvb2tzLnNsYWNrLmNvbS9zZXJ2aWNlcy9UMDNOWDI0MFcvQkdRME5UVDFTL1Q2QlF1czZnYW1OMnBhTjF4aE9UNVR2NSIKdGVsbF9zbGFja19jaGFubmVsKCkgewogICAgY2hhbm5lbD0iJDEiCiAgICBtZXNzYWdlPSIkMiIKICAgIGN1cmwgXAogICAgICAgIC0tc2lsZW50IFwKICAgICAgICAtLXNob3ctZXJyb3IgXAogICAgICAgIC0tcmVxdWVzdCBQT1NUIFwKICAgICAgICAtLWhlYWRlciAnQ29udGVudC10eXBlOiBhcHBsaWNhdGlvbi9qc29uJyBcCiAgICAgICAgLS1kYXRhICJ7J2NoYW5uZWwnOlwiJHtjaGFubmVsfVwiLCAndGV4dCc6XCIke21lc3NhZ2V9XCJ9IiBcCiAgICAgICAgIiR7U0xBQ0tfRU5EUE9JTlR9IiBcCiAgICB8fCBlY2hvICJGYWlsZWQgdG8gc2VuZCBtZXNzYWdlIHRvIFNsYWNrICMke2NoYW5uZWx9OiAke21lc3NhZ2V9IiA+JjIKfQoKdGVsbF9zbGFja19vcHNfcmF3KCkgewogICAgbWVzc2FnZT0iJDEiCiAgICBlY2hvICI+PiAke21lc3NhZ2V9IiA+JjIKICAgIHRlbGxfc2xhY2tfY2hhbm5lbCAib3BzLXN0YWdpbmciICIke21lc3NhZ2V9Igp9Cgp0ZWxsX3NsYWNrX29wcygpIHsKICAgIHJhd19tZXNzYWdlPSIkMSIKICAgIG1lc3NhZ2U9IiR7RU5WSVJPTk1FTlR9LyR7RUMyX0hPU1ROQU1FfSAoJHtBUFBfTkFNRX0pOiAke3Jhd19tZXNzYWdlfSIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHttZXNzYWdlfSIKfQojIHJ1biB0aGUgc3NoX2tleXNfY2xlYW51cCBjb21tYW5kIHRvIGVuc3VyZSBubyBzaGFyZWQga2V5cyBhcmUgcHJlc2VudApzc2hfa2V5c19jbGVhbnVwIHx8IHRydWUKCm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvcigpIHsKICBydj0kPwogIGlmIFsgJHtydn0gLWVxIDAgXTsgdGhlbgogICAgZWNobyAiQWxsIE9LIgogIGVsc2UKICAgIHNlcnZpY2UgJHtBUFBfTkFNRX0gc3RvcCB8fCB0cnVlCiAgICBFUlJPUl9NU0c9IkNsb3VkLWluaXQgdXNlci1kYXRhIGZhaWxlZCB0byBzdWNjZWVkIChleGl0IGNvZGUgJHtydn0pIG9uIGluc3RhbmNlICR7RUMyX0hPU1ROQU1FfSBpbiAke0VOVklST05NRU5UfS4gIFN0b3BwaW5nICR7QVBQX05BTUV9IHNvIHRoYXQgaW5zdGFuY2UgZG9lcyBub3QgcmVjZWl2ZSBhbnkgdHJhZmZpYyBhbmQgc28gdGhhdCBkZXBsb3ltZW50IGNhbiBmYWlsLiIKICAgIHRlbGxfc2xhY2tfb3BzX3JhdyAiJHtFUlJPUl9NU0d9IgogICAgZXhpdCAkcnYKICBmaQp9CnRyYXAgIm5vdGlmeV90aGF0X3dlX2hpdF9hbl9lcnJvciIgSU5UIFRFUk0gRVhJVApFQzJfSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKRUMyX0lQVjRfTE9DQUxfQUREUj0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCkVDMl9BVkFJTEFCSUxJVFlfWk9ORT0kKGN1cmwgLXMgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL3BsYWNlbWVudC9hdmFpbGFiaWxpdHktem9uZS8pCkVDMl9SRUdJT049JChlY2hvICR7RUMyX0FWQUlMQUJJTElUWV9aT05FfSB8IHNlZCAncy8uJC8vJykKCiMgRmV0Y2ggYGRvZ2Zvb2RDYW5hcnlgIHRhZyBmb3IgdGhpcyBlYzIgaW5zdGFuY2UuIFVzaW5nIGF3cyBjbGkgYmVjYXVzZSBTcGlubmFrZXIgZG9lc24ndCAoeWV0KSBoYXZlIGFuIGVhc3kgd2F5IHRvIGVuYWJsZSB0aGUgSW5zdGFuY2VNZXRhZGF0YVRhZ3MgZmVhdHVyZS4KIyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQuIElmIHRoZSBJQU0gcGVybWlzc2lvbnMgYXJlbid0IHNldCB1cCBjb3JyZWN0bHksIHRoaXMgd2lsbCBxdWlldGx5IGZhaWwgYW5kIERPR0ZPT0RfQ0FOQVJZX0VOQUJMRUQgd2lsbCBiZSBzZXQgdG8gImZhbHNlIi4KRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0kKGF3cyBlYzIgZGVzY3JpYmUtdGFncyAtLWZpbHRlcnMgIk5hbWU9cmVzb3VyY2UtaWQsVmFsdWVzPSR7RUMyX0lOU1RBTkNFX0lEfSIgIk5hbWU9a2V5LFZhbHVlcz1kb2dmb29kQ2FuYXJ5IiAtLXJlZ2lvbiAke0VDMl9SRUdJT059IC0tcXVlcnkgJ1RhZ3NbMF0uVmFsdWUnIC0tb3V0cHV0IHRleHQgfHwgdHJ1ZSkKCiMgT25seSBhbGxvdyBlaXRoZXIgYHRydWVgIG9yIGBmYWxzZWAgdmFsdWVzIHNvIHdlIGVyciBvbiB0aGUgc2lkZSBvZiBzZXR0aW5nIHRoaXMgdG8gZmFsc2UuCmlmIFsgIiR7RE9HRk9PRF9DQU5BUllfRU5BQkxFRH0iICE9ICJ0cnVlIiBdOyB0aGVuCglET0dGT09EX0NBTkFSWV9FTkFCTEVEPSJmYWxzZSIKZmkKCiMgVGhpcyBmaWxlIGdldHMgcGlja2VkIHVwIGJ5IG91ciBzeXN0ZW1kIHNlcnZpY2UKZWNobyAiRE9HRk9PRF9DQU5BUllfRU5BQkxFRD0ke0RPR0ZPT0RfQ0FOQVJZX0VOQUJMRUR9IiA+IC9vcHQvc3lzdGVtZGVudgoKCktJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQ9InZwY2UtMDIyOTdjYmUzMzI5OWE3ZGItbng1amhkb2YtJHtFQzJfQVZBSUxBQklMSVRZX1pPTkV9LmZpcmVob3NlLnVzLWVhc3QtMS52cGNlLmFtYXpvbmF3cy5jb20iCgpLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVD0idnBjZS0wMzliMTRkYmViMTE5NTJkZi1zdTdreDU0ai0ke0VDMl9BVkFJTEFCSUxJVFlfWk9ORX0ua2luZXNpcy51cy1lYXN0LTEudnBjZS5hbWF6b25hd3MuY29tIgoKZWNobyAiPj4gRGF0YWRvZyBhZ2VudCBjb25maWd1cmF0aW9uIgphd3MgczMgc3luYyBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9L2RhdGFkb2ctYWdlbnQvIC9ldGMvZGF0YWRvZy1hZ2VudC8gLS1kZWxldGUKClsgISAtZCAvdmFyL3J1bi9kYXRhZG9nIF0gJiYgbWtkaXIgLXAgL3Zhci9ydW4vZGF0YWRvZwoKY2hvd24gZGQtYWdlbnQ6ZGQtYWdlbnQgL2V0Yy9kYXRhZG9nLWFnZW50LyogL3Zhci9ydW4vZGF0YWRvZwpjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG1vZCAwNjQwIC9ldGMvZGF0YWRvZy1hZ2VudC9zeXN0ZW0tcHJvYmUueWFtbApjaG93biByb290OmRkLWFnZW50IC9ldGMvZGF0YWRvZy1hZ2VudC9zZWN1cml0eS1hZ2VudC55YW1sCmNobW9kIDA2NDAgL2V0Yy9kYXRhZG9nLWFnZW50L3NlY3VyaXR5LWFnZW50LnlhbWwKCmlmIFsgLWYgIi9vcHQvJHtBUFBfTkFNRX0tY3VycmVudC9TSEEiIF07IHRoZW4KICBTSEE9JChjYXQgL29wdC8ke0FQUF9OQU1FfS1jdXJyZW50L1NIQSkKICBzZWQgLWkgInMvcmVwbGFjZS13aXRoLXNoYS8ke1NIQX0vIiAvZXRjL2RhdGFkb2ctYWdlbnQvZGF0YWRvZy55YW1sCmZpCgpmb3Igc2VydmljZV9uYW1lIGluIGRhdGFkb2ctYWdlbnQgZGF0YWRvZy1hZ2VudC1wcm9jZXNzIGRhdGFkb2ctYWdlbnQtdHJhY2UgZGF0YWRvZy1hZ2VudC1zeXNwcm9iZTsgZG8KICBzZXJ2aWNlICIke3NlcnZpY2VfbmFtZX0iIHJlc3RhcnQgfHwgdGVsbF9zbGFja19vcHMgIiR7c2VydmljZV9uYW1lfSByZXN0YXJ0IGZhaWxlZCIKZG9uZQoKZWNobyAiPj4gcGdib3VuY2VyIENvbmZpZ3VyYXRpb24iCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3VzZXJsaXN0LnR4dCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKY2hvd24gcG9zdGdyZXM6cG9zdGdyZXMgL2V0Yy9wZ2JvdW5jZXIvdXNlcmxpc3QudHh0CmNobW9kIDYwMCAvZXRjL3BnYm91bmNlci91c2VybGlzdC50eHQKCmF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9L2dvbmZhbG9uL3BnYm91bmNlci5jbXRwbCAvZXRjL2NvbnN1bC10ZW1wbGF0ZS9wZ2JvdW5jZXIuY210cGwKYXdzIHMzIGNwIHMzOi8vJHtTM19DT05GSUdTX0JVQ0tFVH0vJHtFTlZJUk9OTUVOVH0vZ29uZmFsb24vY29uc3VsLXRlbXBsYXRlLmNvbmYgL2V0Yy9jb25zdWwtdGVtcGxhdGUvY29uc3VsLXRlbXBsYXRlLmNvbmYKc2VydmljZSBjb25zdWwtdGVtcGxhdGUgcmVzdGFydApzbGVlcCAxMAoKCnNlcnZpY2UgcGdib3VuY2VyIHJlc3RhcnQKCgplY2hvICI+PiAke0FQUF9OQU1FfSBBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uIgoKY2FzZSAke0FQUF9OQU1FfSBpbgpzdHJlYW1lciopCiAgQ1VSUkVOVF9BUFBfRElSPXN0cmVhbWVyLWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9c3RyZWFtZXJfbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5jb25mCiAgbWtkaXIgLXAgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0KICBhd3MgczMgY3AgczM6Ly8ke1MzX0NPTkZJR1NfQlVDS0VUfS8ke0VOVklST05NRU5UfS8ke0FQUF9OQU1FfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYgIiRDT05GSUdfUEFUSCIKICA7OwpkYXRhLWV4cG9ydC10ZXN0ZXIpCiAgQ1VSUkVOVF9BUFBfRElSPSR7QVBQX05BTUV9LWN1cnJlbnQKICBMSU5VWF9BTUQ2NF9ESVI9JHtBUFBfTkFNRX1fbGludXhfYW1kNjQKICBDT05GSUdfUEFUSD0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vZGVmYXVsdC55bWwKICBtdiAvb3B0L2V2ZW50LSR7QVBQX05BTUV9LWN1cnJlbnQvIC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LwogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIG12IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7QVBQX05BTUV9X2xpbnV4X2FtZDY0LyR7QVBQX05BTUV9CiAgOzsKKikKICBDVVJSRU5UX0FQUF9ESVI9JHtBUFBfTkFNRX0tY3VycmVudAogIExJTlVYX0FNRDY0X0RJUj0ke0FQUF9OQU1FfV9saW51eF9hbWQ2NAogIENPTkZJR19QQVRIPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS8ke0FQUF9OQU1FfS4ke0xEX0FQUF9DT05GSUd9LmNvbmYKICBta2RpciAtcCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfQogIGF3cyBzMyBjcCBzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9LyR7QVBQX05BTUV9LiR7TERfQVBQX0NPTkZJR30uY29uZiAiJENPTkZJR19QQVRIIgogIDs7CmVzYWMKCmVjaG8gIj4+IENyZWF0aW5nIHNlbGYtc2lnbmVkIGNlcnRpZmljYXRlIGZvciBhcHAgdXNlIgpvcGVuc3NsIHJlcSAtbmV3a2V5IHJzYTo0MDk2IFwKICAteDUwOSBcCiAgLXNoYTI1NiBcCiAgLWRheXMgMzY1MCBcCiAgLW5vZGVzIFwKICAtb3V0IC9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9zZWxmc2lnbmVkLmNydCBcCiAgLWtleW91dCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5rZXkgXAogIC1zdWJqICIvQz1VUy9TVD1DQS9MPU9ha2xhbmQvTz1MYXVuY2hEYXJrbHkvT1U9U2VjdXJpdHkvQ049JHtFQzJfSU5TVEFOQ0VfSUR9IgppZiBbICAtbiAiJCh1bmFtZSAtYSB8IGdyZXAgVWJ1bnR1KSIgXTsgdGhlbgogIGNob3duIG5vYm9keSAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vc2VsZnNpZ25lZC5jcnQKICBjaG93biBub2JvZHkgL29wdC8ke0NVUlJFTlRfQVBQX0RJUn0vJHtMSU5VWF9BTUQ2NF9ESVJ9L3NlbGZzaWduZWQua2V5CmZpCgojIFNldCBLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UIGFuZCBLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVApzZWQgLWkgInMvS0lORVNJU19TVFJFQU1fRU5EUE9JTlQvJHtLSU5FU0lTX1NUUkVBTV9FTkRQT0lOVH0vZyIgIiRDT05GSUdfUEFUSCIKc2VkIC1pICJzL0tJTkVTSVNfRklSRUhPU0VfRU5EUE9JTlQvJHtLSU5FU0lTX0ZJUkVIT1NFX0VORFBPSU5UfS9nIiAiJENPTkZJR19QQVRIIgoKCgoKZWNobyAiPj4gU3lzdGVtZCBDb25maWd1cmF0aW9uIgphcHBfczNfcHJlZml4PSJzMzovLyR7UzNfQ09ORklHU19CVUNLRVR9LyR7RU5WSVJPTk1FTlR9LyR7QVBQX05BTUV9IgpzeXN0ZW1kX3VuaXRfZmlsZT0iL3Vzci9sb2NhbC9saWIvc3lzdGVtZC9zeXN0ZW0vJHtBUFBfTkFNRX0uc2VydmljZSIKbWtkaXIgLXAgIiQoZGlybmFtZSAiJHN5c3RlbWRfdW5pdF9maWxlIikiCmF3cyBzMyBjcCAiJGFwcF9zM19wcmVmaXgvJHtBUFBfTkFNRX0uJHtMRF9BUFBfQ09ORklHfS5zeXN0ZW1kLmNvbmYiICIkc3lzdGVtZF91bml0X2ZpbGUiCgppZiBncmVwIC1xRiAnc3NtLWVudi13cmFwcGVyLnNoJyAiJHN5c3RlbWRfdW5pdF9maWxlIjsgdGhlbgogIGlmICEgYXdzIHMzIGNwICIkYXBwX3MzX3ByZWZpeC9zc20tZW52LXdyYXBwZXIuc2giIC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaDsgdGhlbgogICAgPiYyIHByaW50ZiAnRVJST1I6IHN5c3RlbWQgdW5pdCAiJXMiIHVzZXMgInNzbS1lbnYtd3JhcHBlci5zaCIgYnV0IGNvdWxkIG5vdCBkb3dubG9hZCBzc20tZW52LXdyYXBwZXIuc2gnICIkc3lzdGVtZF91bml0X2ZpbGUiCiAgICBleGl0IDEKICBmaQogIGNobW9kICt4IC91c3IvbG9jYWwvYmluL3NzbS1lbnYtd3JhcHBlci5zaApmaQoKCmVjaG8gIj4+IFNldCB1cCBDb2Nrcm9hY2hkYiBjZXJ0cyIKbWtkaXIgLXAgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZAp7IGVjaG8gIltTZXJ2aWNlXSIKICBlY2hvICJFbnZpcm9ubWVudD1DQV9BUk49YXJuOmF3czphY20tcGNhOnVzLWVhc3QtMTo1NTQ1ODIzMTc5ODk6Y2VydGlmaWNhdGUtYXV0aG9yaXR5LzkwMjUzNzYxLThlMjctNDM0ZC1iNzAxLWZmNzFlNzE4YjVjYyIKICBlY2hvICJFbnZpcm9ubWVudD1DRVJUX0RJUj0vb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0NOPSR7QVBQX05BTUV9LnN0Zy5sYXVuY2hkYXJrbHkuY29tIgogIGVjaG8gIkVudmlyb25tZW50PUVYUExJQ0lUX0NOPWdvbmZhbG9uIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfRklMRV9OQU1FPWNsaWVudC5nb25mYWxvbiIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCiAgZWNobyAiRXhlY1N0YXJ0UG9zdD0vYmluL3NoIC1jICdjaG93biBub2JvZHk6bm9ncm91cCAvb3B0LyR7Q1VSUkVOVF9BUFBfRElSfS8ke0xJTlVYX0FNRDY0X0RJUn0vY3JkYi1jZXJ0cy9jbGllbnQuZ29uZmFsb24uKiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UuZC8xMC1jZXJ0LWNvbmZpZy5jb25mCiMgV2UgZG9uJ3Qgd2FudCB0byBzdGFydCB0aGUgZGF0YWRvZyBzZXJ2aWNlIGZvciB0aGUgc2xhY2stYXBwCm1rZGlyIC1wIC9ldGMvc3lzdGVtZC9zeXN0ZW0vY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZS5kCnsgZWNobyAiW1NlcnZpY2VdIgogIGVjaG8gIkVudmlyb25tZW50PUNBX0FSTj1hcm46YXdzOmFjbS1wY2E6dXMtZWFzdC0xOjU1NDU4MjMxNzk4OTpjZXJ0aWZpY2F0ZS1hdXRob3JpdHkvOTAyNTM3NjEtOGUyNy00MzRkLWI3MDEtZmY3MWU3MThiNWNjIgogIGVjaG8gIkVudmlyb25tZW50PUNFUlRfRElSPS9vcHQvJHtDVVJSRU5UX0FQUF9ESVJ9LyR7TElOVVhfQU1ENjRfRElSfS9jcmRiLWNlcnRzIgogIGVjaG8gIkVudmlyb25tZW50PUJBU0VfQ049JHtBUFBfTkFNRX0uc3RnLmxhdW5jaGRhcmtseS5jb20iCiAgZWNobyAiRW52aXJvbm1lbnQ9RVhQTElDSVRfQ049ZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRT1jbGllbnQuZGF0YWRvZyIKICBlY2hvICJFbnZpcm9ubWVudD1CQVNFX0ZJTEVfTkFNRV9GTEFHPSctZiciCn0gfCB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb2Nrcm9hY2hkYi1jbGllbnQtZGF0YWRvZy1jZXJ0aWZpY2F0ZS5zZXJ2aWNlLmQvMTAtY2VydC1jb25maWcuY29uZgoKCgoKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKCnN5c3RlbWN0bCBzdGFydCBjb2Nrcm9hY2hkYi1jbGllbnQtYXBwLWNlcnRpZmljYXRlLnNlcnZpY2UKIyBkaXNhYmxlIHNjaGVkdWxlZCB1cGRhdGVzIGJlY2F1c2UgZ29uZmFsb24gd2lsbCBub3QgcmVsb2FkIHRoZSBjZXJ0CiMgYnkgYWxsb3dpbmcgdGhlIGNlcnQgdG8gcmVtYWluIHVuY2hhbmdlZCwgd2UgY2FuIGJlIGFsZXJ0ZWQgd2hlbiBpdCBpcyBhYm91dCB0byBleHBpcmUKIyBzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWFwcC1jZXJ0aWZpY2F0ZS50aW1lcgpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUuc2VydmljZQpzeXN0ZW1jdGwgc3RhcnQgY29ja3JvYWNoZGItY2xpZW50LWRhdGFkb2ctY2VydGlmaWNhdGUudGltZXIKCgoKc2VydmljZSAiJHtBUFBfTkFNRX0iIHJlc3RhcnQKCkFUVEVNUFRTPTAKTUFYX0FUVEVNUFRTPTEyMApQT1JUPTMwMDAKd2hpbGUgWyAkQVRURU1QVFMgLW5lICRNQVhfQVRURU1QVFMgXSA7IGRvCiAgICBBVFRFTVBUUz0kKChBVFRFTVBUUysxKSkKICAgIGVjaG8gIldhaXRpbmcgZm9yIGFwcGxpY2F0aW9uLi4uICgke0FUVEVNUFRTfS8ke01BWF9BVFRFTVBUU30pIgogICAgaWYgISB0aW1lb3V0IDEgYmFzaCAtYyAiZWNobyA+L2Rldi90Y3AvbG9jYWxob3N0LyR7UE9SVH0iOyB0aGVuCiAgICAgICAgc2xlZXAgMTsKICAgIGVsc2UKICAgICAgICBlY2hvICJBcHBsaWNhdGlvbiBpcyBydW5uaW5nLiIKICAgICAgICBicmVhawogICAgZmkKICAgIGlmIFsgJEFUVEVNUFRTIC1lcSAkTUFYX0FUVEVNUFRTIF07IHRoZW4KICAgICAgICBleGl0IDE7CiAgICBmaQpkb25lCgpzeXN0ZW1jdGwgZW5hYmxlIC0tbm93IHN5c3N0YXQuc2VydmljZQo=",
              "capacity": {
                "desired": 1,
                "max": 1,
                "min": 1
              },
              "cloudProvider": "aws",
              "cooldown": 120,
              "copySourceCustomBlockDeviceMappings": false,
              "delayBeforeDisableSec": 60,
              "delayBeforeScaleDownSec": 300,
              "dirty": {},
              "ebsOptimized": false,
              "enabledMetrics": [
                "GroupMinSize",
                "GroupMaxSize",
                "GroupDesiredCapacity",
                "GroupInServiceInstances",
                "GroupPendingInstances",
                "GroupStandbyInstances",
                "GroupTerminatingInstances",
                "GroupTotalInstances"
              ],
              "freeFormDetails": "ld-stg-dogfood-canary",
              "healthCheckGracePeriod": 240,
              "healthCheckType": "ELB",
              "iamRole": "staging-gonfalon",
              "instanceMonitoring": true,
              "instanceType": "${ parameters.ec2_instance_type }",
              "keyPair": "ld_shared",
              "launchTemplateOverridesForInstanceType": null,
              "loadBalancers": [],
              "maxRemainingAsgs": 2,
              "moniker": {
                "app": "gonfalon",
                "detail": "ld-stg",
                "stack": "web"
              },
              "preferSourceCapacity": true,
              "provider": "aws",
              "rollback": {
                "onFailure": true
              },
              "scaleDown": true,
              "securityGroups": [
                "sg-6d2d7d09",
                "sg-8720fff0",
                "sg-ea3d2e95",
                "sg-b016fcd6",
                "sg-9eb16dd7",
                "sg-0f5148ef05cf05c3f",
                "sg-097f9a0a312508f21",
                "sg-0a6e9f9d25e69eb66",
                "sg-0c2a7585136e6ff6b",
                "sg-0aa07965745f27fd4",
                "sg-0a437487d63666bee",
                "sg-091749c543fb38405",
                "sg-050f06fe8c17db7e2",
                "sg-077d6bdb5d655df02",
                "sg-097e5a5ed46e7b6e4"
              ],
              "setLaunchTemplate": false,
              "spelLoadBalancers": [],
              "spelTargetGroups": [],
              "spotPrice": "",
              "stack": "web",
              "strategy": "redblack",
              "subnetType": "launchdarkly-private-subnet",
              "suspendedProcesses": [],
              "tags": {
                "Name": "gonfalon-web (staging)",
                "dogfoodCanary": "true",
                "env": "staging",
                "environment": "staging",
                "managed_by": "spinnaker",
                "owner": "common",
                "region": "us-east-1",
                "role": "gonfalon-web",
                "service": "app.launchdarkly.com",
                "sha": "${ parameters.sha }",
                "tier": "staging"
              },
              "targetGroups": [
                "gonfalon-web-ld-stg",
                "gonfalon-web-internal-ld-stg"
              ],
              "targetHealthyDeployPercentage": 100,
              "terminationPolicies": [
                "Default"
              ],
              "useAmiBlockDeviceMappings": true,
              "useSourceCapacity": true
            }
          ],
          "customSubject": "Deployed gonfalon-web-${ parameters['sha'] } to staging",
          "name": "Deploy application to AWS",
          "notifications": [
            {
              "address": "changelog-staging@launchdarkly.com",
              "level": "stage",
              "message": {
                "stage.complete": {
                  "text": "Details: Deployed gonfalon-web-${ parameters['sha'] } to staging.  The diff is: https://github.com/launchdarkly/gonfalon/compare/${ #stage('Determine current version')['status'].toString() == 'SUCCEEDED' ? #stage('Determine current version')['context']['webhook']['body']['version'] : 'unknown' }...${ parameters['sha'] }\n\n!staging !deploy\n\nWho: ${ trigger['user'] } via ${ trigger['type'] } trigger\n\nTopic: gonfalon-web\n\nWhen: ${ new java.text.SimpleDateFormat('EEE MMM d HH:mm:ss z YYYY').format(new java.util.Date())}\n\n"
                }
              },
              "type": "email",
              "when": [
                "stage.complete"
              ]
            }
          ],
          "overrideTimeout": true,
          "refId": "deploy_aws_redblack",
          "requisiteStageRefIds": [
            "bake_multi_region_ami",
            "run_db_migrations_coderefs-crdb",
            "run_db_migrations_oauth2-crdb",
            "run_db_migrations_accounts-crdb",
            "run_db_migrations_gonfalon-accounts-crdb",
            "run_db_migrations_gonfalon-billing-crdb",
            "run_db_migrations_gonfalon-file-jobs-crdb",
            "run_db_migrations_gonfalon-integrations-crdb",
            "run_db_migrations_gonfalon-workflows-crdb",
            "run_db_migrations_gonfalon-experimentation-crdb"
          ],
          "sendNotifications": true,
          "stageTimeoutMs": 2700000,
          "type": "deploy"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.sleuth.io/api/1/deployments/launchdarkly/gonfalon-web/register_deploy?ignore_if_duplicate=true"
                        },
                        {
                          "name": "BODY",
                          "value": ""
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "FORM_api_key",
                          "value": "{{`{{ ssm \"${ parameters.sleuth_api_key_ssm_path }\" }}`}}"
                        },
                        {
                          "name": "FORM_environment",
                          "value": "staging"
                        },
                        {
                          "name": "FORM_sha",
                          "value": "${ parameters.sha }"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Sleuth",
          "refId": "sleuth_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "sleuth_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.honeycomb.io/1/markers/staging"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"message\" : \"gonfalon - staging - Deployment - sha: ${ parameters.sha }\",\n\t\t\"type\":\"deploy\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_Honeycomb_Team",
                          "value": "{{`{{ ssm \"${ parameters.honeycomb_api_key_ssm_path }\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Honeycomb",
          "refId": "honeycomb_publish",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "honeycomb_api_key_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"staging\",\n  \"eventType\": \"started\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate started notification",
          "refId": "accelerate_started",
          "requisiteStageRefIds": [
            "determine_deployed_app_version"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://app.ld.catamorphic.com/api/v2/accelerate/deployment-events"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n  \"environmentKey\": \"staging\",\n  \"eventType\": \"finished\",\n  \"projectKey\": \"default\",\n  \"service\": \"gonfalon\",\n  \"version\": \"${ parameters.sha }\"\n}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Authorization",
                          "value": "{{`{{ ssm \"/shared-services/common/services/accelerate/ld_api_key\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Send Accelerate finished notification",
          "refId": "accelerate_finished",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://circleci.com/api/v2/project/gh/launchdarkly/gonfalon/pipeline"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\t\"parameters\": { \"run_cypress_staging\": true }\n\t\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Circle_Token",
                          "value": "{{`{{ ssm \"/global/services/circle-ci/api-token\" }}`}}"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Trigger Cypress tests",
          "refId": "cypress",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://calibreapp.com/api/sites/gonfalon-staging/deploys"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"secret\": \"{{`{{ ssm \"/shared-services/us-east-1/applications/spinnaker/gonfalon_staging_calibre_site_secret\" }}`}}\",\n\t\t\"revision\": \"${ parameters.sha }\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Accept",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Post deploy to Calibre",
          "refId": "calibre",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://thumbseeker.launchdarkly.com/promotion"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"sha\": \"${ parameters.sha }\",\n\t\t\"service\": \"gonfalon\",\n\t\t\"environment\": \"staging\",\n\t\t\"check\": \"spinnaker\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "HEADER_Content_Type",
                          "value": "application/json"
                        },
                        {
                          "name": "HEADER_X_LaunchDarkly_Secret",
                          "value": "{{`{{ ssm \"/shared-services/us-east-1/applications/thumbseeker/internal_secret\" }}`}}"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Trigger Thumb Seeker promotion",
          "refId": "thumbseeker",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "continuePipeline": true,
          "credentials": "kubernetes",
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "run-redocly-deploy",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "REDOCLY_API_TOKEN_SSM_PATH",
                          "value": "/production/common/services/apidocs/redocly_api_key"
                        },
                        {
                          "name": "OPENAPI_VERSION",
                          "value": "20191212"
                        },
                        {
                          "name": "REDOCLY_REGISTRY",
                          "value": "LaunchDarkly Staging"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/redocly-deploy:latest",
                      "name": "redocly-deploy"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Run Deploy API Docs",
          "refId": "deploy_redocly",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "type": "runJobManifest",
          "waitForCompletion": true
        },
        {
          "continuePipeline": true,
          "failPipeline": false,
          "method": "POST",
          "name": "Notify #ops-staging deploy finished",
          "overrideTimeout": true,
          "payload": {
            "channel": "#ops-staging",
            "text": "${ trigger.user } is done deploying gonfalon-web - staging with version ${ parameters.sha }. Check it out!"
          },
          "refId": "notification_deploy_finish_ops-staging",
          "requisiteStageRefIds": [
            "deploy_aws_redblack",
            "sleuth_publish",
            "honeycomb_publish",
            "cypress",
            "calibre",
            "thumbseeker",
            "deploy_redocly"
          ],
          "stageTimeoutMs": 60000,
          "type": "webhook",
          "url": "https://hooks.slack.com/services/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"
        },
        {
          "account": "kubernetes",
          "alias": "runJob",
          "application": "gonfalon",
          "cloudProvider": "kubernetes",
          "completeOtherBranchesThenFail": true,
          "continuePipeline": true,
          "credentials": "kubernetes",
          "failPipeline": false,
          "manifest": {
            "apiVersion": "batch/v1",
            "kind": "Job",
            "metadata": {
              "generateName": "notifier",
              "namespace": "armory"
            },
            "spec": {
              "backoffLimit": 0,
              "template": {
                "spec": {
                  "containers": [
                    {
                      "env": [
                        {
                          "name": "METHOD",
                          "value": "POST"
                        },
                        {
                          "name": "URL",
                          "value": "https://api.rollbar.com/api/1/deploy"
                        },
                        {
                          "name": "BODY",
                          "value": "{\n\t\t\"access_token\":   \"{{`{{ ssm \"${ parameters.rollbar_access_token_ssm_path }\" }}`}}\",\n\t\t\"environment\":    \"staging\",\n\t\t\"local_username\": \"${ trigger.user }\",\n\t\t\"revision\":       \"${ parameters.sha }\",\n\t\t\"status\":         \"succeeded\"\n\t}"
                        },
                        {
                          "name": "AWS_REGION",
                          "value": "us-east-1"
                        },
                        {
                          "name": "ASSUME_ROLE",
                          "value": "SpinnakerManagedRole"
                        },
                        {
                          "name": "AWS_ACCOUNT_ID",
                          "value": "554582317989"
                        }
                      ],
                      "image": "061661829416.dkr.ecr.us-east-1.amazonaws.com/spinnaker-jobs/notifier:latest",
                      "name": "notifier"
                    }
                  ],
                  "restartPolicy": "Never"
                }
              }
            }
          },
          "name": "Publish to Rollbar (succeeded)",
          "refId": "rollbar_succeeded",
          "requisiteStageRefIds": [
            "deploy_aws_redblack"
          ],
          "source": "text",
          "stageEnabled": {
            "expression": "parameters.rollbar_access_token_ssm_path != ''",
            "type": "expression"
          },
          "stageTimeoutMs": 60000,
          "type": "runJobManifest",
          "waitForCompletion": true
        }
      ],
      "triggers": [
        {
          "enabled": true,
          "expectedArtifactIds": [],
          "payloadConstraints": {
            "status": "completed"
          },
          "runAsUser": "api-service-account@launchdarkly.com",
          "source": "48ea138e-a104-4f59-a1b1-bbc06b9b5ca9",
          "type": "webhook"
        }
      ]
    }
  ]
}
